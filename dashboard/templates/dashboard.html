<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvoBot - Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyClrXVHM5xP4FqZKsjaqN7VEXAsGwNeax4",
            authDomain: "evobot-8.firebaseapp.com",
            databaseURL: "https://evobot-8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "evobot-8",
            storageBucket: "evobot-8.firebasestorage.app",
            messagingSenderId: "349123654411",
            appId: "1:349123654411:web:afc01b90aa06984c74e80e",
            measurementId: "G-Q1BRXP7KRE"
        };
        
        const app = initializeApp(firebaseConfig);
        window.firebaseDB = getDatabase(app);
        window.firebaseRef = ref;
        window.firebaseOnValue = onValue;
    </script>
    <link rel="stylesheet" href="/static/css/style.css">
    <link rel="stylesheet" href="/static/css/signal-filters.css">
    <script>
        (function() {
            const theme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
</head>
<body>
    <div id="app">
        <!-- Redesigned Telegram Channel Search Modal -->
        <div class="confirm-overlay" v-if="showChannelSearchModal" @click.self="closeChannelSearchModal">
            <div class="channel-modal">
                <!-- Modal Header -->
                <div class="channel-modal-header">
                    <div class="channel-modal-header-left">
                        <div class="channel-modal-icon">
                            <img src="/assets/logos/telegram.jpg" alt="Telegram" />
                        </div>
                        <div class="channel-modal-title-group">
                            <h3>Channel Management</h3>
                            <p>Add and manage your signal sources</p>
                        </div>
                    </div>
                    <button class="channel-modal-close" @click="closeChannelSearchModal" title="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                
                <!-- Modal Body -->
                <div class="channel-modal-body">
                    <!-- Left Panel: Search & Browse -->
                    <div class="channel-modal-main">
                        <div class="channel-search-wrapper">
                            <div class="channel-search-input-wrapper">
                                <svg class="channel-search-icon" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                                <input 
                                    type="text" 
                                    v-model="channelSearchQuery" 
                                    @input="searchChannels" 
                                    placeholder="Search channels by name or username..." 
                                    class="channel-search-input"
                                    :disabled="loadingChannelSearch" 
                                    autocomplete="off"
                                    ref="channelSearchInput"
                                />
                                <div v-if="loadingChannelSearch" class="channel-search-loading">
                                    <span class="spinner"></span>
                                </div>
                            </div>
                        </div>

                        <div class="channel-results-container">
                            <!-- Loading Skeleton -->
                            <div v-if="loadingChannelSearch && channelSearchResults.length === 0" class="channel-skeleton-list">
                                <div v-for="i in 10" :key="'skel-'+i" class="channel-skeleton-item">
                                    <div class="channel-skeleton-avatar"></div>
                                    <div class="channel-skeleton-content">
                                        <div class="channel-skeleton-title"></div>
                                        <div class="channel-skeleton-subtitle"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Search Results -->
                            <div v-else-if="channelSearchResults.length > 0" class="channel-results-list">
                                <div 
                                    v-for="channel in channelSearchResults" 
                                    :key="channel.id" 
                                    class="channel-result-card" 
                                    :class="{ 'is-added': isChannelAlreadyAdded(channel.id) }" 
                                >
                                    <div class="channel-result-avatar">
                                        <img v-if="channel.has_photo" :src="'/api/telegram/channel/' + channel.id + '/photo'" :alt="channel.title" />
                                        <span v-else class="channel-result-avatar-text">{{ channel.title.substring(0, 1).toUpperCase() }}</span>
                                    </div>
                                    <div class="channel-result-info">
                                        <div class="channel-result-title">
                                            {{ channel.title }}
                                            <svg v-if="channel.verified" class="channel-verified-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" /></svg>
                                        </div>
                                        <div class="channel-result-meta">
                                            <span class="channel-result-username">@{{ channel.username || channel.id }}</span>
                                            <span v-if="channel.participants_count" class="channel-result-separator">•</span>
                                            <span v-if="channel.participants_count" class="channel-result-members">{{ formatNumberCompact(channel.participants_count) }} members</span>
                                        </div>
                                    </div>
                                    <div class="channel-result-action">
                                        <div v-if="isChannelAlreadyAdded(channel.id)" class="channel-added-badge">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                                            <span>Added</span>
                                        </div>
                                        <button v-else class="channel-add-btn" @click="addChannel(channel)" :disabled="addingChannels">
                                            <svg v-if="addingChannels" class="spinner" width="14" height="14"></svg>
                                            <template v-else>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                                <span>Add</span>
                                            </template>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Empty States -->
                            <div v-else class="channel-empty-state">
                                <div class="channel-empty-icon">
                                    <svg v-if="!channelSearchQuery && !loadingChannelSearch" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                    <svg v-else-if="channelSearchQuery" xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                                </div>
                                <h4 v-if="!channelSearchQuery && !loadingChannelSearch">Start searching</h4>
                                <p v-if="!channelSearchQuery && !loadingChannelSearch">Type in the search box to find your Telegram channels</p>
                                <h4 v-else-if="channelSearchQuery">No channels found</h4>
                                <p v-else-if="channelSearchQuery">Try searching with a different name or username</p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Panel: Active Channels -->
                    <div class="channel-modal-sidebar">
                        <div class="channel-sidebar-header">
                            <h4>Active Channels</h4>
                            <div class="channel-count-badge">{{ settings.telegram.signal_channels.length }}</div>
                        </div>
                        <div class="channel-sidebar-content">
                            <div v-if="settings.telegram.signal_channels.length > 0" class="channel-active-list">
                                <div v-for="channelId in settings.telegram.signal_channels" :key="'active-' + channelId" class="channel-active-item">
                                    <div class="channel-active-avatar">
                                        <img v-if="hasChannelPhoto(channelId)" :src="'/api/telegram/channel/' + channelId + '/photo'" :alt="getChannelName(channelId, 0)" />
                                        <span v-else class="channel-active-avatar-text">{{ getChannelInitials(channelId, 0) }}</span>
                                    </div>
                                    <div class="channel-active-info">
                                        <div class="channel-active-name">{{ getChannelName(channelId, 0) }}</div>
                                        <div class="channel-active-id">{{ getChannelDisplayId(channelId) }}</div>
                                    </div>
                                    <button class="channel-remove-btn" @click="removeSignalChannelById(channelId)" title="Remove">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <div v-else class="channel-sidebar-empty">
                                <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                <p>No channels yet</p>
                                <span>Add channels to start monitoring signals</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="channel-modal-footer">
                    <button class="btn btn-secondary" @click="closeChannelSearchModal">Done</button>
                </div>
            </div>
        </div>
        
        <!-- MT5 Login Modal -->
        <div class="confirm-overlay" v-if="showMT5LoginModal" @click.self="closeMT5Modal">
            <div class="channel-modal" style="max-width: 520px;">
                <!-- Modal Header -->
                <div class="channel-modal-header">
                    <div class="channel-modal-header-left">
                        <div class="channel-modal-icon">
                            <img src="/assets/logos/mt5.webp" alt="MT5" />
                        </div>
                        <div class="channel-modal-title-group">
                            <h3>MT5 Connection</h3>
                            <p>Connect your MetaTrader 5 account</p>
                        </div>
                    </div>
                    <button class="channel-modal-close" @click="closeMT5Modal" title="Close">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
                
                <!-- Modal Body -->
                <div class="channel-modal-body" style="display: block; padding: 0;">
                    <!-- Connected Account View -->
                    <div v-if="mt5SessionValid && account.login" class="mt5-connected-view">
                        <div class="mt5-account-card">
                            <div class="mt5-account-header">
                                <div class="mt5-account-avatar">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" />
                                </div>
                                <div class="mt5-account-info">
                                    <div class="mt5-account-name">{{ account.name || 'MT5 Account' }}</div>
                                    <div class="mt5-account-company">{{ account.company || account.server }}</div>
                                </div>
                                <div class="mt5-status-badge connected">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                                    <span>Connected</span>
                                </div>
                            </div>
                            <div class="mt5-account-stats">
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Login</span>
                                    <span class="mt5-stat-value">{{ account.login }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Server</span>
                                    <span class="mt5-stat-value">{{ account.server }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Balance</span>
                                    <span class="mt5-stat-value">{{ currencySymbol }}{{ formatNumber(account.balance) }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Equity</span>
                                    <span class="mt5-stat-value">{{ currencySymbol }}{{ formatNumber(account.equity) }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Margin</span>
                                    <span class="mt5-stat-value">{{ currencySymbol }}{{ formatNumber(account.margin) }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Free Margin</span>
                                    <span class="mt5-stat-value">{{ currencySymbol }}{{ formatNumber(account.free_margin) }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Leverage</span>
                                    <span class="mt5-stat-value">1:{{ account.leverage }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Currency</span>
                                    <span class="mt5-stat-value">{{ account.currency || 'USD' }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Profit</span>
                                    <span class="mt5-stat-value" :class="account.profit >= 0 ? 'profit-positive' : 'profit-negative'">{{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}</span>
                                </div>
                                <div class="mt5-stat-item">
                                    <span class="mt5-stat-label">Margin Level</span>
                                    <span class="mt5-stat-value">{{ account.margin > 0 ? ((account.equity / account.margin) * 100).toFixed(2) : '∞' }}%</span>
                                </div>
                            </div>
                        </div>
                        <button class="btn btn-danger" @click="confirmMT5Disconnect" style="width: 100%; margin-top: 16px;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            Disconnect Account
                        </button>
                    </div>
                    
                    <!-- Login Form View -->
                    <div v-else class="mt5-login-form">
                        <div class="mt5-form-group">
                            <label class="mt5-form-label">Server</label>
                            <div class="mt5-input-wrapper">
                                <svg class="mt5-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="8" x="2" y="2" rx="2"/><rect width="20" height="8" x="2" y="14" rx="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                                <input 
                                    type="text" 
                                    v-model="mt5Form.server" 
                                    @input="filterMT5Servers" 
                                    @focus="showMT5ServerDropdown" 
                                    @blur="hideMT5Dropdown" 
                                    placeholder="e.g., YourBroker-Demo" 
                                    :disabled="mt5Testing" 
                                    autocomplete="off" 
                                    class="mt5-input"
                                />
                            </div>
                            <div v-if="showMT5Dropdown" class="mt5-server-dropdown">
                                <div v-if="loadingMT5Servers" class="mt5-server-loading">
                                    <span class="spinner" style="width: 16px; height: 16px;"></span>
                                    <span>Searching servers...</span>
                                </div>
                                <div v-else-if="filteredMT5Servers.length > 0">
                                    <div v-for="server in filteredMT5Servers" :key="server" class="mt5-server-option" @mousedown.prevent="selectMT5Server(server)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="20" height="8" x="2" y="2" rx="2"/><rect width="20" height="8" x="2" y="14" rx="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                                        <span>{{ server }}</span>
                                    </div>
                                </div>
                                <div v-else class="mt5-server-empty">
                                    <span>No servers found</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt5-form-group">
                            <label class="mt5-form-label">Login</label>
                            <div class="mt5-input-wrapper">
                                <svg class="mt5-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                                <input 
                                    type="text" 
                                    v-model="mt5Form.login" 
                                    placeholder="Your MT5 account number" 
                                    :disabled="mt5Testing" 
                                    class="mt5-input"
                                />
                            </div>
                        </div>
                        
                        <div class="mt5-form-group">
                            <label class="mt5-form-label">Password</label>
                            <div class="mt5-input-wrapper">
                                <svg class="mt5-input-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="11" x="3" y="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                                <input 
                                    :type="showMT5Password ? 'text' : 'password'" 
                                    v-model="mt5Form.password" 
                                    placeholder="Your MT5 password" 
                                    :disabled="mt5Testing" 
                                    @keyup.enter="connectMT5" 
                                    class="mt5-input"
                                    style="padding-right: 40px;"
                                />
                                <button type="button" @click="showMT5Password = !showMT5Password" class="password-toggle-btn" :disabled="mt5Testing">
                                    <svg v-if="showMT5Password" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <div v-if="mt5TestResult" class="mt5-result-message" :class="{ success: mt5TestResult.success, error: !mt5TestResult.success }">
                            <svg v-if="mt5TestResult.success" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"/></svg>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                            <span>{{ mt5TestResult.message }}</span>
                        </div>
                    </div>
                </div>
                
                <!-- Modal Footer -->
                <div class="channel-modal-footer">
                    <button class="btn btn-secondary" @click="closeMT5Modal" :disabled="mt5Testing">
                        {{ mt5SessionValid && account.login ? 'Close' : 'Cancel' }}
                    </button>
                    <button v-if="!mt5SessionValid || !account.login" class="btn btn-primary" @click="connectMT5" :disabled="mt5Testing || !mt5Form.server || !mt5Form.login || !mt5Form.password">
                        <span v-if="mt5Testing" class="spinner"></span>
                        <span v-else>Connect</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Confirmation Modal -->
        <div class="confirm-overlay" v-if="showConfirmModal" @click.self="showConfirmModal = false">
            <div class="confirm-modal">
                <div class="confirm-icon" :class="confirmAction">
                    <svg v-if="confirmAction === 'start'" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                </div>
                <h3 class="confirm-title">{{ confirmAction === 'start' ? 'Start Trading Bot?' : 'Stop Trading Bot?' }}</h3>
                <p class="confirm-message">
                    {{ confirmAction === 'start' 
                        ? 'The bot will connect to MT5 and start monitoring Telegram for trading signals.' 
                        : 'All active monitoring will stop. Open positions will remain but no new trades will be executed.' 
                    }}
                </p>
                <div class="confirm-actions">
                    <button class="btn" @click="showConfirmModal = false">Cancel</button>
                    <button class="btn" :class="confirmAction === 'start' ? 'btn-success' : 'btn-danger'" @click="executeConfirmedAction">
                        <span v-if="loading.start || loading.stop" class="spinner"></span>
                        <span v-else>{{ confirmAction === 'start' ? 'Start Bot' : 'Stop Bot' }}</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Channel Delete Confirmation Modal -->
        <div class="confirm-overlay" v-if="showChannelDeleteModal" @click.self="showChannelDeleteModal = false">
            <div class="channel-delete-modal">
                <div class="channel-delete-header">
                    <div class="channel-delete-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                    </div>
                    <div class="channel-delete-info">
                        <h3 class="channel-delete-title">Remove Channel?</h3>
                        <p class="channel-delete-subtitle">This action cannot be undone</p>
                    </div>
                </div>
                <div class="channel-delete-body">
                    <div class="channel-delete-preview" v-if="channelToDelete">
                        <div class="channel-delete-preview-avatar">
                            <img v-if="hasChannelPhoto(channelToDelete.id)" :src="'/api/telegram/channel/' + channelToDelete.id + '/photo'" :alt="channelToDelete.name" />
                            <span v-else style="font-size: 14px; font-weight: 600; color: var(--text-muted);">{{ channelToDelete.name.substring(0, 1).toUpperCase() }}</span>
                        </div>
                        <div class="channel-delete-preview-info">
                            <div class="channel-delete-preview-name">{{ channelToDelete.name }}</div>
                            <div class="channel-delete-preview-id">{{ channelToDelete.displayId }}</div>
                        </div>
                    </div>
                    <p class="channel-delete-message">This channel will be removed from your signal sources and will no longer be monitored for trading signals.</p>
                </div>
                <div class="channel-delete-footer">
                    <button class="btn btn-secondary" @click="showChannelDeleteModal = false">Cancel</button>
                    <button class="btn btn-danger" @click="confirmChannelDelete">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/></svg>
                        Remove Channel
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Logout Confirmation Modal -->
        <div class="confirm-overlay" v-if="showLogoutModal" @click.self="showLogoutModal = false">
            <div class="confirm-modal">
                <div class="confirm-icon logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                </div>
                <h3 class="confirm-title">Sign Out?</h3>
                <p class="confirm-message">Are you sure you want to sign out? You'll need to sign in again to access the dashboard.</p>
                <div class="confirm-actions">
                    <button class="btn" @click="showLogoutModal = false">Cancel</button>
                    <button class="btn btn-danger" @click="confirmLogout" :disabled="loggingOut">
                        <span v-if="loggingOut" class="spinner"></span>
                        <span v-else>Sign Out</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- MT5 Disconnect Confirmation Modal -->
        <div class="confirm-overlay" v-if="showMT5DisconnectModal" @click.self="showMT5DisconnectModal = false">
            <div class="confirm-modal">
                <div class="confirm-icon logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                </div>
                <h3 class="confirm-title">Disconnect MT5 Account?</h3>
                <p class="confirm-message">Are you sure you want to disconnect from MT5? You will need to login again to reconnect your trading account.</p>
                <div class="confirm-actions">
                    <button class="btn" @click="showMT5DisconnectModal = false">Cancel</button>
                    <button class="btn btn-danger" @click="logoutMT5">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                        Disconnect
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Connection Error Modal -->
        <div class="confirm-overlay" v-if="showConnectionError" @click.self="showConnectionError = false">
            <div class="connection-error-modal">
                <div class="connection-error-header">
                    <div class="connection-error-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                    </div>
                    <h3 class="connection-error-title">Connection Failed</h3>
                    <p class="connection-error-subtitle">Unable to establish all required connections</p>
                </div>
                
                <div class="connection-error-body">
                    <!-- Connection Status List -->
                    <div class="connection-status-list">
                        <div class="connection-status-item" :class="connectionErrors.mt5.status">
                            <div class="connection-status-icon" :class="connectionErrors.mt5.status">
                                <svg v-if="connectionErrors.mt5.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.mt5.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">MT5 Connection</div>
                                <div class="connection-status-message">{{ connectionErrors.mt5.message }}</div>
                            </div>
                        </div>
                        
                        <div class="connection-status-item" :class="connectionErrors.telegram.status">
                            <div class="connection-status-icon" :class="connectionErrors.telegram.status">
                                <svg v-if="connectionErrors.telegram.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.telegram.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">Telegram Connection</div>
                                <div class="connection-status-message">{{ connectionErrors.telegram.message }}</div>
                            </div>
                        </div>
                        
                        <div class="connection-status-item" :class="connectionErrors.account.status">
                            <div class="connection-status-icon" :class="connectionErrors.account.status">
                                <svg v-if="connectionErrors.account.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.account.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">Trading Account</div>
                                <div class="connection-status-message">{{ connectionErrors.account.message }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Troubleshooting Tips -->
                    <div class="connection-troubleshoot">
                        <div class="troubleshoot-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                            Troubleshooting Tips
                        </div>
                        <div class="troubleshoot-list">
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Ensure MT5 terminal is running on your computer</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Verify your MT5 login credentials (server, login, password) in .env file</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Enable "Allow automated trading" in MT5 Tools → Options → Expert Advisors</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.telegram.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Verify your Telegram API credentials are correct</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.telegram.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Check if Telegram session needs re-authentication</span>
                            </div>
                            <div class="troubleshoot-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Check your internet connection and firewall settings</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="connection-error-footer">
                    <button class="btn btn-secondary" @click="showConnectionError = false; navigateTo('settings')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                        Check Settings
                    </button>
                    <button class="btn btn-primary" @click="retryConnection" :disabled="loading.start">
                        <span v-if="loading.start" class="spinner"></span>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                        {{ loading.start ? 'Connecting...' : 'Retry Connection' }}
                    </button>
                </div>
            </div>
        </div>
        
        <div class="app" :class="{ 'navbar-collapsed': navbarCollapsed }">
            <!-- Header -->
            <header class="header" :class="{ 'bot-running': status.bot_running }">
                <div class="header-left">
                    <div class="status-indicator" :class="{ active: status.bot_running }">
                        <svg class="status-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                            <circle class="orbit-path" cx="12" cy="12" r="8" opacity="0.3"/>
                            <circle class="orbit-dot" cx="20" cy="12" r="2" fill="currentColor"/>
                            <circle class="orbit-dot-2" cx="4" cy="12" r="1.5" fill="currentColor" opacity="0.6"/>
                            <circle cx="12" cy="12" r="3" fill="currentColor"/>
                        </svg>
                        <span class="status-text">{{ status.bot_running ? 'Running' : 'Stopped' }}</span>
                    </div>
                    <div v-if="status.bot_running" class="uptime-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                        {{ formatUptime(displayUptime) }}
                    </div>
                </div>
                
                <div class="header-center">
                    <div v-if="loading.refresh" class="sync-badge">
                        <span class="spinner"></span>
                        <span>Syncing</span>
                    </div>
                </div>
                
                <div class="header-right">
                    <button class="icon-btn" @click="toggleTheme" title="Toggle theme">
                        <svg v-if="isDarkTheme" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="4"/><path d="M12 2v2m0 16v2M4.93 4.93l1.41 1.41m11.32 11.32l1.41 1.41M2 12h2m16 0h2M6.34 17.66l-1.41 1.41M17.66 6.34l1.41-1.41"/></svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                    </button>
                    <button v-if="status.bot_running" class="icon-btn" @click="refreshData" :disabled="loading.refresh">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                    </button>
                    <button v-if="!status.bot_running" class="action-btn start" @click="startBot" :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid) || (!status.mt5_connected && !account.login)">
                        <span v-if="loading.start" class="spinner"></span>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                        {{ loading.start ? 'Starting' : 'Start Bot' }}
                    </button>
                    <button v-else class="action-btn stop" @click="confirmStop" :disabled="loading.stop">
                        <span v-if="loading.stop" class="spinner"></span>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                        {{ loading.stop ? 'Stopping' : 'Stop Bot' }}
                    </button>
                </div>
            </header>
            
            <!-- Left Sidebar Navbar -->
            <div class="left-navbar" :class="{ collapsed: navbarCollapsed }">
                <!-- Navbar Header -->
                <div class="navbar-header">
                    <div class="navbar-logo">
                        <div class="logo-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                        </div>
                        <span class="logo-text">EvoBot</span>
                    </div>
                    <button class="collapse-btn" @click="navbarCollapsed = !navbarCollapsed" title="Toggle navbar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                    </button>
                </div>
                
                <!-- Navigation Sections -->
                <nav class="nav-sections">
                    <!-- Dashboard Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Dashboard</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'dashboard' }" @click="navigateTo('dashboard')" data-tooltip="Overview">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"/><polyline points="12 12 20 7.5"/><polyline points="12 12 12 21"/><polyline points="12 12 4 7.5"/></svg>
                            <span class="nav-text">Overview</span>
                            <span v-if="status.bot_running" class="nav-badge success">ON</span>
                        </div>
                        <div class="nav-item" :class="{ active: activeNavItem === 'signals' }" @click="navigateTo('signals')" data-tooltip="Signals">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                            <span class="nav-text">Signals</span>
                        </div>
                    </div>
                    
                    <!-- Trades Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Trading</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'trades' }" @click="navigateTo('trades')" data-tooltip="Open Positions">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            <span class="nav-text">Open Positions</span>
                            <span v-if="mt5Positions.length > 0" class="nav-badge">{{ mt5Positions.length }}</span>
                        </div>
                        <div class="nav-item" :class="{ active: activeNavItem === 'history' }" @click="navigateTo('history')" data-tooltip="Trade History">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span class="nav-text">Trade History</span>
                        </div>
                    </div>
                    
                    <!-- Stats Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Performance</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'stats' }" @click="navigateTo('stats')" data-tooltip="Statistics">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                            <span class="nav-text">Statistics</span>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Configuration</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'settings' }" @click="navigateTo('settings')" data-tooltip="Settings">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                            <span class="nav-text">Settings</span>
                        </div>
                        <div class="nav-item" :class="{ active: activeNavItem === 'logs' }" @click="navigateTo('logs')" data-tooltip="System Logs">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                            <span class="nav-text">System Logs</span>
                        </div>
                    </div>
                </nav>
                
                <!-- MT5 Account Details -->
                <div class="navbar-account-compact" v-if="account.login">
                    <div class="navbar-account-header">
                        <img src="/assets/logos/mt5.webp" alt="MT5" class="navbar-account-logo" />
                        <span>MT5 Account</span>
                        <a href="#" @click.prevent="showMT5LoginModal = true" style="margin-left: auto; font-size: 9px; color: #888; text-decoration: none; font-weight: 500; transition: all 0.2s; padding-bottom: 2px; border-bottom: 1px solid transparent;" onmouseover="this.style.color='var(--text)'; this.style.borderBottomColor='#555'" onmouseout="this.style.color='#888'; this.style.borderBottomColor='transparent'">Manage</a>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Balance</span>
                        <span class="navbar-account-value">{{ currencySymbol }}{{ formatNumber(account.balance) }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Server</span>
                        <span class="navbar-account-value">{{ account.server || '-' }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Login</span>
                        <span class="navbar-account-value">{{ account.login || '-' }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Leverage</span>
                        <span class="navbar-account-value">1:{{ account.leverage || 0 }}</span>
                    </div>
                </div>
                
                <!-- MT5 Not Connected Placeholder -->
                <div class="navbar-account-compact" v-else style="text-align: center; padding: 20px 16px; opacity: 0.6;">
                    <div style="margin-bottom: 12px;">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="opacity: 0.5;">
                            <rect width="20" height="8" x="2" y="2" rx="2" ry="2"/>
                            <rect width="20" height="8" x="2" y="14" rx="2" ry="2"/>
                            <line x1="6" x2="6.01" y1="6" y2="6"/>
                            <line x1="6" x2="6.01" y1="18" y2="18"/>
                        </svg>
                    </div>
                    <div style="font-size: 12px; color: var(--text-muted); margin-bottom: 8px;">MT5 Not Connected</div>
                    <button class="btn btn-sm btn-secondary" @click="showMT5LoginModal = true" style="font-size: 11px; padding: 6px 12px; width: 100%;">
                        Connect MT5
                    </button>
                </div>
                
                <!-- User Profile (Bottom of Navbar) -->
                <div class="user-profile-section">
                    <div class="user-profile-compact" @click="showUserMenu = !showUserMenu">
                        <div class="user-avatar-small" :style="telegramUser.photo_path ? { backgroundImage: 'url(/api/telegram/user/photo)', backgroundSize: 'cover' } : {}">
                            <svg v-if="!telegramUser.photo_path" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <div class="user-info-compact">
                            <div class="user-name-compact">{{ telegramUser.first_name || 'User' }}</div>
                            <div class="user-username-compact" v-if="telegramUser.username">@{{ telegramUser.username }}</div>
                            <div class="user-username-compact" v-else>{{ status.telegram_connected ? 'Connected' : 'Offline' }}</div>
                        </div>
                        <button class="user-menu-btn" @click.stop="showUserMenu = !showUserMenu" title="Menu">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                        </button>
                    </div>
                    <!-- User Dropdown Menu -->
                    <div v-if="showUserMenu" class="user-menu-dropdown">
                        <a href="#" @click.prevent="activeNavItem = 'settings'; showUserMenu = false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/></svg>
                            Settings
                        </a>
                        <a href="#" @click.prevent="activeNavItem = 'stats'; showUserMenu = false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                            Statistics
                        </a>
                        <hr>
                        <a href="#" @click.prevent="logout" class="logout-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main" :class="{ 'full-width': activeNavItem === 'settings' || activeNavItem === 'logs' || activeNavItem === 'history' || activeNavItem === 'stats' || activeNavItem === 'trades' || activeNavItem === 'signals' }">
                <!-- Dashboard View (Overview) -->
                <div class="page-view" :class="{ active: activeNavItem === 'dashboard' }">
                <div class="content">
                    <!-- Bot Stopped Placeholder -->
                    <div v-if="!status.bot_running" class="bot-stopped-placeholder">
                        <div class="bot-stopped-icon" :class="{ 'is-loading': loading.start }">
                            <svg v-if="!loading.start" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v4"/>
                                <path d="m16.2 7.8 2.9-2.9"/>
                                <path d="M18 12h4"/>
                                <path d="m16.2 16.2 2.9 2.9"/>
                                <path d="M12 18v4"/>
                                <path d="m4.9 19.1 2.9-2.9"/>
                                <path d="M2 12h4"/>
                                <path d="m4.9 4.9 2.9 2.9"/>
                            </svg>
                            <svg v-else class="loading-spinner-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                            </svg>
                        </div>
                        <div class="bot-stopped-title">{{ loading.start ? 'Starting Bot...' : 'Trading Bot Inactive' }}</div>
                        <div class="bot-stopped-subtitle">
                            <template v-if="loading.start">
                                <div class="loading-steps">
                                    <div class="loading-step" :class="{ active: startingStep >= 1, done: startingStep > 1 }">
                                        <span class="step-icon">{{ startingStep > 1 ? '✓' : '1' }}</span>
                                        <span>Initializing connections...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 2, done: startingStep > 2 }">
                                        <span class="step-icon">{{ startingStep > 2 ? '✓' : '2' }}</span>
                                        <span>Connecting to Telegram...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 3, done: startingStep > 3 }">
                                        <span class="step-icon">{{ startingStep > 3 ? '✓' : '3' }}</span>
                                        <span>Connecting to MT5 broker...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 4 }">
                                        <span class="step-icon">4</span>
                                        <span>Starting signal listener...</span>
                                    </div>
                                </div>
                            </template>
                            <template v-else>
                                <span v-if="!account.login">Connect your MT5 account to start trading.</span>
                                <span v-else>Start the bot to begin monitoring Telegram signals and executing trades automatically on your MT5 account.</span>
                            </template>
                        </div>
                        <div class="bot-stopped-actions" v-if="!loading.start">
                            <!-- Show MT5 Login button if not connected -->
                            <button v-if="!account.login" class="btn-start" @click="showMT5LoginModal = true" style="background: var(--bg-secondary); color: var(--text); border: 1px solid var(--border);">
                                <img src="/assets/logos/mt5.webp" alt="MT5" style="width: 18px; height: 18px; margin-right: 8px; border-radius: 3px;" />
                                Connect MT5
                            </button>
                            <!-- Show Start Bot button if MT5 is connected -->
                            <button v-else class="btn-start" @click="startBot" :disabled="loading.bot || (!status.telegram_connected && !telegramSessionValid)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                Start Bot
                            </button>
                            <div class="bot-stopped-status" :class="{ ready: account.login && (telegramSessionValid || status.telegram_connected) }">
                                <span class="status-dot"></span>
                                <span v-if="!account.login">MT5 account required</span>
                                <span v-else-if="(telegramSessionValid || status.telegram_connected)">Ready to start</span>
                                <span v-else>Configure Telegram first</span>
                            </div>
                        </div>
                        <div class="bot-stopped-features">
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                                </div>
                                <span>Signal Capture</span>
                            </div>
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                </div>
                                <span>Auto Trading</span>
                            </div>
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
                                </div>
                                <span>Risk Control</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Row (only show when bot is running) -->
                    <div v-else>
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-label">Balance</div>
                            <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.balance) }}</div>
                            <div class="stat-sub">{{ account.currency || 'USD' }}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Equity</div>
                            <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.equity) }}</div>
                            <div class="stat-sub">Free: {{ currencySymbol }}{{ formatNumber(account.free_margin) }}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Floating P/L</div>
                            <div class="stat-value" :class="account.profit >= 0 ? 'positive' : 'negative'">
                                {{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}
                            </div>
                            <div class="stat-sub">Unrealized</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Win Rate</div>
                            <div class="stat-value">{{ stats.closed_trades > 0 ? (stats.win_rate || 0).toFixed(1) : '—' }}%</div>
                            <div class="stat-sub">{{ stats.winning_trades || 0 }}/{{ stats.closed_trades || 0 }} closed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Open Positions</div>
                            <div class="stat-value">{{ mt5Positions.length }}</div>
                            <div class="stat-sub">MT5 Account</div>
                        </div>
                    </div>
                    
                    <!-- Trades Table -->
                    <div class="trades-section">
                        <div class="section-header">
                            <div class="section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <span>Open Positions</span>
                                <span class="badge">{{ mt5Positions.length }}</span>
                            </div>
                            <div style="display: flex; gap: 6px; align-items: center;">
                                <!-- View Toggle -->
                                <div class="view-toggle" v-if="mt5Positions.length > 0">
                                    <button class="view-toggle-btn" :class="{ active: groupPositionsView }" @click="setPositionsView(true)" title="Group by Signal">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                    </button>
                                    <button class="view-toggle-btn" :class="{ active: !groupPositionsView }" @click="setPositionsView(false)" title="List View">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <button class="btn" @click="refreshPositions" :disabled="loading.positions" style="padding: 4px 10px; font-size: 11px;">
                                    <span v-if="loading.positions" class="spinner spinner-dark" style="width: 10px; height: 10px;"></span>
                                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                                </button>
                                <button class="btn btn-secondary" @click="navigateTo('trades')" style="padding: 4px 10px; font-size: 11px;">
                                    View All
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- List View (Flat Table) -->
                        <div class="table-wrapper" v-if="mt5Positions.length > 0 && !groupPositionsView">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ticket</th>
                                        <th>Symbol</th>
                                        <th>Type</th>
                                        <th>Volume</th>
                                        <th>Entry</th>
                                        <th>Current</th>
                                        <th>SL</th>
                                        <th>TP</th>
                                        <th>P/L</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="pos in mt5Positions" :key="pos.position_ticket">
                                        <td class="font-mono">{{ pos.position_ticket }}</td>
                                        <td class="symbol-cell">{{ pos.symbol }}</td>
                                        <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">
                                            {{ pos.direction }}
                                        </td>
                                        <td>{{ pos.lot_size }}</td>
                                        <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                        <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                        <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                        <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                        <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                            {{ pos.profit >= 0 ? '+' : '' }}${{ pos.profit.toFixed(2) }}
                                        </td>
                                        <td>
                                            <div class="trade-actions">
                                                <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                </button>
                                                <button class="btn-action btn-close-trade" 
                                                        @click="closePosition(pos.position_ticket)" 
                                                        :disabled="loading.trades[pos.position_ticket]"
                                                        title="Close Position">
                                                    <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr style="background: var(--bg-secondary); font-weight: 600;">
                                        <td colspan="8" style="text-align: right;">Total P/L:</td>
                                        <td :class="totalPnL >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ totalPnL >= 0 ? '+' : '' }}${{ totalPnL.toFixed(2) }}
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <!-- Grouped View (Signal Cards) -->
                        <div v-if="mt5Positions.length > 0 && groupPositionsView">
                            <div v-for="(group, signalId) in groupedPositions" :key="signalId" class="signal-group" :class="{ collapsed: group.collapsed }">
                                <div class="signal-group-header" @click="group.collapsed = !group.collapsed">
                                    <div class="signal-group-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                                    </div>
                                    <div class="signal-channel-avatar">
                                        <img v-if="group.channel && (group.channel.photo || group.channel.has_photo)" :src="'/api/telegram/channel/' + group.channel.id + '/photo'" :alt="group.channel.name">
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                    </div>
                                    <div class="signal-group-info">
                                        <div class="signal-group-title">
                                            {{ group.channel ? group.channel.name : (signalId === 'manual' ? 'Manual' : group.symbol || 'Signal') }}
                                            <span class="symbol-badge" v-if="group.positions.length > 0">{{ group.positions[0].symbol }}</span>
                                            <span class="count-badge">{{ group.positions.length }}</span>
                                        </div>
                                        <div class="signal-group-meta">
                                            <span v-if="group.signal_time">{{ formatSignalTime(group.signal_time) }}</span>
                                            <span v-else>{{ group.positions[0]?.direction || 'TRADE' }}</span>
                                        </div>
                                    </div>
                                    <div class="signal-group-stats">
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">Lots</span>
                                            <span class="signal-stat-value">{{ group.total_lots.toFixed(2) }}</span>
                                        </div>
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">P/L</span>
                                            <span class="signal-stat-value" :class="group.total_profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ group.total_profit >= 0 ? '+' : '' }}${{ group.total_profit.toFixed(2) }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signal-group-body">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Ticket</th>
                                                <th>Type</th>
                                                <th>Vol</th>
                                                <th>Entry</th>
                                                <th>Current</th>
                                                <th>P/L</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="pos in group.positions" :key="'grp-' + pos.position_ticket">
                                                <td class="font-mono" style="font-size: 11px;">{{ pos.position_ticket }}</td>
                                                <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                                <td>{{ pos.lot_size }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                                <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                    {{ pos.profit >= 0 ? '+' : '' }}${{ pos.profit.toFixed(2) }}
                                                </td>
                                                <td>
                                                    <button class="btn-action btn-close-trade" @click.stop="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close">
                                                        <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Empty State -->
                        <div class="empty-state" v-if="mt5Positions.length === 0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                            <div>No open positions</div>
                            <div style="font-size: 11px; margin-top: 4px;">Your MT5 positions will appear here</div>
                        </div>
                    </div>
                    </div><!-- End v-else wrapper -->
                </div>
                </div><!-- End Dashboard View -->
                
                <!-- Trades/Positions Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'trades' }">
                    <div class="page-header">
                        <div>
                            <h1>Open Positions</h1>
                            <p>Manage your current MT5 trading positions</p>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;" v-if="status.bot_running">
                            <!-- View Toggle -->
                            <div class="view-toggle" v-if="mt5Positions.length > 0">
                                <button class="view-toggle-btn" :class="{ active: groupPositionsView }" @click="setPositionsView(true)" title="Group by Signal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                    Group
                                </button>
                                <button class="view-toggle-btn" :class="{ active: !groupPositionsView }" @click="setPositionsView(false)" title="List View">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                                    List
                                </button>
                            </div>
                            <button class="btn" @click="refreshPositions" :disabled="loading.positions">
                                <span v-if="loading.positions" class="spinner spinner-dark"></span>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="settings-container" v-if="!status.bot_running">
                        <div class="bot-stopped-placeholder">
                            <div class="bot-stopped-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="5" x2="12" y2="19"/>
                                    <line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                            </div>
                            <div class="bot-stopped-title">No Active Positions</div>
                            <div class="bot-stopped-subtitle">The bot needs to be running to display open positions. Start the bot to begin monitoring and executing trades in real-time.</div>
                            <div class="bot-stopped-actions">
                                <button v-if="!account.login" class="btn-start" @click="showMT5LoginModal = true" style="background: var(--bg-secondary); color: var(--text); border: 1px solid var(--border);">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" style="width: 18px; height: 18px; margin-right: 8px; border-radius: 3px;" />
                                    Connect MT5
                                </button>
                                <button v-else class="btn-start" @click="startBot" :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                    Start Bot
                                </button>
                                <div class="bot-stopped-status" :class="{ ready: account.login && (telegramSessionValid || status.telegram_connected) }">
                                    <span class="status-dot"></span>
                                    <span v-if="!account.login">MT5 account required</span>
                                    <span v-else-if="(telegramSessionValid || status.telegram_connected)">Ready to start</span>
                                    <span v-else>Configure Telegram first</span>
                                </div>
                            </div>
                            <div class="bot-stopped-features">
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                    </div>
                                    <span>Live P&L Tracking</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                    </div>
                                    <span>Position Management</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                    </div>
                                    <span>Group by Signal</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-container" v-else>
                        <!-- Quick Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-label">Open Positions</div>
                                <div class="stat-value">{{ mt5Positions.length }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total P/L</div>
                                <div class="stat-value" :class="totalPnL >= 0 ? 'positive' : 'negative'">
                                    {{ totalPnL >= 0 ? '+' : '' }}{{ currencySymbol }}{{ totalPnL.toFixed(2) }}
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Margin Used</div>
                                <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.margin) }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Free Margin</div>
                                <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.free_margin) }}</div>
                            </div>
                        </div>
                        
                        <!-- Grouped Positions by Signal -->
                        <div v-if="Object.keys(groupedPositions).length > 0 && groupPositionsView">
                            <div v-for="(group, signalId) in groupedPositions" :key="signalId" class="signal-group" :class="{ collapsed: group.collapsed }">
                                <div class="signal-group-header" @click="group.collapsed = !group.collapsed">
                                    <div class="signal-group-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                                    </div>
                                    <div class="signal-channel-avatar">
                                        <img v-if="group.channel && group.channel.photo" :src="'/api/channels/' + group.channel.id + '/photo'" :alt="group.channel.name">
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                    </div>
                                    <div class="signal-group-info">
                                        <div class="signal-group-title">
                                            {{ group.channel ? group.channel.name : (signalId === 'manual' ? 'Manual Trades' : 'Unknown Signal') }}
                                            <span class="symbol-badge" v-if="group.positions.length > 0">{{ group.positions[0].symbol }}</span>
                                        </div>
                                        <div class="signal-group-meta">
                                            <span v-if="group.signal_time">{{ formatSignalTime(group.signal_time) }}</span>
                                            <span v-else>{{ group.positions.length }} position{{ group.positions.length !== 1 ? 's' : '' }}</span>
                                        </div>
                                    </div>
                                    <div class="signal-group-stats">
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">Lots</span>
                                            <span class="signal-stat-value">{{ group.total_lots.toFixed(2) }}</span>
                                        </div>
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">P/L</span>
                                            <span class="signal-stat-value" :class="group.total_profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ group.total_profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ group.total_profit.toFixed(2) }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signal-group-body">
                                    <table style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Ticket</th>
                                                <th>Type</th>
                                                <th>Volume</th>
                                                <th>Entry</th>
                                                <th>Current</th>
                                                <th>SL</th>
                                                <th>TP</th>
                                                <th>P/L</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="pos in group.positions" :key="'grp-' + pos.position_ticket">
                                                <td class="font-mono">{{ pos.position_ticket }}</td>
                                                <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                                <td>{{ pos.lot_size }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                                <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                                <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                    {{ pos.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ pos.profit.toFixed(2) }}
                                                </td>
                                                <td>
                                                    <div class="trade-actions">
                                                        <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                        </button>
                                                        <button class="btn-action btn-close-trade" @click="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close Position">
                                                            <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- List View (Flat Table) -->
                        <div class="settings-card" v-if="mt5Positions.length > 0 && !groupPositionsView" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <h3>All Positions</h3>
                            </div>
                            <div class="settings-card-body" style="padding: 0;">
                                <table style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Ticket</th>
                                            <th>Symbol</th>
                                            <th>Type</th>
                                            <th>Volume</th>
                                            <th>Entry</th>
                                            <th>Current</th>
                                            <th>SL</th>
                                            <th>TP</th>
                                            <th>P/L</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="pos in mt5Positions" :key="'list-' + pos.position_ticket">
                                            <td class="font-mono">{{ pos.position_ticket }}</td>
                                            <td><span class="symbol-badge">{{ pos.symbol }}</span></td>
                                            <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                            <td>{{ pos.lot_size }}</td>
                                            <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                            <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                            <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                            <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                            <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                {{ pos.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ pos.profit.toFixed(2) }}
                                            </td>
                                            <td>
                                                <div class="trade-actions">
                                                    <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                    </button>
                                                    <button class="btn-action btn-close-trade" @click="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close Position">
                                                        <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Empty State Card -->
                        <div class="settings-card" v-if="mt5Positions.length === 0" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <h3>Active Positions</h3>
                            </div>
                            <div class="settings-card-body" style="padding: 0;">
                                <div class="empty-state" style="padding: 60px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                                    <div style="margin-top: 16px; font-size: 14px;">No open positions</div>
                                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Your MT5 positions will appear here when you have active trades</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Trades View -->
                
                <!-- Sidebar (Only visible on Dashboard Overview) -->
                <aside class="sidebar" v-if="activeNavItem === 'dashboard'">
                    <!-- Connection Status -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Connections
                        </div>
                        <div class="connection-cards">
                            <!-- MetaTrader 5 Connection Card -->
                            <div class="connection-card" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading', failed: !status.mt5_connected && status.bot_running }">
                                <div class="connection-card-logo mt5-logo">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" width="32" height="32" style="border-radius: 6px;" />
                                    <div class="connection-dot" :class="{ active: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading' }"></div>
                                </div>
                                <div class="connection-card-info">
                                    <div class="connection-card-row">
                                        <span class="connection-card-name">MetaTrader 5</span>
                                    </div>
                                    <div class="connection-card-status" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, failed: !status.mt5_connected && status.bot_running }">
                                        <span v-if="connectionSteps.mt5 === 'loading'" class="status-connecting">
                                            <span class="connecting-dots"><span></span><span></span><span></span></span>
                                            Connecting
                                        </span>
                                        <span v-else-if="account.login && !status.bot_running && !status.mt5_connected" style="color: var(--success);">Ready</span>
                                        <span v-else>{{ getMT5StatusText }}</span>
                                    </div>
                                </div>
                                <button v-if="account.login" class="btn-connection-action" @click="showMT5LoginModal = true" title="Manage">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                                    Manage
                                </button>
                                <button v-else class="btn-connection-action btn-connect" @click="showMT5LoginModal = true" title="Connect">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                </button>
                            </div>
                            
                            <!-- Telegram Connection Card -->
                            <!-- TEMPORARILY HIDDEN: Telegram connection card will be re-enabled in a future update -->
                            <!--
                            <div class="connection-card" :class="{ connected: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, connecting: connectionSteps.telegram === 'loading', failed: !status.telegram_connected && status.bot_running }">
                                <div class="connection-card-logo telegram-logo">
                                    <img src="/assets/logos/telegram.jpg" alt="Telegram" width="32" height="32" style="border-radius: 6px;" />
                                    <div class="connection-dot" :class="{ active: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, connecting: connectionSteps.telegram === 'loading' }"></div>
                                </div>
                                <div class="connection-card-info">
                                    <div class="connection-card-row">
                                        <span class="connection-card-name">Telegram</span>
                                    </div>
                                    <div class="connection-card-status" :class="{ connected: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, failed: !status.telegram_connected && status.bot_running }">
                                        <span v-if="connectionSteps.telegram === 'loading'" class="status-connecting">
                                            <span class="connecting-dots"><span></span><span></span><span></span></span>
                                            Connecting
                                        </span>
                                        <span v-else-if="telegramSessionValid && !status.bot_running && !status.telegram_connected">Ready</span>
                                        <span v-else>{{ getTelegramStatusText }}</span>
                                    </div>
                                </div>
                                <span v-if="telegramSessionValid" class="logged-in-badge">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                                    Logged In
                                </span>
                                <button v-else class="btn-connection-action btn-connect" @click="navigateTo('settings')" title="Sign In">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                </button>
                            </div>
                            -->
                        </div>
                        <button v-if="status.bot_running && (!status.mt5_connected || !status.telegram_connected)" class="btn btn-retry" @click="retryConnection" :disabled="loading.reconnect" style="margin-top: 10px;">
                            <span v-if="loading.reconnect" class="spinner spinner-dark"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                            {{ loading.reconnect ? 'Reconnecting...' : 'Retry Connection' }}
                        </button>
                    </div>
                    
                    <!-- Trading Settings -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                            Trading
                        </div>
                        <div class="trading-inline-settings">
                            <!-- Default Lot Size -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.default_lot_size' && startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                <span class="inline-edit-label">Lot Size</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.default_lot_size'">
                                    <span>{{ settings.trading.default_lot_size }}</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.01" min="0.01" max="100" @keyup.enter="saveEdit('trading', 'default_lot_size')" @keyup.escape="cancelEdit" placeholder="Lots" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'default_lot_size')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Spread -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_spread_pips' && startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                <span class="inline-edit-label">Max Spread</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_spread_pips'">
                                    <span>{{ settings.trading.max_spread_pips }} pips</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_spread_pips')" @keyup.escape="cancelEdit" placeholder="pips" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_spread_pips')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Open Trades -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_open_trades' && startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                <span class="inline-edit-label">Max Trades</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_open_trades'">
                                    <span>{{ settings.trading.max_open_trades }}</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="1" min="1" max="50" @keyup.enter="saveEdit('trading', 'max_open_trades')" @keyup.escape="cancelEdit" placeholder="Max" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_open_trades')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Daily Drawdown -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_daily_drawdown_percent' && startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                <span class="inline-edit-label">Max Drawdown</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_daily_drawdown_percent'">
                                    <span>{{ settings.trading.max_daily_drawdown_percent }}%</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_daily_drawdown_percent')" @keyup.escape="cancelEdit" placeholder="%" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_daily_drawdown_percent')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Signal Channels -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Signal Channels
                            <span class="badge" style="margin-left: auto;">{{ settings.telegram.signal_channels.length }}</span>
                            <button class="btn btn-secondary btn-sm" @click="openChannelSearchModal" style="font-size: 10px; padding: 4px 8px; margin-left: 6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                Add
                            </button>
                        </div>
                        <!-- Loading state -->
                        <div v-if="loadingChannels && telegramChannels.length === 0" class="channel-skeleton-grid">
                            <div v-for="i in 6" :key="'skel-'+i" class="channel-skeleton-item">
                                <div class="channel-skeleton-avatar"></div>
                                <div class="channel-skeleton-name"></div>
                            </div>
                        </div>
                        <!-- Show channel list with verification badge and capturing indicator -->
                        <div v-else-if="settings.telegram.signal_channels.length > 0" class="sidebar-channels-wrapper">
                            <div class="channel-row" v-for="(channelId, index) in settings.telegram.signal_channels" :key="'chan-' + index">
                                <div class="channel-avatar" :class="{ 'has-photo': hasChannelPhoto(channelId) }" :style="getChannelPhoto(channelId)">
                                    <span v-if="!hasChannelPhoto(channelId)">{{ getChannelInitials(channelId, index) }}</span>
                                    <div v-if="status.bot_running && status.telegram_connected" class="active-pulse"></div>
                                </div>
                                <div class="channel-content">
                                    <div class="channel-name-row">
                                        <span class="name">{{ getChannelName(channelId, index) }}</span>
                                        <svg v-if="isChannelVerified(channelId)" class="verified-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" /></svg>
                                    </div>
                                    <div class="channel-meta-row" style="display: flex; align-items: center; gap: 4px;">
                                        <span class="id">{{ getChannelDisplayId(channelId) }}</span>
                                        <template v-if="getChannelInfo(channelId)?.participants_count">
                                            <span class="dot-separator"></span>
                                            <span style="font-size: 10px; opacity: 0.8;">{{ formatNumberCompact(getChannelInfo(channelId).participants_count) }} members</span>
                                        </template>
                                    </div>
                                </div>
                                <button class="channel-remove-action" @click="removeSignalChannelById(channelId)" title="Remove source">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                </button>
                            </div>
                        </div>
                        <!-- No channels configured -->
                        <div v-else class="empty-channels">
                            No channels configured
                        </div>
                    </div>
                </aside>
                
                <!-- Settings Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'settings' }">
                    <div class="page-header">
                        <div>
                            <h1>Settings</h1>
                            <p>Configure your trading bot connections and preferences</p>
                        </div>
                        <button class="btn btn-primary" @click="saveAllSettings" :disabled="loading.settings">
                            <span v-if="loading.settings" class="spinner"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save All Settings
                        </button>
                    </div>
                    <div class="settings-container">
                        <div class="settings-grid">
                            <!-- Telegram Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                                    <h3>Telegram Connection</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>API ID</label>
                                        <input type="text" v-model="settings.telegram.api_id" placeholder="Enter API ID">
                                    </div>
                                    <div class="settings-row">
                                        <label>API Hash</label>
                                        <input type="password" v-model="settings.telegram.api_hash" placeholder="Enter API Hash">
                                    </div>
                                    <div class="settings-row">
                                        <label>Phone Number</label>
                                        <input type="text" v-model="settings.telegram.phone_number" placeholder="+1234567890">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- MetaApi Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                                    <h3>MetaApi / MT5 Broker</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>MetaApi Token</label>
                                        <input type="password" v-model="settings.broker.metaapi_token" placeholder="Enter token">
                                    </div>
                                    <div class="settings-row">
                                        <label>Account ID</label>
                                        <input type="text" v-model="settings.broker.metaapi_account_id" placeholder="Enter account ID">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trading Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                    <h3>Trading Parameters</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Default Lot Size</label>
                                        <input type="number" v-model="settings.trading.default_lot_size" step="0.01" min="0.01">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Spread (pips)</label>
                                        <input type="number" v-model="settings.trading.max_spread_pips" step="0.5" min="0">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Open Trades</label>
                                        <input type="number" v-model="settings.trading.max_open_trades" step="1" min="1">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Daily Drawdown %</label>
                                        <input type="number" v-model="settings.trading.max_daily_drawdown_percent" step="0.5" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Signal Channels Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                                    <h3>Signal Channels</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="channel-list" style="margin-bottom: 16px;">
                                        <div class="channel-item" v-for="(channelId, index) in settings.telegram.signal_channels" :key="'settings-sig-' + index" style="background: var(--bg-secondary); padding: 12px; margin-bottom: 8px; border-radius: 8px; display: flex; align-items: center; gap: 12px;">
                                            <div class="channel-result-photo" style="width: 40px; height: 40px; border-radius: 8px; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                                <img v-if="hasChannelPhoto(channelId)" :src="'/api/telegram/channel/' + channelId + '/photo'" :alt="getChannelName(channelId, index)" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;" />
                                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                            </div>
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px; display: flex; align-items: center; gap: 6px;">
                                                    <span style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ getChannelName(channelId, index) }}</span>
                                                    <svg v-if="isChannelVerified(channelId)" class="verified-icon" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#3b82f6" stroke="#fff" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                                                </div>
                                                <div style="font-size: 11px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">ID: {{ getChannelDisplayId(channelId) }}</div>
                                            </div>
                                            <button class="remove-btn" @click="removeSignalChannel(index)" title="Remove" style="opacity: 1; background: var(--danger); color: white; border-radius: 4px; padding: 6px 10px; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                            </button>
                                        </div>
                                        <div v-if="settings.telegram.signal_channels.length === 0" style="padding: 40px; text-align: center; color: var(--text-muted); font-size: 13px; background: var(--bg-secondary); border-radius: 8px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5; margin-bottom: 8px;"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                            <div>No signal channels configured yet</div>
                                            <div style="font-size: 11px; margin-top: 4px;">Click the button below to add channels</div>
                                        </div>
                                    </div>
                                    <button class="btn btn-primary" @click="openChannelSearchModal" style="width: 100%;">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                        Add Channels
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Settings View -->
                
                <!-- Logs Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'logs' }">
                    <div class="page-header">
                        <div>
                            <h1>System Logs</h1>
                            <p>View bot activity and system messages</p>
                        </div>
                        <button class="btn" @click="clearLogs" v-if="status.bot_running && activities.length > 0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            Clear Logs
                        </button>
                    </div>
                    <div class="settings-container" v-if="!status.bot_running">
                        <div class="bot-stopped-placeholder">
                            <div class="bot-stopped-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 7h16M4 12h16M4 17h16"/>
                                </svg>
                            </div>
                            <div class="bot-stopped-title">No Activity Logs</div>
                            <div class="bot-stopped-subtitle">The bot needs to be running to generate activity logs. Start the bot to monitor connections, trades, and system events in real-time.</div>
                            <div class="bot-stopped-actions">
                                <button v-if="!account.login" class="btn-start" @click="showMT5LoginModal = true" style="background: var(--bg-secondary); color: var(--text); border: 1px solid var(--border);">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" style="width: 18px; height: 18px; margin-right: 8px; border-radius: 3px;" />
                                    Connect MT5
                                </button>
                                <button v-else class="btn-start" @click="startBot" :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                    Start Bot
                                </button>
                                <div class="bot-stopped-status" :class="{ ready: account.login && (telegramSessionValid || status.telegram_connected) }">
                                    <span class="status-dot"></span>
                                    <span v-if="!account.login">MT5 account required</span>
                                    <span v-else-if="(telegramSessionValid || status.telegram_connected)">Ready to start</span>
                                    <span v-else>Configure Telegram first</span>
                                </div>
                            </div>
                            <div class="bot-stopped-features">
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                                    </div>
                                    <span>System Events</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                    </div>
                                    <span>Trade Execution</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                                    </div>
                                    <span>Error Tracking</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-container" v-else>
                        <div class="settings-card" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                                <h3>Activity Log</h3>
                            </div>
                            <div class="settings-card-body" style="max-height: 600px; overflow-y: auto;">
                                <div v-for="activity in activities" :key="'log-' + activity.id" style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-light);">
                                    <div class="activity-icon" :class="activity.type" style="width: 32px; height: 32px;">
                                        <svg v-if="activity.type === 'success'" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                        <svg v-else-if="activity.type === 'danger'" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 13px; font-weight: 500;">{{ activity.title }}</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">{{ activity.time }}</div>
                                    </div>
                                </div>
                                <div v-if="activities.length === 0" class="empty-state" style="padding: 40px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                                    <div style="margin-top: 12px;">No activity logs yet</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Logs View -->
                
                <!-- Trade History Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'history' }">
                    <div class="page-header">
                        <div>
                            <h1>Trade History</h1>
                            <p>View all past trades and their performance</p>
                        </div>
                        <button class="btn" @click="refreshTrades" v-if="status.bot_running">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                            Refresh
                        </button>
                    </div>
                    <div class="settings-container" v-if="!status.bot_running">
                        <div class="bot-stopped-placeholder">
                            <div class="bot-stopped-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"/>
                                    <polyline points="12 6 12 12 16 14"/>
                                </svg>
                            </div>
                            <div class="bot-stopped-title">No Trade History</div>
                            <div class="bot-stopped-subtitle">The bot needs to be running to record trade history. Start the bot to view detailed performance metrics, entry/exit prices, and profit/loss for each closed position.</div>
                            <div class="bot-stopped-actions">
                                <button v-if="!account.login" class="btn-start" @click="showMT5LoginModal = true" style="background: var(--bg-secondary); color: var(--text); border: 1px solid var(--border);">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" style="width: 18px; height: 18px; margin-right: 8px; border-radius: 3px;" />
                                    Connect MT5
                                </button>
                                <button v-else class="btn-start" @click="startBot" :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                    Start Bot
                                </button>
                                <div class="bot-stopped-status" :class="{ ready: account.login && (telegramSessionValid || status.telegram_connected) }">
                                    <span class="status-dot"></span>
                                    <span v-if="!account.login">MT5 account required</span>
                                    <span v-else-if="(telegramSessionValid || status.telegram_connected)">Ready to start</span>
                                    <span v-else>Configure Telegram first</span>
                                </div>
                            </div>
                            <div class="bot-stopped-features">
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                    </div>
                                    <span>Performance Metrics</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                    </div>
                                    <span>Profit Analysis</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                                    </div>
                                    <span>Trade Timeline</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-container" v-else>
                        <div class="settings-card" style="max-width: 100%;">
                            <div class="settings-card-body" style="padding: 0;">
                                <table v-if="activeTrades.length > 0" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Symbol</th>
                                            <th>Type</th>
                                            <th>Entry</th>
                                            <th>Exit</th>
                                            <th>P/L</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="trade in activeTrades" :key="trade.id">
                                            <td class="font-mono">{{ trade.id }}</td>
                                            <td class="symbol-cell">{{ trade.symbol }}</td>
                                            <td :class="trade.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ trade.direction }}</td>
                                            <td class="font-mono">{{ trade.entry_price }}</td>
                                            <td class="font-mono">{{ trade.exit_price || '-' }}</td>
                                            <td :class="(trade.profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ (trade.profit || 0) >= 0 ? '+' : '' }}${{ (trade.profit || 0).toFixed(2) }}
                                            </td>
                                            <td><span class="badge" :class="trade.status">{{ trade.status }}</span></td>
                                            <td style="font-size: 11px; color: var(--text-muted);">{{ trade.created_at }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="empty-state" v-else style="padding: 60px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    <div style="margin-top: 16px; font-size: 14px;">No trade history yet</div>
                                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Your completed trades will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End History View -->
                
                <!-- Statistics Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'stats' }">
                    <div class="page-header">
                        <div>
                            <h1>Statistics</h1>
                            <p>Trading performance metrics and analytics</p>
                        </div>
                    </div>
                    <div class="settings-container" v-if="!status.bot_running">
                        <div class="bot-stopped-placeholder">
                            <div class="bot-stopped-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                                </svg>
                            </div>
                            <div class="bot-stopped-title">No Statistics Available</div>
                            <div class="bot-stopped-subtitle">The bot needs to be running to generate performance statistics. Start the bot to track your win rate, profit/loss, drawdown, and other key metrics.</div>
                            <div class="bot-stopped-actions">
                                <button v-if="!account.login" class="btn-start" @click="showMT5LoginModal = true" style="background: var(--bg-secondary); color: var(--text); border: 1px solid var(--border);">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" style="width: 18px; height: 18px; margin-right: 8px; border-radius: 3px;" />
                                    Connect MT5
                                </button>
                                <button v-else class="btn-start" @click="startBot" :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid)">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                    Start Bot
                                </button>
                                <div class="bot-stopped-status" :class="{ ready: account.login && (telegramSessionValid || status.telegram_connected) }">
                                    <span class="status-dot"></span>
                                    <span v-if="!account.login">MT5 account required</span>
                                    <span v-else-if="(telegramSessionValid || status.telegram_connected)">Ready to start</span>
                                    <span v-else>Configure Telegram first</span>
                                </div>
                            </div>
                            <div class="bot-stopped-features">
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><rect width="4" height="7" x="7" y="10" rx="1"/><rect width="4" height="12" x="15" y="5" rx="1"/></svg>
                                    </div>
                                    <span>Win Rate Analysis</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"/><path d="M12 18V6"/></svg>
                                    </div>
                                    <span>P&L Summary</span>
                                </div>
                                <div class="bot-stopped-feature">
                                    <div class="bot-stopped-feature-icon">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/><path d="M12 8v4"/><path d="M12 16h.01"/></svg>
                                    </div>
                                    <span>Risk Metrics</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-container" v-else>
                        <div class="settings-grid">
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                                    <h3>Performance Summary</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Total Trades</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ stats.total_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Winning Trades</label>
                                        <span style="font-size: 18px; font-weight: 600; color: var(--success);">{{ stats.winning_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Losing Trades</label>
                                        <span style="font-size: 18px; font-weight: 600; color: var(--danger);">{{ stats.losing_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Win Rate</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ (stats.win_rate || 0).toFixed(1) }}%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                    <h3>Profit & Loss</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Total Profit</label>
                                        <span style="font-size: 18px; font-weight: 600;" :class="(stats.total_profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ (stats.total_profit || 0) >= 0 ? '+' : '' }}${{ (stats.total_profit || 0).toFixed(2) }}
                                        </span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Today's P/L</label>
                                        <span style="font-size: 18px; font-weight: 600;" :class="account.profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}
                                        </span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Current Drawdown</label>
                                        <span style="font-size: 18px; font-weight: 600;" :style="{ color: (risk.current_drawdown || 0) > 3 ? 'var(--danger)' : 'inherit' }">
                                            {{ (risk.current_drawdown || 0).toFixed(2) }}%
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>
                                    <h3>Account Info</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Balance</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.balance) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Equity</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.equity) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Free Margin</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.free_margin) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Leverage</label>
                                        <span style="font-size: 18px; font-weight: 600;">1:{{ account.leverage || 0 }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Stats View -->
                
                <!-- Signals Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'signals' }">
                    <div class="page-header">
                        <div>
                            <h1>Trading Signals</h1>
                            <p>Track signal performance and channel analytics</p>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button class="btn btn-secondary" @click="showSignalChart = !showSignalChart">
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                                {{ showSignalChart ? 'Hide Chart' : 'Show Chart' }}
                            </button>
                            <button class="btn" @click="loadSignalMessages" :disabled="loadingSignals">
                                <span v-if="loadingSignals" class="spinner spinner-dark"></span>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="settings-container">
                        <!-- Compact Single-Row Filters -->
                        <div class="signal-filters-compact">
                            <!-- Channel Dropdown -->
                            <div class="filter-dropdown-compact" @click.stop>
                                <button @click="showChannelDropdown = !showChannelDropdown" class="dropdown-btn-compact">
                                    <template v-if="signalChannelFilter">
                                        <img v-if="hasChannelPhoto(signalChannelFilter)" :src="'/api/telegram/channel/' + signalChannelFilter + '/photo'" @error="$event.target.style.display='none'">
                                        <div v-else class="channel-placeholder">{{ getChannelInitials(signalChannelFilter, 0) }}</div>
                                    </template>
                                    <div v-else class="channel-stack">
                                        <img v-if="settings.telegram.signal_channels[0] && hasChannelPhoto(settings.telegram.signal_channels[0])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[0] + '/photo'" @error="$event.target.style.display='none'">
                                        <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[0] ? getChannelInitials(settings.telegram.signal_channels[0], 0) : 'A' }}</div>
                                        <img v-if="settings.telegram.signal_channels[1] && hasChannelPhoto(settings.telegram.signal_channels[1])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[1] + '/photo'" @error="$event.target.style.display='none'">
                                        <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[1] ? getChannelInitials(settings.telegram.signal_channels[1], 1) : 'B' }}</div>
                                        <img v-if="settings.telegram.signal_channels[2] && hasChannelPhoto(settings.telegram.signal_channels[2])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[2] + '/photo'" @error="$event.target.style.display='none'">
                                        <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[2] ? getChannelInitials(settings.telegram.signal_channels[2], 2) : 'C' }}</div>
                                    </div>
                                    <span>{{ signalChannelFilter ? getChannelName(signalChannelFilter, 0) : 'All Channels (' + settings.telegram.signal_channels.length + ')' }}</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" :style="{ transform: showChannelDropdown ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }"><path d="m6 9 6 6 6-6"/></svg>
                                </button>
                                <div v-if="showChannelDropdown" class="dropdown-menu-compact" @click.stop>
                                    <div class="dropdown-item-compact" :class="{ active: signalChannelFilter === '' }" @click="selectChannel(''); showChannelDropdown = false">
                                        <div class="channel-stack">
                                            <img v-if="settings.telegram.signal_channels[0] && hasChannelPhoto(settings.telegram.signal_channels[0])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[0] + '/photo'" @error="$event.target.style.display='none'">
                                            <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[0] ? getChannelInitials(settings.telegram.signal_channels[0], 0) : 'A' }}</div>
                                            <img v-if="settings.telegram.signal_channels[1] && hasChannelPhoto(settings.telegram.signal_channels[1])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[1] + '/photo'" @error="$event.target.style.display='none'">
                                            <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[1] ? getChannelInitials(settings.telegram.signal_channels[1], 1) : 'B' }}</div>
                                            <img v-if="settings.telegram.signal_channels[2] && hasChannelPhoto(settings.telegram.signal_channels[2])" :src="'/api/telegram/channel/' + settings.telegram.signal_channels[2] + '/photo'" @error="$event.target.style.display='none'">
                                            <div v-else class="channel-placeholder">{{ settings.telegram.signal_channels[2] ? getChannelInitials(settings.telegram.signal_channels[2], 2) : 'C' }}</div>
                                        </div>
                                        <span>All Channels</span>
                                        <svg v-if="signalChannelFilter === ''" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                                    </div>
                                    <div v-for="channelId in settings.telegram.signal_channels" :key="'dropdown-'+channelId" class="dropdown-item-compact" :class="{ active: signalChannelFilter === channelId }" @click="selectChannel(channelId); showChannelDropdown = false">
                                        <img v-if="hasChannelPhoto(channelId)" :src="'/api/telegram/channel/' + channelId + '/photo'" :alt="getChannelName(channelId, 0)" @error="$event.target.style.display='none'">
                                        <div v-else class="channel-placeholder">{{ getChannelInitials(channelId, 0) }}</div>
                                        <span>{{ getChannelName(channelId, 0) }}</span>
                                        <svg v-if="signalChannelFilter === channelId" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="20 6 9 17 4 12"/></svg>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Date Range Selector -->
                            <div style="position: relative;" @click.stop>
                                <button @click="showDateDropdown = !showDateDropdown" class="date-range-btn">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>
                                    <span>{{ getDateRangeLabel() }}</span>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" :style="{ transform: showDateDropdown ? 'rotate(180deg)' : 'rotate(0deg)', transition: 'transform 0.2s' }"><path d="m6 9 6 6 6-6"/></svg>
                                </button>
                                <div v-if="showDateDropdown" class="date-range-dropdown" @click.stop>
                                    <div class="date-presets">
                                        <button @click="setDatePreset('week')" class="date-preset-btn" :class="{ active: isDatePresetActive('week') }">This Week</button>
                                        <button @click="setDatePreset('month')" class="date-preset-btn" :class="{ active: isDatePresetActive('month') }">This Month</button>
                                        <button @click="setDatePreset('year')" class="date-preset-btn" :class="{ active: isDatePresetActive('year') }">This Year</button>
                                    </div>
                                    <div class="date-inputs">
                                        <div class="date-input-row">
                                            <span class="date-input-label">From</span>
                                            <input type="date" v-model="signalStartDate" @change="loadSignalMessages" class="date-input">
                                        </div>
                                        <div class="date-input-row">
                                            <span class="date-input-label">To</span>
                                            <input type="date" v-model="signalEndDate" @change="loadSignalMessages" class="date-input">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Status Pills -->
                            <div class="filter-pills">
                                <button @click="setStatusFilter('')" class="filter-pill" :class="{ active: signalStatusFilter === '' }">
                                    All <span class="pill-count">{{ signalMessages.length }}</span>
                                </button>
                                <button @click="setStatusFilter('executed')" class="filter-pill" :class="{ active: signalStatusFilter === 'executed' }">
                                    Executed <span class="pill-count">{{ getStatusCount('executed') }}</span>
                                </button>
                                <button @click="setStatusFilter('active')" class="filter-pill" :class="{ active: signalStatusFilter === 'active' }">
                                    Active <span class="pill-count">{{ getStatusCount('active') }}</span>
                                </button>
                                <button @click="setStatusFilter('pending')" class="filter-pill" :class="{ active: signalStatusFilter === 'pending' }">
                                    Pending <span class="pill-count">{{ getStatusCount('pending') }}</span>
                                </button>
                                <button @click="setStatusFilter('closed')" class="filter-pill" :class="{ active: signalStatusFilter === 'closed' }">
                                    Closed <span class="pill-count">{{ getStatusCount('closed') }}</span>
                                </button>
                            </div>
                            
                            <!-- Clear Filters -->
                            <button 
                                v-if="signalStartDate || signalEndDate || signalStatusFilter || signalChannelFilter" 
                                @click="clearAllFilters" 
                                class="btn btn-secondary"
                                style="height: 34px; padding: 0 14px; font-size: 12px; display: flex; align-items: center; gap: 6px; white-space: nowrap; margin-left: auto;"
                            >
                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                                Clear filter
                            </button>
                        </div>
                        
                        <!-- Channel Analytics Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-label">Total Signals</div>
                                <div class="stat-value">{{ signalAnalytics.total_signals || 0 }}</div>
                                <div class="stat-sub">{{ getChannelName(signalChannelFilter, 0) }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Executed</div>
                                <div class="stat-value">{{ signalAnalytics.executed_signals || 0 }}</div>
                                <div class="stat-sub">{{ signalAnalytics.total_signals > 0 ? ((signalAnalytics.executed_signals / signalAnalytics.total_signals) * 100).toFixed(1) : 0 }}% rate</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Win Rate</div>
                                <div class="stat-value" :class="(signalAnalytics.win_rate || 0) >= 60 ? 'positive' : (signalAnalytics.win_rate || 0) >= 40 ? '' : 'negative'">{{ (signalAnalytics.win_rate || 0).toFixed(1) }}%</div>
                                <div class="stat-sub">{{ Math.round((signalAnalytics.closed_signals || 0) * ((signalAnalytics.win_rate || 0) / 100)) }}/{{ signalAnalytics.closed_signals || 0 }} closed</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total Profit</div>
                                <div class="stat-value" :class="(signalAnalytics.total_profit || 0) >= 0 ? 'positive' : 'negative'">{{ (signalAnalytics.total_profit || 0) >= 0 ? '+' : '' }}${{ (signalAnalytics.total_profit || 0).toFixed(2) }}</div>
                                <div class="stat-sub">Avg: ${{ (signalAnalytics.avg_profit || 0).toFixed(2) }}</div>
                            </div>
                        </div>
                        
                        <!-- Chart View -->
                        <div v-if="showSignalChart" class="settings-card" style="max-width: 100%; margin-bottom: 24px;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 3v18h18"/><rect width="4" height="7" x="7" y="10" rx="1"/><rect width="4" height="12" x="15" y="5" rx="1"/></svg>
                                <h3>Performance Chart</h3>
                            </div>
                            <div class="settings-card-body" style="padding: 40px; text-align: center; color: var(--text-muted);">
                                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" style="opacity: 0.5; margin-bottom: 16px;"><path d="M3 3v18h18"/><path d="m19 9-5 5-4-4-3 3"/></svg>
                                <p style="font-size: 14px; margin-bottom: 8px;">Chart visualization coming soon</p>
                                <p style="font-size: 12px; opacity: 0.7;">Visual analytics for signal performance and profit trends</p>
                            </div>
                        </div>
                        
                        <div class="settings-card" style="max-width: 100%;">
                            <div class="settings-card-body" style="padding: 0;">
                                <div v-if="loadingSignals" style="padding: 60px; text-align: center;">
                                    <div class="spinner" style="margin: 0 auto 16px;"></div>
                                    <p style="color: var(--text-muted);">Loading signals...</p>
                                </div>
                                <div v-else-if="filteredSignalMessages.length > 0" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 16px; padding: 20px;">
                                    <div v-for="signal in filteredSignalMessages" :key="signal.id" style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 12px; padding: 16px; transition: all 0.2s;">
                                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                            <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--bg-tertiary); display: flex; align-items: center; justify-content: center; flex-shrink: 0; overflow: hidden;">
                                                <img :src="'/api/telegram/channel/' + signal.channel_id + '/photo'" :alt="signal.channel_name" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
                                                <span style="display: none; font-size: 14px; font-weight: 600; color: var(--text);">{{ signal.channel_name.substring(0, 2).toUpperCase() }}</span>
                                            </div>
                                            <div style="flex: 1; min-width: 0;">
                                                <div style="font-weight: 600; font-size: 13px; margin-bottom: 2px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">{{ signal.channel_name }}</div>
                                                <div style="font-size: 10px; color: var(--text-muted); font-family: 'JetBrains Mono', monospace;">{{ new Date(signal.timestamp).toLocaleString() }}</div>
                                            </div>
                                            <div style="display: flex; flex-direction: column; align-items: flex-end; gap: 4px;">
                                                <span style="padding: 4px 10px; border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;" :style="{ background: signal.direction === 'BUY' ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)', color: signal.direction === 'BUY' ? 'var(--success)' : 'var(--danger)' }">{{ signal.direction }}</span>
                                                <span v-if="signal.status === 'tp3_hit'" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(34, 197, 94, 0.1); color: var(--success); border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;"><svg width="10" height="10" fill="currentColor" viewBox="0 0 20 20"><path d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"/></svg>TP3</span>
                                                <span v-else-if="signal.status === 'sl_hit'" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(239, 68, 68, 0.1); color: var(--danger); border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;"><svg width="10" height="10" fill="currentColor" viewBox="0 0 20 20"><path d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"/></svg>SL</span>
                                                <span v-else-if="signal.status === 'active'" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(59, 130, 246, 0.1); color: var(--accent); border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;"><span style="width: 6px; height: 6px; background: currentColor; border-radius: 50%;"></span>ACTIVE</span>
                                                <span v-else-if="signal.status === 'pending'" style="display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; background: rgba(251, 191, 36, 0.1); color: var(--warning); border-radius: 6px; font-size: 10px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.3px;">PENDING</span>
                                            </div>
                                        </div>
                                        <div style="font-size: 16px; font-weight: 700; color: var(--text); margin-bottom: 12px;">{{ signal.symbol }}</div>
                                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px; margin-bottom: 12px;">
                                            <div v-if="signal.entry_min" style="display: flex; justify-content: space-between; padding: 8px 10px; background: var(--bg); border-radius: 6px; border: 1px solid var(--border);">
                                                <span style="color: var(--text-muted); font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px;">Entry</span>
                                                <span style="color: var(--text); font-weight: 600; font-family: 'JetBrains Mono', monospace;">{{ signal.entry_min }}</span>
                                            </div>
                                            <div v-if="signal.stop_loss" style="display: flex; justify-content: space-between; padding: 8px 10px; background: var(--bg); border-radius: 6px; border: 1px solid var(--border);">
                                                <span style="color: var(--text-muted); font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px;">SL</span>
                                                <span style="color: var(--text); font-weight: 600; font-family: 'JetBrains Mono', monospace;">{{ signal.stop_loss }}</span>
                                            </div>
                                            <div v-if="signal.take_profit_1" style="display: flex; justify-content: space-between; padding: 8px 10px; background: var(--bg); border-radius: 6px; border: 1px solid var(--border);">
                                                <span style="color: var(--text-muted); font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px;">TP1</span>
                                                <span style="color: var(--text); font-weight: 600; font-family: 'JetBrains Mono', monospace;">{{ signal.take_profit_1 }}</span>
                                            </div>
                                            <div v-if="signal.take_profit_2" style="display: flex; justify-content: space-between; padding: 8px 10px; background: var(--bg); border-radius: 6px; border: 1px solid var(--border);">
                                                <span style="color: var(--text-muted); font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px;">TP2</span>
                                                <span style="color: var(--text); font-weight: 600; font-family: 'JetBrains Mono', monospace;">{{ signal.take_profit_2 }}</span>
                                            </div>
                                            <div v-if="signal.take_profit_3" style="display: flex; justify-content: space-between; padding: 8px 10px; background: var(--bg); border-radius: 6px; border: 1px solid var(--border);">
                                                <span style="color: var(--text-muted); font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.3px;">TP3</span>
                                                <span style="color: var(--text); font-weight: 600; font-family: 'JetBrains Mono', monospace;">{{ signal.take_profit_3 }}</span>
                                            </div>
                                        </div>
                                        <div v-if="signal.total_profit !== null" style="padding: 10px; background: var(--bg); border: 1px solid var(--border); border-radius: 6px; text-align: center; margin-bottom: 12px;">
                                            <span style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.3px;">Profit: </span>
                                            <span style="font-size: 16px; font-weight: 700;" :style="{ color: signal.total_profit >= 0 ? 'var(--success)' : 'var(--danger)' }">{{ signal.total_profit >= 0 ? '+' : '' }}${{ signal.total_profit.toFixed(2) }}</span>
                                        </div>
                                        <button @click="signal.expanded = !signal.expanded" class="btn btn-sm btn-secondary" style="width: 100%; font-size: 11px; padding: 8px;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                                            {{ signal.expanded ? 'Hide Message' : 'Show Message' }}
                                        </button>
                                        <div v-if="signal.expanded" style="margin-top: 12px; padding: 12px; background: var(--bg); border-radius: 8px; border: 1px solid var(--border); font-size: 11px; color: var(--text-muted); line-height: 1.5; white-space: pre-wrap; word-wrap: break-word; max-height: 100px; overflow-y: auto;">{{ signal.text }}</div>
                                    </div>
                                </div>
                                <div v-else style="padding: 80px 20px; text-align: center; color: var(--text-muted); background: var(--bg-secondary); border-radius: 12px; margin: 20px;">
                                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="64" height="64" style="opacity: 0.5; margin: 0 auto 16px;"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>
                                    <p style="font-size: 16px; font-weight: 500; margin-bottom: 8px;">No trading signals yet</p>
                                    <p style="font-size: 13px; opacity: 0.7;">Signals from your channels will appear here</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Signals View -->
                
            </div>
        </div>
        
        <!-- Notifications -->
        <div class="notifications">
            <transition-group name="notification">
                <div v-for="notif in notifications" :key="notif.id" :class="['notification', notif.type, { removing: notif.removing }]">
                    <div class="notif-icon">
                        <svg v-if="notif.type === 'success'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg v-else-if="notif.type === 'error'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                        <svg v-else-if="notif.type === 'warning'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    </div>
                    <div class="notif-content">
                        <div class="notif-title">{{ getNotifTitle(notif.type) }}</div>
                        <div class="notif-message">{{ notif.message }}</div>
                    </div>
                    <button class="close-btn" @click="dismissNotification(notif.id)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
            </transition-group>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
</body>
</html>
