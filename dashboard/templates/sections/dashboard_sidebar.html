<!-- Sidebar (Only visible on Dashboard Overview) -->
                <aside class="sidebar" v-if="activeNavItem === 'dashboard'">
                    <!-- Connection Status -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Connections
                        </div>
                        <div class="connection-cards">
                            <!-- MetaTrader 5 Connection Card -->
                            <div class="connection-card" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading', failed: !status.mt5_connected && status.bot_running }">
                                <div class="connection-card-logo mt5-logo">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" width="32" height="32" style="border-radius: 6px;" />
                                    <div class="connection-dot" :class="{ active: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading' }"></div>
                                </div>
                                <div class="connection-card-info">
                                    <div class="connection-card-row">
                                        <span class="connection-card-name">MetaTrader 5</span>
                                    </div>
                                    <div class="connection-card-status" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, failed: !status.mt5_connected && status.bot_running }">
                                        <span v-if="connectionSteps.mt5 === 'loading'" class="status-connecting">
                                            <span class="connecting-dots"><span></span><span></span><span></span></span>
                                            Connecting
                                        </span>
                                        <span v-else-if="account.login && !status.bot_running && !status.mt5_connected" style="color: var(--success);">Ready</span>
                                        <span v-else>[[ getMT5StatusText ]]</span>
                                    </div>
                                </div>
                                <button v-if="account.login" class="btn-connection-action" @click="showMT5LoginModal = true" title="Manage">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                                    Manage
                                </button>
                                <button v-else class="btn-connection-action btn-connect" @click="showMT5LoginModal = true" title="Connect">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                </button>
                            </div>
                        </div>
                        <button v-if="status.bot_running && (!status.mt5_connected || !status.telegram_connected)" class="btn btn-retry" @click="retryConnection" :disabled="loading.reconnect" style="margin-top: 10px;">
                            <span v-if="loading.reconnect" class="spinner spinner-dark"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                            [[ loading.reconnect ? 'Reconnecting...' : 'Retry Connection' ]]
                        </button>
                    </div>
                    
                    <!-- Trading Settings -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                            Trading
                        </div>
                        <div class="trading-inline-settings">
                            <!-- Default Lot Size -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.default_lot_size' && startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                <span class="inline-edit-label">Lot Size</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.default_lot_size'">
                                    <span>[[ settings.trading.default_lot_size ]]</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.01" min="0.01" max="100" @keyup.enter="saveEdit('trading', 'default_lot_size')" @keyup.escape="cancelEdit" placeholder="Lots" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'default_lot_size')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Spread -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_spread_pips' && startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                <span class="inline-edit-label">Max Spread</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_spread_pips'">
                                    <span>[[ settings.trading.max_spread_pips ]] pips</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_spread_pips')" @keyup.escape="cancelEdit" placeholder="pips" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_spread_pips')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Open Trades -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_open_trades' && startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                <span class="inline-edit-label">Max Trades</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_open_trades'">
                                    <span>[[ settings.trading.max_open_trades ]]</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="1" min="1" max="50" @keyup.enter="saveEdit('trading', 'max_open_trades')" @keyup.escape="cancelEdit" placeholder="Max" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_open_trades')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Daily Drawdown -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_daily_drawdown_percent' && startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                <span class="inline-edit-label">Max Drawdown</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_daily_drawdown_percent'">
                                    <span>[[ settings.trading.max_daily_drawdown_percent ]]%</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_daily_drawdown_percent')" @keyup.escape="cancelEdit" placeholder="%" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_daily_drawdown_percent')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Signal Channels -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Signal Channels
                            <span class="badge" style="margin-left: auto;">[[ settings.telegram.signal_channels.length ]]</span>
                            <button class="btn btn-secondary btn-sm" @click="openChannelSearchModal" style="font-size: 10px; padding: 4px 8px; margin-left: 6px;">
                                <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                Add
                            </button>
                        </div>
                        <!-- Loading state -->
                        <div v-if="loadingChannels && telegramChannels.length === 0" class="channel-skeleton-grid">
                            <div v-for="i in 6" :key="'skel-'+i" class="channel-skeleton-item">
                                <div class="channel-skeleton-avatar"></div>
                                <div class="channel-skeleton-name"></div>
                            </div>
                        </div>
                        <!-- Show channel list with verification badge and capturing indicator -->
                        <div v-else-if="settings.telegram.signal_channels.length > 0" class="sidebar-channels-wrapper">
                            <div class="channel-row" v-for="(channelId, index) in settings.telegram.signal_channels" :key="'chan-' + index">
                                <div class="channel-avatar" :class="{ 'has-photo': hasChannelPhoto(channelId) }" :style="getChannelPhoto(channelId)">
                                    <span v-if="!hasChannelPhoto(channelId)">[[ getChannelInitials(channelId, index) ]]</span>
                                    <div v-if="status.bot_running && status.telegram_connected" class="active-pulse"></div>
                                </div>
                                <div class="channel-content">
                                    <div class="channel-name-row">
                                        <span class="name">[[ getChannelName(channelId, index) ]]</span>
                                        <svg v-if="isChannelVerified(channelId)" class="verified-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M8.603 3.799A4.49 4.49 0 0 1 12 2.25c1.357 0 2.573.6 3.397 1.549a4.49 4.49 0 0 1 3.498 1.307 4.491 4.491 0 0 1 1.307 3.497A4.49 4.49 0 0 1 21.75 12a4.49 4.49 0 0 1-1.549 3.397 4.491 4.491 0 0 1-1.307 3.497 4.491 4.491 0 0 1-3.497 1.307A4.49 4.49 0 0 1 12 21.75a4.49 4.49 0 0 1-3.397-1.549 4.49 4.49 0 0 1-3.498-1.306 4.491 4.491 0 0 1-1.307-3.498A4.49 4.49 0 0 1 2.25 12c0-1.357.6-2.573 1.549-3.397a4.49 4.49 0 0 1 1.307-3.497 4.49 4.49 0 0 1 3.497-1.307Zm7.007 6.387a.75.75 0 1 0-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 0 0-1.06 1.06l2.25 2.25a.75.75 0 0 0 1.14-.094l3.75-5.25Z" clip-rule="evenodd" /></svg>
                                    </div>
                                    <div class="channel-meta-row" style="display: flex; align-items: center; gap: 4px;">
                                        <span class="id">[[ getChannelDisplayId(channelId) ]]</span>
                                        <template v-if="getChannelInfo(channelId)?.participants_count">
                                            <span class="dot-separator"></span>
                                            <span style="font-size: 10px; opacity: 0.8;">[[ formatNumberCompact(getChannelInfo(channelId).participants_count) ]] members</span>
                                        </template>
                                    </div>
                                </div>
                                <button class="channel-remove-action" @click="removeSignalChannelById(channelId)" title="Remove source">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                </button>
                            </div>
                        </div>
                        <!-- No channels configured -->
                        <div v-else class="empty-channels">
                            No channels configured
                        </div>
                    </div>
                </aside>
