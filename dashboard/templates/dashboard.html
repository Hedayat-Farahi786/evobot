<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EvoBot - Trading Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.4/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        
        const firebaseConfig = {
            apiKey: "AIzaSyClrXVHM5xP4FqZKsjaqN7VEXAsGwNeax4",
            authDomain: "evobot-8.firebaseapp.com",
            databaseURL: "https://evobot-8-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "evobot-8",
            storageBucket: "evobot-8.firebasestorage.app",
            messagingSenderId: "349123654411",
            appId: "1:349123654411:web:afc01b90aa06984c74e80e",
            measurementId: "G-Q1BRXP7KRE"
        };
        
        const app = initializeApp(firebaseConfig);
        window.firebaseDB = getDatabase(app);
        window.firebaseRef = ref;
        window.firebaseOnValue = onValue;
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            /* Premium Dark Theme */
            --bg: #0a0a0b;
            --bg-secondary: #111113;
            --bg-hover: #18181b;
            --bg-elevated: #141416;
            --border: #27272a;
            --border-light: #1f1f23;
            --text: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --accent: #fafafa;
            --accent-hover: #e4e4e7;
            --success: #22c55e;
            --success-bg: rgba(34, 197, 94, 0.1);
            --danger: #ef4444;
            --danger-bg: rgba(239, 68, 68, 0.1);
            --warning: #f59e0b;
            --warning-bg: rgba(245, 158, 11, 0.1);
            --radius: 10px;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.4);
            --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #fafafa, #e4e4e7);
            --gradient-success: linear-gradient(135deg, #22c55e, #10b981);
            --gradient-danger: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .font-mono {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
        }
        
        /* Main Layout - Single View */
        .app {
            display: grid;
            grid-template-rows: 56px 1fr;
            height: 100vh;
            margin-left: 260px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            z-index: 1;
        }
        
        .app.navbar-collapsed {
            margin-left: 68px;
        }
        
        /* Header */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
            position: relative;
            gap: 24px;
            transition: all 0.3s ease;
        }
        
        .header.bot-active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.03));
            border-bottom-color: rgba(16, 185, 129, 0.2);
        }
        
        .header-left {
            flex-shrink: 0;
        }
        
        .header-center {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 24px;
            flex: 1;
        }
        
        .status-pill {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            transition: all 0.2s ease;
        }
        
        .status-pill:hover {
            background: var(--bg-hover);
        }
        
        .status-pill.active {
            background: rgba(16, 185, 129, 0.1);
            border-color: rgba(16, 185, 129, 0.3);
            color: #10b981;
        }
        
        .uptime-pill {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .uptime-pill .uptime-value {
            font-variant-numeric: tabular-nums;
            min-width: 50px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            transition: all 0.3s ease;
        }
        
        .status-dot.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
            animation: pulse-dot 2s infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% { box-shadow: 0 0 8px var(--success); }
            50% { box-shadow: 0 0 12px var(--success), 0 0 20px rgba(34, 197, 94, 0.3); }
        }
        
        .status-dot.error {
            background: var(--danger);
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .header-actions .btn {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .header-actions .btn svg {
            width: 14px;
            height: 14px;
        }
        
        .header-actions .btn-icon {
            padding: 6px;
        }
        
        .syncing-indicator {
            position: fixed;
            top: 12px;
            right: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 11px;
            color: var(--text-muted);
            z-index: 1000;
            animation: fadeIn 0.2s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .syncing-indicator .spinner {
            width: 12px;
            height: 12px;
        }
        
        .btn {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: var(--radius);
            font-size: 13px;
            font-weight: 500;
            border: 1px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }
        
        .btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.3) 0%, transparent 70%);
            opacity: 0;
            transform: scale(0);
            transition: all 0.4s ease;
        }
        
        .btn:hover:not(:disabled) {
            background: var(--bg-hover);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12);
        }
        
        .btn:active:not(:disabled) {
            transform: translateY(1px) scale(0.97);
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.15);
            transition: all 0.05s ease;
        }
        
        .btn:active:not(:disabled)::before {
            opacity: 1;
            transform: scale(2.5);
        }
        
        .btn-primary {
            background: #fafafa;
            color: #09090b;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #e4e4e7;
            border-color: #e4e4e7;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .btn-danger {
            background: var(--gradient-danger);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(239, 68, 68, 0.25);
        }
        
        .btn-danger:hover:not(:disabled) {
            background: #dc2626;
            border-color: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.35);
        }
        
        .btn-danger:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
            border-color: var(--border);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.15);
            border-color: var(--accent);
            color: var(--accent);
        }
        
        .btn-secondary:active:not(:disabled) {
            background: rgba(255, 255, 255, 0.12);
        }
        
        /* Light theme overrides */
        :root.light-theme {
            --bg: #ffffff;
            --bg-secondary: #fafafa;
            --bg-hover: #f4f4f5;
            --bg-elevated: #ffffff;
            --border: #e4e4e7;
            --border-light: #f4f4f5;
            --text: #09090b;
            --text-secondary: #71717a;
            --text-muted: #a1a1aa;
            --accent: #18181b;
            --accent-hover: #27272a;
        }
        
        :root.light-theme .btn-secondary {
            background: rgba(0, 0, 0, 0.05);
            color: var(--text);
        }
        
        :root.light-theme .btn-secondary:hover:not(:disabled) {
            background: rgba(0, 0, 0, 0.1);
        }
        
        .btn-icon {
            padding: 8px;
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-icon:hover {
            background: var(--bg-hover);
            color: var(--accent);
            border-color: var(--accent);
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 11px;
            gap: 6px;
        }
        
        .btn-success {
            background: var(--gradient-success);
            color: white;
            border-color: transparent;
            box-shadow: 0 2px 8px rgba(34, 197, 94, 0.25);
        }
        
        .btn-success:hover:not(:disabled) {
            background: #16a34a;
            border-color: #16a34a;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(34, 197, 94, 0.35);
        }
        
        .btn-running {
            cursor: default;
            animation: pulse-success 2s infinite;
        }
        
        @keyframes pulse-success {
            0%, 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
            50% { box-shadow: 0 0 0 6px rgba(34, 197, 94, 0); }
        }
        
        .btn-starting {
            animation: pulse-loading 1s infinite;
        }
        
        @keyframes pulse-loading {
            0%, 100% { opacity: 0.85; }
            50% { opacity: 1; }
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .btn.loading {
            pointer-events: none;
            opacity: 0.85;
        }
        
        .btn-close {
            padding: 4px 10px;
            font-size: 11px;
        }
        
        /* Confirmation Modal */
        .confirm-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(4px);
            animation: fadeIn 0.2s ease;
        }
        
        .confirm-modal {
            background: var(--bg);
            border-radius: 16px;
            width: 90%;
            max-width: 400px;
            padding: 24px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalIn 0.2s ease;
        }
        
        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95) translateY(10px); }
            to { opacity: 1; transform: scale(1) translateY(0); }
        }
        
        .confirm-icon {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
        }
        
        .confirm-icon.start {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }
        
        .confirm-icon.stop {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .confirm-icon.logout {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .confirm-title {
            font-size: 18px;
            font-weight: 600;
            text-align: center;
            margin-bottom: 8px;
        }
        
        .confirm-message {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .confirm-actions {
            display: flex;
            gap: 12px;
        }
        
        .confirm-actions .btn {
            flex: 1;
            justify-content: center;
            padding: 12px 16px;
        }
        
        /* Connection Error Modal Styles */
        .connection-error-modal {
            background: var(--bg);
            border-radius: 16px;
            width: 90%;
            max-width: 520px;
            padding: 0;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: modalIn 0.2s ease;
            overflow: hidden;
        }
        
        .connection-error-header {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
            padding: 24px;
            text-align: center;
            border-bottom: 1px solid var(--border);
        }
        
        .connection-error-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: rgba(239, 68, 68, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 16px;
            color: var(--danger);
        }
        
        .connection-error-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 4px;
        }
        
        .connection-error-subtitle {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .connection-error-body {
            padding: 20px 24px;
        }
        
        .connection-status-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }
        
        .connection-status-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border);
        }
        
        .connection-status-item.success {
            border-color: rgba(34, 197, 94, 0.3);
            background: rgba(34, 197, 94, 0.05);
        }
        
        .connection-status-item.failed {
            border-color: rgba(239, 68, 68, 0.3);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .connection-status-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .connection-status-icon.success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }
        
        .connection-status-icon.failed {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .connection-status-icon.pending {
            background: rgba(245, 158, 11, 0.15);
            color: var(--warning);
        }
        
        .connection-status-info {
            flex: 1;
        }
        
        .connection-status-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        
        .connection-status-message {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }
        
        .connection-troubleshoot {
            background: var(--bg-secondary);
            border-radius: 10px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        
        .troubleshoot-title {
            font-size: 12px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .troubleshoot-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .troubleshoot-item {
            font-size: 12px;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 8px;
            line-height: 1.4;
        }
        
        .troubleshoot-item svg {
            flex-shrink: 0;
            margin-top: 2px;
            color: var(--accent);
        }
        
        .connection-error-footer {
            padding: 16px 24px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 12px;
        }
        
        .connection-error-footer .btn {
            flex: 1;
            justify-content: center;
        }

        /* Trading Inline Settings */
        .trading-inline-settings {
            padding: 4px 0;
        }

        /* Inline Edit Styles */
        .inline-edit-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-light);
            transition: all 0.15s ease;
            pointer-events: auto;
            cursor: pointer;
        }
        
        .inline-edit-row:last-child {
            border-bottom: none;
        }
        
        .inline-edit-row:hover {
            background: rgba(0,0,0,0.02);
            margin: 0 -8px;
            padding: 8px;
            border-radius: 4px;
        }
        
        .inline-edit-label {
            font-size: 12px;
            color: var(--text-secondary);
            flex-shrink: 0;
        }
        
        .inline-edit-value {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .inline-edit-value span {
            font-size: 13px;
            font-weight: 500;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .inline-edit-value .masked {
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
        }
        
        .edit-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            opacity: 0.5;
            pointer-events: auto;
            position: relative;
            z-index: 10;
        }
        
        .inline-edit-row:hover .edit-btn {
            opacity: 1;
        }
        
        .edit-btn:hover {
            background: var(--bg-hover);
            color: var(--text);
            opacity: 1;
        }
        
        .inline-edit-input {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            max-width: 180px;
        }
        
        .inline-edit-input input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--accent);
            border-radius: 4px;
            font-size: 12px;
            font-family: inherit;
            background: var(--bg);
            color: var(--text);
            min-width: 0;
        }
        
        .inline-edit-input input:focus {
            outline: none;
            border-color: var(--success);
            box-shadow: 0 0 0 2px rgba(34, 197, 94, 0.2);
        }
        
        .inline-edit-input input::placeholder {
            color: var(--text-muted);
        }
        
        .confirm-btn, .cancel-btn {
            width: 24px;
            height: 24px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            pointer-events: auto;
            position: relative;
            z-index: 10;
        }
        
        .confirm-btn {
            background: var(--success);
            color: white;
        }
        
        .confirm-btn:hover {
            background: #16a34a;
        }
        
        .cancel-btn {
            background: var(--bg-hover);
            color: var(--text-secondary);
        }
        
        .cancel-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        /* Channel Management Styles */
        .channel-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        .channel-list-compact {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 8px 0;
        }
        
        .channel-chip {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            font-size: 12px;
            color: var(--text);
            transition: all 0.2s ease;
            flex-shrink: 0;
        }
        
        .channel-chip:hover {
            background: var(--bg-hover);
            border-color: var(--accent);
            transform: translateY(-1px);
        }
        
        .channel-chip-icon {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3f3f46, #27272a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            position: relative;
        }
        
        .channel-chip-info {
            flex: 1;
            min-width: 0;
        }
        
        .channel-chip-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .channel-chip-id {
            font-size: 10px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .live-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            font-size: 9px;
            padding: 2px 6px;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            color: #10b981;
            border-radius: 10px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border: 1px solid rgba(16, 185, 129, 0.3);
            animation: livePulse 2s ease-in-out infinite;
        }
        
        .live-badge .live-dot {
            width: 6px;
            height: 6px;
            background: #10b981;
            border-radius: 50%;
            animation: liveDot 1.5s ease-in-out infinite;
        }
        
        @keyframes livePulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.2); }
            50% { box-shadow: 0 0 8px 2px rgba(16, 185, 129, 0.15); }
        }
        
        @keyframes liveDot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }
        
        .channel-chip.active {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(16, 185, 129, 0.02));
            border-color: rgba(16, 185, 129, 0.2);
        }
        
        .channel-chip.active .channel-chip-icon {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.1));
            border-color: rgba(16, 185, 129, 0.3);
        }
        
        .refresh-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            margin-left: 6px;
        }
        
        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text);
        }
        
        .refresh-btn.spinning svg {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .channel-loading {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px;
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .loading-spinner {
            width: 14px;
            height: 14px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        /* Telegram User Badge in Topbar */
        .telegram-user-badge {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 6px 12px 6px 6px;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--border);
            border-radius: 24px;
            margin-right: 8px;
        }
        
        .telegram-user-badge.connected {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), transparent);
        }
        
        .tg-user-avatar {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0088cc, #00a2e8);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }
        
        .tg-user-info {
            display: flex;
            flex-direction: column;
            gap: 1px;
        }
        
        .tg-user-name {
            font-size: 12px;
            font-weight: 500;
            color: var(--text);
            line-height: 1.2;
        }
        
        .tg-user-meta {
            font-size: 10px;
            color: var(--text-muted);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .tg-connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            margin-left: 4px;
        }
        
        .tg-connection-dot.active {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
            animation: connectionPulse 2s ease-in-out infinite;
        }
        
        @keyframes connectionPulse {
            0%, 100% { box-shadow: 0 0 4px rgba(16, 185, 129, 0.3); }
            50% { box-shadow: 0 0 12px rgba(16, 185, 129, 0.6); }
        }
        
        /* Verification Badge */
        .verified-badge {
            margin-left: 4px;
            vertical-align: middle;
            filter: drop-shadow(0 1px 2px rgba(59, 130, 246, 0.3));
        }
        
        /* Capturing Indicator */
        .channel-chip.capturing {
            position: relative;
        }
        
        .capturing-pulse {
            position: absolute;
            top: 50%;
            right: -3px;
            transform: translateY(-50%);
            width: 7px;
            height: 7px;
            background: #10b981;
            border-radius: 50%;
            border: 1.5px solid var(--bg);
            animation: capturingPulse 2s ease-in-out infinite;
        }
        
        @keyframes capturingPulse {
            0%, 100% { transform: translateY(-50%) scale(1); opacity: 1; }
            50% { transform: translateY(-50%) scale(1.2); opacity: 0.8; }
        }
        
        .channel-chip-meta {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        /* Right side status indicator */
        .channel-status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: auto;
            padding-left: 8px;
        }
        
        .capturing-dot-right {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            box-shadow: 0 0 6px rgba(16, 185, 129, 0.5);
            animation: capturingDotRight 2s ease-in-out infinite;
        }
        
        @keyframes capturingDotRight {
            0%, 100% { opacity: 1; box-shadow: 0 0 6px rgba(16, 185, 129, 0.5); }
            50% { opacity: 0.7; box-shadow: 0 0 10px rgba(16, 185, 129, 0.7); }
        }
        
        .capturing-badge {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            font-size: 9px;
            padding: 1px 4px;
            background: transparent;
            color: var(--text-muted);
            border-radius: 4px;
            font-weight: 400;
            letter-spacing: 0.2px;
            opacity: 0.7;
        }
        
        .capturing-dot {
            width: 4px;
            height: 4px;
            background: #10b981;
            border-radius: 50%;
            animation: capturingDot 1.5s ease-in-out infinite;
        }
        
        @keyframes capturingDot {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .empty-channels {
            font-size: 11px;
            color: var(--text-muted);
            padding: 12px;
            text-align: center;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px dashed var(--border);
        }
        
        .channel-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            font-size: 12px;
            transition: all 0.15s ease;
        }
        
        .channel-item:hover {
            background: rgba(255, 255, 255, 0.06);
        }
        
        .channel-item .channel-name {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text);
            font-size: 11px;
        }
        
        .channel-item .remove-btn {
            width: 20px;
            height: 20px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            opacity: 0;
            transition: all 0.15s ease;
            pointer-events: auto;
        }
        
        .channel-item:hover .remove-btn {
            opacity: 1;
        }
        
        .channel-item .remove-btn:hover {
            background: var(--danger);
            color: white;
        }
        
        .add-channel-row {
            display: flex;
            gap: 6px;
            margin-top: 8px;
        }
        
        /* Scrollable Activity List */
        .activity-list.scrollable {
            max-height: 280px;
            overflow-y: auto;
            padding-right: 4px;
        }
        
        .activity-list.scrollable::-webkit-scrollbar {
            width: 4px;
        }
        
        .activity-list.scrollable::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 2px;
        }
        
        .activity-list.scrollable::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }
        
        .activity-list.scrollable::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Badge styling */
        .badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 18px;
            height: 18px;
            padding: 0 6px;
            font-size: 10px;
            font-weight: 600;
            background: linear-gradient(135deg, var(--accent), #8b5cf6);
            color: white;
            border-radius: 10px;
        }
        
        .add-channel-row input {
            flex: 1;
            padding: 6px 10px;
            border: 1px solid var(--border);
            border-radius: 4px;
            font-size: 12px;
            background: var(--bg);
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .add-channel-row input:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .add-channel-row input::placeholder {
            color: var(--text-muted);
        }
        
        .add-channel-row .add-btn {
            padding: 6px 12px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            pointer-events: auto;
        }
        
        .add-channel-row .add-btn:hover {
            background: var(--text);
        }
        
        .add-channel-row .add-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .channel-section-label {
            font-size: 11px;
            color: var(--text-muted);
            margin: 12px 0 6px 0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .channel-section-label:first-child {
            margin-top: 0;
        }
        
        /* Sidebar Settings Section */
        .sidebar-settings-section {
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            position: relative;
            z-index: 1;
        }
        
        .sidebar-settings-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            padding: 8px 10px;
            margin-bottom: 0;
            background: var(--bg-hover);
            border-radius: 6px;
            transition: all 0.15s ease;
            user-select: none;
            position: relative;
            z-index: 2;
        }
        
        .sidebar-settings-header:hover {
            background: var(--border);
        }
        
        .sidebar-settings-header:active {
            background: var(--border-light);
            transform: scale(0.99);
        }
        
        .sidebar-settings-header:hover .sidebar-title {
            color: var(--text);
        }
        
        .sidebar-settings-header .sidebar-title {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 0;
            transition: color 0.15s ease;
            pointer-events: none;
        }
        
        .sidebar-settings-header > div {
            pointer-events: none;
        }
        
        .collapse-icon {
            transition: transform 0.25s ease;
            pointer-events: none;
        }
        
        .collapse-icon.collapsed {
            transform: rotate(-90deg);
        }
        
        .sidebar-settings-content {
            overflow: hidden;
            transition: max-height 0.35s ease-out, opacity 0.3s ease-out, padding 0.3s ease-out;
            padding-top: 10px;
            pointer-events: auto;
            max-height: 0;
            opacity: 0;
        }
        
        .sidebar-settings-content.collapsed {
            max-height: 0 !important;
            opacity: 0;
            padding-top: 0;
        }
        
        .sidebar-settings-content.expanded-telegram {
            max-height: 400px;
            opacity: 1;
        }
        
        .sidebar-settings-content.expanded-broker {
            max-height: 300px;
            opacity: 1;
        }
        
        .sidebar-settings-content.expanded-trading {
            max-height: 300px;
            opacity: 1;
        }
        
        .sidebar-settings-content.expanded-channels {
            max-height: 500px;
            opacity: 1;
        }
        
        /* Status indicator for settings */
        .settings-status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 500;
        }
        
        .settings-status.configured {
            background: rgba(34, 197, 94, 0.1);
            color: var(--success);
        }
        
        .settings-status.missing {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
        }
        
        /* Connection Progress */
        .connection-progress {
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 12px 16px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
        }
        
        .progress-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .progress-icon.pending {
            background: var(--bg-hover);
            color: var(--text-muted);
        }
        
        .progress-icon.loading {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }
        
        .progress-icon.success {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }
        
        .progress-icon.error {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .progress-spinner {
            width: 12px;
            height: 12px;
            border: 2px solid rgba(59, 130, 246, 0.3);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        /* Sidebar expanded width */
        .sidebar {
            width: 340px;
        }
        
        /* Main Content */
        .main {
            display: grid;
            grid-template-columns: 1fr 340px;
            overflow: hidden;
        }
        
        /* Center Content */
        .content {
            display: flex;
            flex-direction: column;
            padding: 20px 24px;
            gap: 16px;
            overflow: hidden;
        }
        
        /* Stats Row */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 12px;
        }
        
        .stat-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .stat-card:hover {
            border-color: var(--accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .stat-card.loading .stat-value,
        .stat-card.loading .stat-sub {
            color: transparent;
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-hover) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 4px;
        }
        
        .stat-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
        }
        
        .stat-value.positive { color: var(--success); }
        .stat-value.negative { color: var(--danger); }
        
        .stat-sub {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 4px;
        }
        
        /* Trades Table */
        .trades-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
            min-height: 0;
            margin-top: 20px;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--bg-secondary);
        }
        
        .section-title {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            font-weight: 600;
        }
        
        .badge {
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
            background: var(--bg-hover);
            color: var(--text-secondary);
        }
        
        .table-wrapper {
            flex: 1;
            overflow-y: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        th {
            padding: 10px 12px;
            text-align: left;
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid var(--border-light);
            font-variant-numeric: tabular-nums;
        }
        
        tr:hover td {
            background: var(--bg-secondary);
        }
        
        .symbol-cell {
            font-weight: 600;
        }
        
        .direction-buy {
            color: var(--success);
            font-weight: 600;
        }
        
        .direction-sell {
            color: var(--danger);
            font-weight: 600;
        }
        
        .profit-positive {
            color: var(--success);
            font-weight: 600;
        }
        
        .profit-negative {
            color: var(--danger);
            font-weight: 600;
        }
        
        /* Signal Group Styles */
        .signal-group {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            margin-bottom: 12px;
            overflow: hidden;
        }
        
        .signal-group-header {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 14px;
            background: var(--bg-tertiary);
            cursor: pointer;
            transition: background 0.15s;
        }
        
        .signal-group-header:hover {
            background: var(--bg-hover);
        }
        
        .signal-group.collapsed .signal-group-body {
            display: none;
        }
        
        .signal-group-expand {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            transition: transform 0.2s;
        }
        
        .signal-group.collapsed .signal-group-expand {
            transform: rotate(-90deg);
        }
        
        .signal-channel-avatar {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            flex-shrink: 0;
        }
        
        .signal-channel-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .signal-channel-avatar svg {
            width: 16px;
            height: 16px;
            color: var(--text-muted);
        }
        
        .signal-group-info {
            flex: 1;
            min-width: 0;
        }
        
        .signal-group-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .signal-group-title .symbol-badge {
            background: var(--bg);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
        }
        
        .signal-group-title .count-badge {
            background: var(--primary);
            color: white;
            padding: 1px 6px;
            border-radius: 10px;
            font-size: 10px;
            font-weight: 600;
        }
        
        .signal-group-meta {
            font-size: 11px;
            color: var(--text-muted);
            margin-top: 1px;
        }
        
        .signal-group-stats {
            display: flex;
            align-items: center;
            gap: 12px;
            text-align: right;
        }
        
        .view-toggle {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px;
            background: var(--bg-tertiary);
            border-radius: 6px;
        }
        
        .view-toggle-btn {
            padding: 6px 10px;
            border: none;
            background: transparent;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 12px;
            transition: all 0.15s;
        }
        
        .view-toggle-btn:hover {
            color: var(--text);
        }
        
        .view-toggle-btn.active {
            background: var(--bg);
            color: var(--text);
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        
        .signal-stat {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
        }
        
        .signal-stat-label {
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .signal-stat-value {
            font-size: 13px;
            font-weight: 600;
        }
        
        .signal-group-body {
            padding: 0;
            border-top: 1px solid var(--border);
        }
        
        .signal-group-body table {
            margin: 0;
            font-size: 12px;
        }
        
        .signal-group-body table th {
            padding: 8px 10px;
            font-size: 10px;
        }
        
        .signal-group-body table td {
            padding: 8px 10px;
        }
        
        .signal-group-body table thead {
            background: var(--bg-secondary);
        }
        
        .positions-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .positions-header h3 {
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-close {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
        }
        
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--text-muted);
            text-align: center;
        }
        
        .empty-state i {
            margin-bottom: 12px;
            opacity: 0.5;
        }
        
        /* Bot Stopped Placeholder */
        .bot-stopped-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 60vh;
            padding: 48px 24px;
            text-align: center;
        }
        
        .bot-stopped-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg));
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 24px;
            position: relative;
        }
        
        .bot-stopped-icon svg {
            width: 36px;
            height: 36px;
            color: var(--text-muted);
            opacity: 0.6;
        }
        
        .bot-stopped-icon::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            border: 1px dashed var(--border);
            opacity: 0.5;
        }
        
        .bot-stopped-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }
        
        .bot-stopped-subtitle {
            font-size: 13px;
            color: var(--text-muted);
            max-width: 380px;
            line-height: 1.5;
            margin-bottom: 32px;
        }
        
        .bot-stopped-actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
        }
        
        .bot-stopped-actions .btn-start {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 28px;
            font-size: 14px;
            font-weight: 500;
            background: var(--text);
            color: var(--bg);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .bot-stopped-actions .btn-start:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .bot-stopped-actions .btn-start:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .bot-stopped-features {
            display: flex;
            gap: 32px;
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid var(--border);
        }
        
        .bot-stopped-feature {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            opacity: 0.7;
        }
        
        .bot-stopped-feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bot-stopped-feature-icon svg {
            width: 18px;
            height: 18px;
            color: var(--text-muted);
        }
        
        .bot-stopped-feature span {
            font-size: 11px;
            color: var(--text-muted);
            font-weight: 500;
        }
        
        .bot-stopped-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 11px;
            color: var(--text-muted);
            padding: 6px 12px;
            background: var(--bg-secondary);
            border-radius: 20px;
            border: 1px solid var(--border);
        }
        
        .bot-stopped-status .status-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #71717a;
        }
        
        .bot-stopped-status.ready .status-dot {
            background: #10b981;
        }
        
        /* Loading states for bot starting */
        .bot-stopped-icon.is-loading {
            animation: pulse 2s ease-in-out infinite;
        }
        
        .bot-stopped-icon.is-loading::before {
            animation: rotate 3s linear infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-spinner-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-steps {
            display: flex;
            flex-direction: column;
            gap: 12px;
            text-align: left;
            max-width: 280px;
        }
        
        .loading-step {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 13px;
            color: var(--text-muted);
            opacity: 0.4;
            transition: all 0.3s ease;
        }
        
        .loading-step.active {
            opacity: 1;
            color: var(--text);
        }
        
        .loading-step.done {
            opacity: 0.6;
        }
        
        .loading-step.done .step-icon {
            background: #10b981;
            color: white;
        }
        
        .loading-step .step-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .loading-step.active .step-icon {
            background: var(--text);
            color: var(--bg);
            border-color: var(--text);
        }

        /* Sidebar */
        .sidebar {
            border-left: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            background: linear-gradient(180deg, var(--bg-secondary), var(--bg));
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--border) transparent;
        }
        
        .sidebar::-webkit-scrollbar {
            width: 6px;
        }
        
        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .sidebar::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        .sidebar::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
        
        .sidebar-section {
            padding: 16px;
            border-bottom: 1px solid var(--border);
        }
        
        .sidebar-title {
            font-size: 11px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .sidebar-title svg {
            color: var(--accent);
            opacity: 0.8;
        }
        
        /* Account Details Premium Styling */
        .account-details {
            background: transparent;
            border: none;
            border-radius: 0;
            padding: 4px 0;
        }
        
        .account-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.03);
        }
        
        .account-row:last-child {
            border-bottom: none;
        }
        
        .account-label {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .account-value {
            font-size: 12px;
            font-weight: 500;
            color: var(--text);
            font-family: 'JetBrains Mono', monospace;
        }
        
        .account-value.connected {
            color: var(--success);
        }
        
        .account-value.profit {
            color: var(--success);
        }
        
        .account-value.loss {
            color: var(--danger);
        }
        
        /* Connection Cards - Modern SaaS Style */
        .connection-cards {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .connection-card {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .connection-card.connected {
            border-color: rgba(16, 185, 129, 0.3);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), transparent);
        }
        
        .connection-card.ready {
            border-color: rgba(113, 113, 122, 0.25);
            background: linear-gradient(135deg, rgba(113, 113, 122, 0.04), transparent);
        }
        
        .connection-card.connecting {
            border-color: rgba(59, 130, 246, 0.3);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), transparent);
        }
        
        .connection-card.failed {
            border-color: rgba(239, 68, 68, 0.2);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.03), transparent);
        }
        
        .connection-card-logo {
            position: relative;
            flex-shrink: 0;
        }
        
        .connection-card-logo svg {
            display: block;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .connection-card-logo .connection-dot {
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--text-muted);
            border: 2px solid var(--bg);
            transition: all 0.3s ease;
        }
        
        .connection-card-logo .connection-dot.active {
            background: #10b981;
            box-shadow: 0 0 8px rgba(16, 185, 129, 0.5);
        }
        
        .connection-card-logo .connection-dot.ready {
            background: #71717a;
            box-shadow: 0 0 6px rgba(113, 113, 122, 0.4);
        }
        
        .connection-card-logo .connection-dot.connecting {
            background: #3b82f6;
            animation: dotPulse 1.5s ease-in-out infinite;
        }
        
        @keyframes dotPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        .connection-card-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }
        
        .connection-card-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
        }
        
        .connection-card-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 6px;
        }
        
        .ready-badge {
            font-size: 9px;
            font-weight: 500;
            color: #71717a;
            background: rgba(113, 113, 122, 0.15);
            padding: 2px 6px;
            border-radius: 4px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            flex-shrink: 0;
        }
        
        .configure-link {
            font-size: 10px;
            color: var(--primary);
            cursor: pointer;
            text-decoration: none;
            opacity: 0.8;
        }
        
        .configure-link:hover {
            opacity: 1;
            text-decoration: underline;
        }
        
        .connection-card-status {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .connection-card-status.connected {
            color: #10b981;
        }
        
        .connection-card-status.ready {
            color: #71717a;
        }
        
        .connection-card-status.failed {
            color: var(--danger);
        }
        
        .status-connecting {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            color: #3b82f6;
        }
        
        .connecting-dots {
            display: inline-flex;
            gap: 3px;
        }
        
        .connecting-dots span {
            width: 4px;
            height: 4px;
            background: #3b82f6;
            border-radius: 50%;
            animation: connectingDots 1.4s ease-in-out infinite;
        }
        
        .connecting-dots span:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .connecting-dots span:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes connectingDots {
            0%, 80%, 100% { transform: scale(0.6); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }
        
        /* Legacy Connection Status Grid - Keep for compatibility */
        .connection-status-grid {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .connection-status-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            transition: all 0.2s ease;
        }
        
        .connection-status-indicator {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            color: var(--text-muted);
            transition: all 0.3s ease;
        }
        
        .connection-status-indicator.connected {
            background: rgba(34, 197, 94, 0.1);
            border-color: rgba(34, 197, 94, 0.3);
            color: var(--success);
        }
        
        .connection-status-indicator.connecting {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
            color: #3b82f6;
        }
        
        .connection-status-indicator.warning,
        .connection-status-indicator.failed {
            background: rgba(239, 68, 68, 0.1);
            border-color: rgba(239, 68, 68, 0.3);
            color: var(--danger);
        }
        
        .connection-status-info {
            display: flex;
            flex-direction: column;
            gap: 2px;
            flex: 1;
            min-width: 0;
        }
        
        .connection-status-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .connection-status-value {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .connection-status-value.connected {
            color: var(--success);
        }
        
        .connection-status-value.warning,
        .connection-status-value.failed {
            color: var(--danger);
        }
        
        .progress-spinner-small {
            width: 14px;
            height: 14px;
            border: 2px solid var(--border);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        /* Retry Connection Button */
        .btn-retry {
            width: 100%;
            margin-top: 12px;
            justify-content: center;
            background: rgba(245, 158, 11, 0.1);
            border-color: rgba(245, 158, 11, 0.3);
            color: #b45309;
        }
        
        .btn-retry:hover:not(:disabled) {
            background: rgba(245, 158, 11, 0.2);
            border-color: rgba(245, 158, 11, 0.5);
        }
        
        .btn-retry:active:not(:disabled) {
            background: rgba(245, 158, 11, 0.3);
        }
        
        /* Account Info */
        .account-info {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .account-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .account-label {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .account-value {
            font-size: 13px;
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }
        
        /* Activity Feed */
        .activity-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }
        
        .activity-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 16px;
        }
        
        .activity-item {
            display: flex;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg);
            border: 1px solid var(--border);
            flex-shrink: 0;
        }
        
        .activity-icon.success {
            background: #dcfce7;
            border-color: #bbf7d0;
            color: var(--success);
        }
        
        .activity-icon.danger {
            background: #fee2e2;
            border-color: #fecaca;
            color: var(--danger);
        }
        
        .activity-content {
            flex: 1;
            min-width: 0;
        }
        
        .activity-title {
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .activity-time {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        /* Notifications */
        .notifications {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 3000;
            max-width: 380px;
            pointer-events: none;
        }
        
        .notification {
            pointer-events: auto;
        }
        
        .notification {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 18px;
            background: var(--bg);
            color: var(--text);
            border-radius: var(--radius);
            font-size: 13px;
            border: 1px solid var(--border);
            box-shadow: 0 8px 24px rgba(0,0,0,0.15);
            animation: slideIn 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .notification .notif-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .notification .notif-content {
            flex: 1;
            min-width: 0;
        }
        
        .notification .notif-title {
            font-weight: 600;
            margin-bottom: 2px;
        }
        
        .notification .notif-message {
            color: var(--text-muted);
            word-break: break-word;
        }
        
        .notification.success .notif-icon {
            background: rgba(34, 197, 94, 0.15);
            color: var(--success);
        }
        
        .notification.error .notif-icon {
            background: rgba(239, 68, 68, 0.15);
            color: var(--danger);
        }
        
        .notification.info .notif-icon {
            background: rgba(59, 130, 246, 0.15);
            color: #3b82f6;
        }
        
        .notification.warning .notif-icon {
            background: rgba(245, 158, 11, 0.15);
            color: #f59e0b;
        }
        
        .notification .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 4px;
            margin: -4px -4px -4px 0;
            border-radius: 4px;
            transition: all 0.15s;
        }
        
        .notification .close-btn:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        @keyframes slideIn {
            from { 
                transform: translateX(100%); 
                opacity: 0; 
            }
            to { 
                transform: translateX(0); 
                opacity: 1; 
            }
        }
        
        @keyframes slideOut {
            from { 
                transform: translateX(0); 
                opacity: 1; 
            }
            to { 
                transform: translateX(100%); 
                opacity: 0; 
            }
        }
        
        .notification.removing {
            animation: slideOut 0.25s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        /* Spinner */
        .spinner {
            width: 14px;
            height: 14px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        
        .spinner-dark {
            border: 2px solid rgba(0,0,0,0.1);
            border-top-color: var(--text);
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Loading Skeleton */
        .skeleton {
            background: linear-gradient(90deg, var(--bg-secondary) 25%, var(--bg-hover) 50%, var(--bg-secondary) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: var(--radius);
        }
        
        @keyframes shimmer {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .skeleton-text {
            height: 14px;
            width: 100%;
        }
        
        .skeleton-value {
            height: 28px;
            width: 70%;
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255, 255, 255, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .loading-spinner-lg {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        
        /* Fade transitions */
        .fade-enter-active,
        .fade-leave-active {
            transition: opacity 0.2s ease;
        }
        
        .fade-enter-from,
        .fade-leave-to {
            opacity: 0;
        }
        
        /* Page Views - Show/Hide based on active navigation */
        .page-view {
            display: none;
            flex-direction: column;
            height: 100%;
            overflow: hidden;
        }
        
        .page-view.active {
            display: flex;
        }
        
        /* Full-width content when sidebar is hidden */
        .main.full-width {
            grid-template-columns: 1fr;
        }
        
        .main.full-width .sidebar {
            display: none;
        }
        
        /* Page Header for non-dashboard pages */
        .page-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--bg);
        }
        
        .page-header h1 {
            font-size: 20px;
            font-weight: 600;
            margin: 0;
        }
        
        .page-header p {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 4px 0 0 0;
        }
        
        /* Settings Page Styles */
        .settings-container {
            flex: 1;
            overflow-y: auto;
            padding: 24px;
            background: var(--bg-secondary);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 24px;
            max-width: 1600px;
        }
        
        .settings-card {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }
        
        .settings-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 20px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
        }
        
        .settings-card-header svg {
            color: var(--text-secondary);
        }
        
        .settings-card-header h3 {
            font-size: 14px;
            font-weight: 600;
            margin: 0;
        }
        
        .settings-card-body {
            padding: 20px;
        }
        
        .settings-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-light);
        }
        
        .settings-row:last-child {
            border-bottom: none;
        }
        
        .settings-row label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .settings-row input {
            width: 200px;
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 13px;
            background: var(--bg);
            color: var(--text);
            transition: all 0.15s ease;
        }
        
        .settings-row input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(24, 24, 27, 0.1);
        }
        
        .settings-row input::placeholder {
            color: var(--text-muted);
        }
        
        /* Responsive */
        @media (max-width: 1200px) {
            .stats-row {
                grid-template-columns: repeat(3, 1fr);
            }
            .settings-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 900px) {
            .main {
                grid-template-columns: 1fr;
            }
            .sidebar {
                display: none;
            }
            
            /* Hide navbar on mobile, show hamburger instead */
            .left-navbar {
                transform: translateX(-100%);
                width: 260px;
            }
            
            .left-navbar.mobile-open {
                transform: translateX(0);
            }
            
            .app {
                margin-left: 0;
            }
        }
        
        /* Price Animation */
        .price-up {
            animation: flashGreen 0.5s;
        }
        
        .price-down {
            animation: flashRed 0.5s;
        }
        
        @keyframes flashGreen {
            0% { background: rgba(34, 197, 94, 0.2); }
            100% { background: transparent; }
        }
        
        @keyframes flashRed {
            0% { background: rgba(239, 68, 68, 0.2); }
            100% { background: transparent; }
        }
        
        /* Smooth transitions for all interactive elements */
        .status-pill {
            transition: all 0.2s ease;
        }
        
        .status-pill:hover {
            background: var(--bg-hover);
        }
        
        .sidebar-section {
            transition: all 0.2s ease;
        }
        
        .activity-item {
            transition: all 0.15s ease;
        }
        
        .activity-item:hover {
            background: var(--bg-hover);
            transform: translateX(2px);
        }
        
        /* Table row hover */
        tbody tr {
            transition: all 0.15s ease;
        }
        
        tbody tr:hover {
            background: var(--bg-hover);
        }
        
        /* Badge pulse animation for new items */
        .badge {
            transition: all 0.2s ease;
        }
        
        .badge.pulse {
            animation: badgePulse 0.5s ease;
        }
        
        @keyframes badgePulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Spin animation for refresh icon */
        .spin-animation {
            animation: spin 1s linear infinite;
        }
        
        /* Empty state animation */
        .empty-state {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: transparent;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }
        
        /* Trade Action Buttons */
        .trade-actions {
            display: flex;
            gap: 6px;
        }
        
        .btn-action {
            padding: 4px 8px;
            font-size: 11px;
            border-radius: 4px;
            border: 1px solid var(--border);
            background: var(--bg);
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .btn-action:hover {
            background: var(--bg-hover);
        }
        
        .btn-action.btn-modify {
            color: var(--text);
        }
        
        .btn-action.btn-close-trade {
            background: var(--danger);
            border-color: var(--danger);
            color: white;
        }
        
        .btn-action.btn-close-trade:hover {
            background: #dc2626;
        }
        
        /* ===== LEFT SIDEBAR / NAVBAR ===== */
        .left-navbar {
            position: fixed;
            left: 0;
            top: 0;
            bottom: 0;
            width: 260px;
            background: var(--bg);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: visible;
        }
        
        .left-navbar.collapsed {
            width: 68px;
            overflow: visible;
        }
        
        .left-navbar.collapsed .nav-text,
        .left-navbar.collapsed .nav-section-title,
        .left-navbar.collapsed .user-info,
        .left-navbar.collapsed .logo-text {
            display: none !important;
            opacity: 0;
            width: 0;
            overflow: hidden;
            white-space: nowrap;
            transition: opacity 0.2s ease, width 0.3s ease;
        }
        
        .left-navbar.collapsed .navbar-header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px 8px;
            position: relative;
            height: 64px;
        }
        
        .left-navbar.collapsed .navbar-logo {
            display: flex;
            justify-content: center;
        }
        
        .left-navbar.collapsed .navbar-logo .logo-text {
            display: none;
        }
        
        .left-navbar.collapsed .collapse-btn {
            position: absolute;
            width: 28px;
            height: 28px;
            top: 50%;
            right: -14px;
            transform: translateY(-50%);
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 50%;
            z-index: 200;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .left-navbar.collapsed .nav-item {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            margin: 2px 12px;
            gap: 0 !important;
            position: relative;
            width: calc(68px - 24px);
            height: 44px;
            box-sizing: border-box;
        }
        
        .left-navbar.collapsed .nav-item > svg {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            margin: 0 !important;
            padding: 0 !important;
            width: 20px;
            height: 20px;
        }
        
        /* Active indicator - using gradient to create left border that respects border-radius */
        .left-navbar.collapsed .nav-item.active {
            position: relative;
            background: linear-gradient(to right, var(--accent) 3px, var(--bg-hover) 3px) !important;
        }
        
        .left-navbar.collapsed .nav-sections {
            padding: 12px 0;
        }
        
        .left-navbar.collapsed .nav-badge {
            display: flex !important;
            position: absolute;
            top: 6px;
            right: 6px;
            min-width: 8px;
            height: 8px;
            padding: 0;
            font-size: 0;
            border-radius: 50%;
            background: var(--accent);
        }
        
        .left-navbar.collapsed .nav-badge.active-badge {
            background: var(--success);
            width: 8px;
        }
        
        .left-navbar.collapsed .user-profile {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 12px;
            gap: 0;
            position: relative;
            cursor: pointer;
        }
        
        /* User profile tooltip when collapsed */
        .left-navbar.collapsed .user-profile::after {
            content: 'Account';
            position: fixed;
            left: 72px;
            top: auto;
            transform: translateY(-50%);
            padding: 8px 14px;
            background: #1a1a1a;
            color: #ffffff;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2147483647;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .left-navbar.collapsed .user-profile::before {
            content: '';
            position: fixed;
            left: 64px;
            top: auto;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: #1a1a1a;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2147483647;
        }
        
        .left-navbar.collapsed .user-profile:hover::after,
        .left-navbar.collapsed .user-profile:hover::before {
            opacity: 1;
            visibility: visible;
        }
        
        .left-navbar.collapsed .user-avatar {
            margin: 0 !important;
        }
        
        .left-navbar.collapsed .user-menu-btn {
            display: none;
        }
        
        /* Navbar Header */
        .navbar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px;
            border-bottom: 1px solid var(--border);
            min-height: 64px;
            flex-shrink: 0;
        }
        
        .navbar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 1;
        }
        
        .navbar-logo .logo-icon {
            width: 36px;
            height: 36px;
            background: var(--accent);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            flex-shrink: 0;
            transition: transform 0.2s ease;
        }
        
        .navbar-logo .logo-icon:hover {
            transform: scale(1.05);
        }
        
        .navbar-logo .logo-icon svg {
            width: 20px;
            height: 20px;
        }
        
        .logo-text {
            font-weight: 700;
            font-size: 16px;
            transition: opacity 0.2s ease, width 0.3s ease;
            display: block;
        }
        
        .collapse-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-hover);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s ease;
            flex-shrink: 0;
            position: relative;
        }
        
        .collapse-btn:hover {
            background: var(--border);
            color: var(--text);
        }
        
        .collapse-btn svg {
            width: 18px;
            height: 18px;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .left-navbar.collapsed .collapse-btn svg {
            transform: rotate(180deg);
        }
        
        .logo-text {
            font-weight: 700;
            font-size: 16px;
            transition: opacity 0.2s ease, width 0.3s ease;
            display: block;
        }
        
        /* Navigation Content */
        .nav-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px 8px;
        }
        
        .nav-section {
            margin-bottom: 16px;
        }
        
        .nav-section-title {
            font-size: 10px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 8px 12px;
            margin-bottom: 4px;
            transition: opacity 0.2s ease;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 8px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            position: relative;
            margin-bottom: 2px;
        }
        
        .nav-item:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .nav-item.active {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 20px;
            background: var(--accent);
            border-radius: 0 3px 3px 0;
        }
        
        /* Tooltip on collapsed navbar */
        .left-navbar.collapsed .nav-item::after {
            content: attr(data-tooltip);
            position: fixed;
            left: 72px;
            top: auto;
            transform: translateY(-50%);
            padding: 8px 14px;
            background: #1a1a1a;
            color: #ffffff;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 500;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2147483647;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2), 0 2px 4px rgba(0, 0, 0, 0.1);
            letter-spacing: 0.2px;
        }
        
        /* Tooltip arrow */
        .left-navbar.collapsed .nav-item .tooltip-arrow,
        .left-navbar.collapsed .nav-item[data-tooltip]::before {
            content: '';
            position: fixed;
            left: 64px;
            top: auto;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: #1a1a1a;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 2147483647;
        }
        
        .left-navbar.collapsed .nav-item:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .left-navbar.collapsed .nav-item:hover::before {
            opacity: 1;
            visibility: visible;
        }
        
        /* Override active state border for collapsed - use a different element */
        .left-navbar.collapsed .nav-item.active {
            background: var(--bg-hover);
        }
        
        .left-navbar.collapsed .nav-item.active .active-indicator {
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 3px;
            height: 20px;
            background: var(--accent);
            border-radius: 0 3px 3px 0;
        }
        
        .nav-icon {
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: inherit;
        }
        
        .nav-text {
            flex: 1;
            white-space: nowrap;
            overflow: hidden;
            transition: opacity 0.2s ease, width 0.3s ease;
        }
        
        .nav-badge {
            padding: 2px 6px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 600;
            background: var(--accent);
            color: white;
            transition: all 0.2s ease;
            margin-left: auto;
        }
        
        .nav-badge.success {
            background: var(--success);
        }
        
        .nav-badge.warning {
            background: #f59e0b;
        }
        
        .nav-badge.danger {
            background: var(--danger);
        }
        
        /* Status Indicator in Nav */
        .nav-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
            margin-left: auto;
            transition: all 0.3s ease;
        }
        
        .nav-status-dot.active {
            background: var(--success);
            box-shadow: 0 0 8px var(--success);
        }
        
        .nav-status-dot.error {
            background: var(--danger);
            box-shadow: 0 0 8px var(--danger);
        }
        
        /* Divider */
        .nav-divider {
            height: 1px;
            background: var(--border);
            margin: 12px 8px;
        }
        
        /* Compact Account Section in Left Navbar */
        .navbar-account-compact {
            padding: 8px 12px;
            margin: 0 8px 8px 8px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 1px solid var(--border);
        }
        
        .navbar-account-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding-bottom: 6px;
            margin-bottom: 6px;
            border-bottom: 1px solid var(--border);
            font-size: 11px;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .navbar-account-logo {
            width: 16px;
            height: 16px;
            border-radius: 3px;
            object-fit: cover;
        }
        
        .navbar-account-value.danger {
            color: var(--danger);
        }
        
        .navbar-account-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 11px;
        }
        
        .navbar-account-row:not(:last-child) {
            border-bottom: 1px solid rgba(255,255,255,0.03);
        }
        
        .navbar-account-label {
            color: var(--text-muted);
        }
        
        .navbar-account-value {
            font-weight: 500;
            font-family: 'JetBrains Mono', monospace;
            color: var(--text);
        }
        
        .navbar-account-value.positive {
            color: var(--success);
        }
        
        .navbar-account-value.negative {
            color: var(--danger);
        }
        
        .left-navbar.collapsed .navbar-account-compact {
            display: none;
        }
        
        /* User Profile Section - Compact */
        .user-profile-section {
            border-top: 1px solid var(--border);
            padding: 10px 12px;
            margin-top: auto;
            position: relative;
        }
        
        .user-profile-compact {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 6px;
            margin: -6px;
            border-radius: 8px;
            transition: background 0.15s ease;
        }
        
        .user-profile-compact:hover {
            background: var(--bg-hover);
        }
        
        .user-avatar-small {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: linear-gradient(135deg, #3f3f46, #27272a);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            flex-shrink: 0;
        }
        
        .user-info-compact {
            flex: 1;
            min-width: 0;
        }
        
        .user-name-compact {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-username-compact {
            font-size: 11px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #71717a;
            flex-shrink: 0;
        }
        
        .user-status-dot.connected {
            background: #10b981;
            box-shadow: 0 0 6px rgba(16, 185, 129, 0.5);
        }
        
        .user-menu-btn {
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.15s ease;
            flex-shrink: 0;
            opacity: 0;
        }
        
        .user-profile-compact:hover .user-menu-btn {
            opacity: 1;
        }
        
        .user-menu-btn:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .user-menu-dropdown {
            position: absolute;
            bottom: 100%;
            left: 12px;
            right: 12px;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 6px;
            margin-bottom: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            z-index: 100;
        }
        
        .user-menu-dropdown a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 10px;
            border-radius: 6px;
            color: var(--text);
            text-decoration: none;
            font-size: 13px;
            transition: all 0.15s ease;
        }
        
        .user-menu-dropdown a:hover {
            background: var(--bg-hover);
        }
        
        .user-menu-dropdown a svg {
            color: var(--text-muted);
        }
        
        .user-menu-dropdown hr {
            border: none;
            border-top: 1px solid var(--border);
            margin: 6px 0;
        }
        
        .user-menu-dropdown a.logout-link {
            color: var(--danger);
        }
        
        .user-menu-dropdown a.logout-link svg {
            color: var(--danger);
        }
        
        .left-navbar.collapsed .user-profile-section {
            padding: 10px;
            justify-content: center;
        }
        
        .left-navbar.collapsed .user-info-compact,
        .left-navbar.collapsed .user-menu-btn {
            display: none;
        }
        
        .left-navbar.collapsed .user-profile-compact {
            justify-content: center;
        }

        /* Legacy User Profile - keeping for compatibility */
        .user-section {
            border-top: 1px solid var(--border);
            padding: 12px 8px;
            margin-top: auto;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .user-profile:hover {
            background: var(--bg-hover);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: var(--accent);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
            flex-shrink: 0;
        }
        
        .user-info {
            flex: 1;
            min-width: 0;
            transition: opacity 0.2s ease, width 0.3s ease;
        }
        
        .user-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--text);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-role {
            font-size: 11px;
            color: var(--text-muted);
        }
        
        .user-menu-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: transparent;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            transition: all 0.15s ease;
            opacity: 0;
        }
        
        .user-profile:hover .user-menu-btn {
            opacity: 1;
        }
        
        .user-menu-btn:hover {
            background: var(--border);
            color: var(--text);
        }
        
        /* User Dropdown Menu */
        .user-dropdown {
            position: absolute;
            bottom: 100%;
            left: 8px;
            right: 8px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.12);
            padding: 6px;
            margin-bottom: 8px;
            opacity: 0;
            visibility: hidden;
            transform: translateY(10px);
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .user-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 12px;
            border-radius: 6px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .dropdown-item:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .dropdown-item.danger {
            color: var(--danger);
        }
        
        .dropdown-item.danger:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        .dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 6px 0;
        }
        
        /* User Status Indicator */
        .user-status {
            font-size: 11px;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .user-status.online {
            color: var(--success);
            font-weight: 500;
        }
        
        /* User Menu Dropdown */
        .user-menu {
            position: absolute;
            bottom: 100%;
            right: 12px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            box-shadow: 0 -8px 24px rgba(0, 0, 0, 0.12);
            padding: 8px 0;
            margin-bottom: 12px;
            min-width: 160px;
            z-index: 1000;
        }
        
        .user-menu a {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.15s ease;
        }
        
        .user-menu a:hover {
            background: var(--bg-hover);
            color: var(--text);
        }
        
        .user-menu a svg {
            flex-shrink: 0;
        }
        
        .user-menu hr {
            height: 1px;
            border: none;
            background: var(--border);
            margin: 6px 0;
        }
        
        .user-menu a.logout-link {
            color: var(--danger);
        }
        
        .user-menu a.logout-link:hover {
            background: rgba(239, 68, 68, 0.1);
        }
        
        /* Nav Sections Container */
        .nav-sections {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 12px 8px;
            transition: opacity 0.2s ease;
        }
        
        /* User Profile Section - Stays at Bottom */
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.15s ease;
            border-top: 1px solid var(--border);
            margin-top: auto;
            position: relative;
        }
        
        .user-profile:hover {
            background: var(--bg-hover);
        }
        
        .user-profile:hover .user-menu-btn {
            opacity: 1;
        }
        
        /* Adjust main app layout for left navbar */
        .app-with-navbar {
            margin-left: 260px;
            transition: margin-left 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .app-with-navbar.navbar-collapsed {
            margin-left: 68px;
        }
        
        /* Mobile Overlay */
        .navbar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 99;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .navbar-overlay.show {
            opacity: 1;
            visibility: visible;
        }
        
        /* Mobile Responsive */
        @media (max-width: 1024px) {
            .left-navbar {
                transform: translateX(-100%);
            }
            
            .left-navbar.mobile-open {
                transform: translateX(0);
            }
            
            .app-with-navbar {
                margin-left: 0;
            }
            
            .app-with-navbar.navbar-collapsed {
                margin-left: 0;
            }
            
            .mobile-menu-btn {
                display: flex;
            }
        }
        
        @media (min-width: 1025px) {
            .mobile-menu-btn {
                display: none;
            }
            
            .navbar-overlay {
                display: none;
            }
        }
        
        /* Tooltip for collapsed state */
        .nav-tooltip {
            position: absolute;
            left: calc(100% + 10px);
            top: 50%;
            transform: translateY(-50%);
            background: var(--accent);
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.15s ease;
            pointer-events: none;
            z-index: 1000;
        }
        
        .nav-tooltip::before {
            content: '';
            position: absolute;
            right: 100%;
            top: 50%;
            transform: translateY(-50%);
            border: 6px solid transparent;
            border-right-color: var(--accent);
        }
        
        .left-navbar.collapsed .nav-item:hover .nav-tooltip {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Confirmation Modal -->
        <div class="confirm-overlay" v-if="showConfirmModal" @click.self="showConfirmModal = false">
            <div class="confirm-modal">
                <div class="confirm-icon" :class="confirmAction">
                    <svg v-if="confirmAction === 'start'" xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/></svg>
                </div>
                <h3 class="confirm-title">{{ confirmAction === 'start' ? 'Start Trading Bot?' : 'Stop Trading Bot?' }}</h3>
                <p class="confirm-message">
                    {{ confirmAction === 'start' 
                        ? 'The bot will connect to MT5 and start monitoring Telegram for trading signals.' 
                        : 'All active monitoring will stop. Open positions will remain but no new trades will be executed.' 
                    }}
                </p>
                <div class="confirm-actions">
                    <button class="btn" @click="showConfirmModal = false">Cancel</button>
                    <button class="btn" :class="confirmAction === 'start' ? 'btn-success' : 'btn-danger'" @click="executeConfirmedAction">
                        <span v-if="loading.start || loading.stop" class="spinner"></span>
                        <span v-else>{{ confirmAction === 'start' ? 'Start Bot' : 'Stop Bot' }}</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Logout Confirmation Modal -->
        <div class="confirm-overlay" v-if="showLogoutModal" @click.self="showLogoutModal = false">
            <div class="confirm-modal">
                <div class="confirm-icon logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                </div>
                <h3 class="confirm-title">Sign Out?</h3>
                <p class="confirm-message">Are you sure you want to sign out? You'll need to sign in again to access the dashboard.</p>
                <div class="confirm-actions">
                    <button class="btn" @click="showLogoutModal = false">Cancel</button>
                    <button class="btn btn-danger" @click="confirmLogout" :disabled="loggingOut">
                        <span v-if="loggingOut" class="spinner"></span>
                        <span v-else>Sign Out</span>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Connection Error Modal -->
        <div class="confirm-overlay" v-if="showConnectionError" @click.self="showConnectionError = false">
            <div class="connection-error-modal">
                <div class="connection-error-header">
                    <div class="connection-error-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                    </div>
                    <h3 class="connection-error-title">Connection Failed</h3>
                    <p class="connection-error-subtitle">Unable to establish all required connections</p>
                </div>
                
                <div class="connection-error-body">
                    <!-- Connection Status List -->
                    <div class="connection-status-list">
                        <div class="connection-status-item" :class="connectionErrors.mt5.status">
                            <div class="connection-status-icon" :class="connectionErrors.mt5.status">
                                <svg v-if="connectionErrors.mt5.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.mt5.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">MT5 / MetaAPI Connection</div>
                                <div class="connection-status-message">{{ connectionErrors.mt5.message }}</div>
                            </div>
                        </div>
                        
                        <div class="connection-status-item" :class="connectionErrors.telegram.status">
                            <div class="connection-status-icon" :class="connectionErrors.telegram.status">
                                <svg v-if="connectionErrors.telegram.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.telegram.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">Telegram Connection</div>
                                <div class="connection-status-message">{{ connectionErrors.telegram.message }}</div>
                            </div>
                        </div>
                        
                        <div class="connection-status-item" :class="connectionErrors.account.status">
                            <div class="connection-status-icon" :class="connectionErrors.account.status">
                                <svg v-if="connectionErrors.account.status === 'success'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                <svg v-else-if="connectionErrors.account.status === 'failed'" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>
                            </div>
                            <div class="connection-status-info">
                                <div class="connection-status-name">Trading Account</div>
                                <div class="connection-status-message">{{ connectionErrors.account.message }}</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Troubleshooting Tips -->
                    <div class="connection-troubleshoot">
                        <div class="troubleshoot-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>
                            Troubleshooting Tips
                        </div>
                        <div class="troubleshoot-list">
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Verify your MetaAPI token is valid and not expired</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Check that your MetaAPI account ID is correct</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.mt5.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Ensure your MT5 account is deployed on MetaAPI cloud</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.telegram.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Verify your Telegram API credentials are correct</span>
                            </div>
                            <div class="troubleshoot-item" v-if="connectionErrors.telegram.status === 'failed'">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Check if Telegram session needs re-authentication</span>
                            </div>
                            <div class="troubleshoot-item">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"/></svg>
                                <span>Check your internet connection and firewall settings</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="connection-error-footer">
                    <button class="btn btn-secondary" @click="showConnectionError = false; navigateTo('settings')">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
                        Check Settings
                    </button>
                    <button class="btn btn-primary" @click="retryConnection" :disabled="loading.start">
                        <span v-if="loading.start" class="spinner"></span>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                        {{ loading.start ? 'Connecting...' : 'Retry Connection' }}
                    </button>
                </div>
            </div>
        </div>
        
        <div class="app" :class="{ 'navbar-collapsed': navbarCollapsed }">
            <!-- Syncing Indicator -->
            <div v-if="loading.refresh" class="syncing-indicator">
                <span class="spinner spinner-dark"></span>
                <span>Syncing...</span>
            </div>
            
            <!-- Header -->
            <header class="header" :class="{ 'bot-active': status.bot_running }">
                <!-- Page Title / Breadcrumb -->
                <div class="header-left" style="display: flex; align-items: center; gap: 16px;">
                    <h2 style="font-size: 15px; font-weight: 600; margin: 0;">{{ getPageTitle }}</h2>
                </div>
                
                <div class="header-center">
                    <div class="status-pill" :class="{ active: status.bot_running }">
                        <span class="status-dot" :class="{ active: status.bot_running }"></span>
                        <span>{{ status.bot_running ? 'Bot Running' : 'Bot Stopped' }}</span>
                    </div>
                    <div class="status-pill uptime-pill" v-if="status.bot_running">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="10" x2="14" y1="2" y2="2"/><line x1="12" x2="15" y1="14" y2="11"/><circle cx="12" cy="14" r="8"/></svg>
                        <span class="uptime-value">{{ formatUptime(displayUptime) }}</span>
                    </div>
                </div>
                
                <div class="header-actions">
                    <!-- Theme Toggle Button -->
                    <button class="btn btn-icon" @click="toggleTheme" title="Toggle theme">
                        <svg v-if="isDarkTheme" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></svg>
                    </button>
                    
                    <!-- Start Button - show when bot is stopped -->
                    <button v-if="!status.bot_running" 
                            class="btn btn-primary" 
                            @click="startBot" 
                            :disabled="loading.start || (!status.telegram_connected && !telegramSessionValid) || (!status.mt5_connected && !account.login)">
                        <span v-if="loading.start" class="spinner"></span>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                        {{ loading.start ? 'Starting...' : 'Start' }}
                    </button>
                    
                    <!-- Refresh + Stop Button - show only when bot is running -->
                    <template v-if="status.bot_running">
                        <button class="btn" @click="refreshData" :disabled="loading.refresh" title="Refresh data">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                        </button>
                        <button class="btn btn-danger" 
                                @click="confirmStop" 
                                :disabled="loading.stop">
                            <span v-if="loading.stop" class="spinner"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="6" width="12" height="12" rx="2"/></svg>
                            {{ loading.stop ? 'Stopping...' : 'Stop' }}
                        </button>
                    </template>
                </div>
            </header>
            
            <!-- Left Sidebar Navbar -->
            <div class="left-navbar" :class="{ collapsed: navbarCollapsed }">
                <!-- Navbar Header -->
                <div class="navbar-header">
                    <div class="navbar-logo">
                        <div class="logo-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 8V4H8"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M15 13v2"/><path d="M9 13v2"/></svg>
                        </div>
                        <span class="logo-text">EvoBot</span>
                    </div>
                    <button class="collapse-btn" @click="navbarCollapsed = !navbarCollapsed" title="Toggle navbar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"/></svg>
                    </button>
                </div>
                
                <!-- Navigation Sections -->
                <nav class="nav-sections">
                    <!-- Dashboard Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Dashboard</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'dashboard' }" @click="activeNavItem = 'dashboard'" data-tooltip="Overview">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="12 3 20 7.5 20 16.5 12 21 4 16.5 4 7.5 12 3"/><polyline points="12 12 20 7.5"/><polyline points="12 12 12 21"/><polyline points="12 12 4 7.5"/></svg>
                            <span class="nav-text">Overview</span>
                            <span v-if="status.bot_running" class="nav-badge active-badge" title="Bot is running"></span>
                        </div>
                    </div>
                    
                    <!-- Trades Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Trading</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'trades' }" @click="activeNavItem = 'trades'" data-tooltip="Open Positions">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                            <span class="nav-text">Open Positions</span>
                            <span v-if="mt5Positions.length > 0" class="nav-badge">{{ mt5Positions.length }}</span>
                        </div>
                        <div class="nav-item" :class="{ active: activeNavItem === 'history' }" @click="activeNavItem = 'history'" data-tooltip="Trade History">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                            <span class="nav-text">Trade History</span>
                        </div>
                    </div>
                    
                    <!-- Stats Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Performance</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'stats' }" @click="activeNavItem = 'stats'" data-tooltip="Statistics">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                            <span class="nav-text">Statistics</span>
                        </div>
                    </div>
                    
                    <!-- Settings Section -->
                    <div class="nav-section">
                        <span class="nav-section-title">Configuration</span>
                        <div class="nav-item" :class="{ active: activeNavItem === 'settings' }" @click="activeNavItem = 'settings'" data-tooltip="Settings">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/></svg>
                            <span class="nav-text">Settings</span>
                        </div>
                        <div class="nav-item" :class="{ active: activeNavItem === 'logs' }" @click="activeNavItem = 'logs'" data-tooltip="System Logs">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                            <span class="nav-text">System Logs</span>
                        </div>
                    </div>
                </nav>
                
                <!-- MT5 Account Details -->
                <div class="navbar-account-compact">
                    <div class="navbar-account-header">
                        <img src="/assets/logos/mt5.webp" alt="MT5" class="navbar-account-logo" />
                        <span>MT5 Account</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Balance</span>
                        <span class="navbar-account-value">{{ currencySymbol }}{{ formatNumber(account.balance) }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Equity</span>
                        <span class="navbar-account-value">{{ currencySymbol }}{{ formatNumber(account.equity) }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">P/L</span>
                        <span class="navbar-account-value" :class="account.profit >= 0 ? 'positive' : 'negative'">{{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Server</span>
                        <span class="navbar-account-value">{{ account.server || '-' }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Login</span>
                        <span class="navbar-account-value">{{ account.login || '-' }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Leverage</span>
                        <span class="navbar-account-value">1:{{ account.leverage || 0 }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Margin</span>
                        <span class="navbar-account-value">{{ currencySymbol }}{{ formatNumber(account.margin) }}</span>
                    </div>
                    <div class="navbar-account-row">
                        <span class="navbar-account-label">Drawdown</span>
                        <span class="navbar-account-value" :class="(risk.current_drawdown || 0) > 3 ? 'danger' : ''">{{ (risk.current_drawdown || 0).toFixed(2) }}%</span>
                    </div>
                </div>
                
                <!-- User Profile (Bottom of Navbar) -->
                <div class="user-profile-section">
                    <div class="user-profile-compact" @click="showUserMenu = !showUserMenu">
                        <div class="user-avatar-small" :style="telegramUser.photo_path ? { backgroundImage: 'url(/api/telegram/user/photo)', backgroundSize: 'cover' } : {}">
                            <svg v-if="!telegramUser.photo_path" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                        </div>
                        <div class="user-info-compact">
                            <div class="user-name-compact">{{ telegramUser.first_name || 'User' }}</div>
                            <div class="user-username-compact" v-if="telegramUser.username">@{{ telegramUser.username }}</div>
                            <div class="user-username-compact" v-else>{{ status.telegram_connected ? 'Connected' : 'Offline' }}</div>
                        </div>
                        <button class="user-menu-btn" @click.stop="showUserMenu = !showUserMenu" title="Menu">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"/><circle cx="12" cy="5" r="1"/><circle cx="12" cy="19" r="1"/></svg>
                        </button>
                    </div>
                    <!-- User Dropdown Menu -->
                    <div v-if="showUserMenu" class="user-menu-dropdown">
                        <a href="#" @click.prevent="activeNavItem = 'settings'; showUserMenu = false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m5.08 5.08l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m5.08-5.08l4.24-4.24"/></svg>
                            Settings
                        </a>
                        <a href="#" @click.prevent="activeNavItem = 'stats'; showUserMenu = false">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                            Statistics
                        </a>
                        <hr>
                        <a href="#" @click.prevent="logout" class="logout-link">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                            Logout
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="main" :class="{ 'full-width': activeNavItem === 'settings' || activeNavItem === 'logs' || activeNavItem === 'history' || activeNavItem === 'stats' || activeNavItem === 'trades' }">
                <!-- Dashboard View (Overview) -->
                <div class="page-view" :class="{ active: activeNavItem === 'dashboard' }">
                <div class="content">
                    <!-- Bot Stopped Placeholder -->
                    <div v-if="!status.bot_running" class="bot-stopped-placeholder">
                        <div class="bot-stopped-icon" :class="{ 'is-loading': loading.start }">
                            <svg v-if="!loading.start" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 2v4"/>
                                <path d="m16.2 7.8 2.9-2.9"/>
                                <path d="M18 12h4"/>
                                <path d="m16.2 16.2 2.9 2.9"/>
                                <path d="M12 18v4"/>
                                <path d="m4.9 19.1 2.9-2.9"/>
                                <path d="M2 12h4"/>
                                <path d="m4.9 4.9 2.9 2.9"/>
                            </svg>
                            <svg v-else class="loading-spinner-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                            </svg>
                        </div>
                        <div class="bot-stopped-title">{{ loading.start ? 'Starting Bot...' : 'Trading Bot Inactive' }}</div>
                        <div class="bot-stopped-subtitle">
                            <template v-if="loading.start">
                                <div class="loading-steps">
                                    <div class="loading-step" :class="{ active: startingStep >= 1, done: startingStep > 1 }">
                                        <span class="step-icon">{{ startingStep > 1 ? '' : '1' }}</span>
                                        <span>Initializing connections...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 2, done: startingStep > 2 }">
                                        <span class="step-icon">{{ startingStep > 2 ? '' : '2' }}</span>
                                        <span>Connecting to Telegram...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 3, done: startingStep > 3 }">
                                        <span class="step-icon">{{ startingStep > 3 ? '' : '3' }}</span>
                                        <span>Connecting to MT5 broker...</span>
                                    </div>
                                    <div class="loading-step" :class="{ active: startingStep >= 4 }">
                                        <span class="step-icon">4</span>
                                        <span>Starting signal listener...</span>
                                    </div>
                                </div>
                            </template>
                            <template v-else>
                                Start the bot to begin monitoring Telegram signals and executing trades automatically on your MT5 account.
                            </template>
                        </div>
                        <div class="bot-stopped-actions" v-if="!loading.start">
                            <button class="btn-start" @click="startBot" :disabled="loading.bot || (!status.telegram_connected && !telegramSessionValid) || (!status.mt5_connected && !account.login)">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" stroke="none"><polygon points="6 3 20 12 6 21 6 3"/></svg>
                                Start Bot
                            </button>
                            <div class="bot-stopped-status" :class="{ ready: (telegramSessionValid || status.telegram_connected) && (account.login || status.mt5_connected) }">
                                <span class="status-dot"></span>
                                <span v-if="(telegramSessionValid || status.telegram_connected) && (account.login || status.mt5_connected)">Ready to start</span>
                                <span v-else>Configure connections first</span>
                            </div>
                        </div>
                        <div class="bot-stopped-features">
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                                </div>
                                <span>Signal Capture</span>
                            </div>
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                </div>
                                <span>Auto Trading</span>
                            </div>
                            <div class="bot-stopped-feature">
                                <div class="bot-stopped-feature-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/></svg>
                                </div>
                                <span>Risk Control</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Stats Row (only show when bot is running) -->
                    <div v-else>
                    <div class="stats-row">
                        <div class="stat-card">
                            <div class="stat-label">Balance</div>
                            <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.balance) }}</div>
                            <div class="stat-sub">{{ account.currency || 'USD' }}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Equity</div>
                            <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.equity) }}</div>
                            <div class="stat-sub">Free: {{ currencySymbol }}{{ formatNumber(account.free_margin) }}</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Floating P/L</div>
                            <div class="stat-value" :class="account.profit >= 0 ? 'positive' : 'negative'">
                                {{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}
                            </div>
                            <div class="stat-sub">Unrealized</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Win Rate</div>
                            <div class="stat-value">{{ stats.closed_trades > 0 ? (stats.win_rate || 0).toFixed(1) : '' }}%</div>
                            <div class="stat-sub">{{ stats.winning_trades || 0 }}/{{ stats.closed_trades || 0 }} closed</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Open Positions</div>
                            <div class="stat-value">{{ mt5Positions.length }}</div>
                            <div class="stat-sub">MT5 Account</div>
                        </div>
                    </div>
                    
                    <!-- Trades Table -->
                    <div class="trades-section">
                        <div class="section-header">
                            <div class="section-title">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <span>Open Positions</span>
                                <span class="badge">{{ mt5Positions.length }}</span>
                            </div>
                            <div style="display: flex; gap: 6px; align-items: center;">
                                <!-- View Toggle -->
                                <div class="view-toggle" v-if="mt5Positions.length > 0">
                                    <button class="view-toggle-btn" :class="{ active: groupPositionsView }" @click="setPositionsView(true)" title="Group by Signal">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                    </button>
                                    <button class="view-toggle-btn" :class="{ active: !groupPositionsView }" @click="setPositionsView(false)" title="List View">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                                    </button>
                                </div>
                                <button class="btn" @click="refreshPositions" :disabled="loading.positions" style="padding: 4px 10px; font-size: 11px;">
                                    <span v-if="loading.positions" class="spinner spinner-dark" style="width: 10px; height: 10px;"></span>
                                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                                </button>
                                <button class="btn btn-secondary" @click="navigateTo('trades')" style="padding: 4px 10px; font-size: 11px;">
                                    View All
                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>
                                </button>
                            </div>
                        </div>
                        
                        <!-- List View (Flat Table) -->
                        <div class="table-wrapper" v-if="mt5Positions.length > 0 && !groupPositionsView">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Ticket</th>
                                        <th>Symbol</th>
                                        <th>Type</th>
                                        <th>Volume</th>
                                        <th>Entry</th>
                                        <th>Current</th>
                                        <th>SL</th>
                                        <th>TP</th>
                                        <th>P/L</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="pos in mt5Positions" :key="pos.position_ticket">
                                        <td class="font-mono">{{ pos.position_ticket }}</td>
                                        <td class="symbol-cell">{{ pos.symbol }}</td>
                                        <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">
                                            {{ pos.direction }}
                                        </td>
                                        <td>{{ pos.lot_size }}</td>
                                        <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                        <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                        <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                        <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                        <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                            {{ pos.profit >= 0 ? '+' : '' }}${{ pos.profit.toFixed(2) }}
                                        </td>
                                        <td>
                                            <div class="trade-actions">
                                                <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                </button>
                                                <button class="btn-action btn-close-trade" 
                                                        @click="closePosition(pos.position_ticket)" 
                                                        :disabled="loading.trades[pos.position_ticket]"
                                                        title="Close Position">
                                                    <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                    <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                                <tfoot>
                                    <tr style="background: var(--bg-secondary); font-weight: 600;">
                                        <td colspan="8" style="text-align: right;">Total P/L:</td>
                                        <td :class="totalPnL >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ totalPnL >= 0 ? '+' : '' }}${{ totalPnL.toFixed(2) }}
                                        </td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        
                        <!-- Grouped View (Signal Cards) -->
                        <div v-if="mt5Positions.length > 0 && groupPositionsView">
                            <div v-for="(group, signalId) in groupedPositions" :key="signalId" class="signal-group" :class="{ collapsed: group.collapsed }">
                                <div class="signal-group-header" @click="group.collapsed = !group.collapsed">
                                    <div class="signal-group-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                                    </div>
                                    <div class="signal-channel-avatar">
                                        <img v-if="group.channel && group.channel.photo" :src="'/api/channels/' + group.channel.id + '/photo'" :alt="group.channel.name">
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                    </div>
                                    <div class="signal-group-info">
                                        <div class="signal-group-title">
                                            {{ group.channel ? group.channel.name : (signalId === 'manual' ? 'Manual' : group.symbol || 'Signal') }}
                                            <span class="symbol-badge" v-if="group.positions.length > 0">{{ group.positions[0].symbol }}</span>
                                            <span class="count-badge">{{ group.positions.length }}</span>
                                        </div>
                                        <div class="signal-group-meta">
                                            <span v-if="group.signal_time">{{ formatSignalTime(group.signal_time) }}</span>
                                            <span v-else>{{ group.positions[0]?.direction || 'TRADE' }}</span>
                                        </div>
                                    </div>
                                    <div class="signal-group-stats">
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">Lots</span>
                                            <span class="signal-stat-value">{{ group.total_lots.toFixed(2) }}</span>
                                        </div>
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">P/L</span>
                                            <span class="signal-stat-value" :class="group.total_profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ group.total_profit >= 0 ? '+' : '' }}${{ group.total_profit.toFixed(2) }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signal-group-body">
                                    <table>
                                        <thead>
                                            <tr>
                                                <th>Ticket</th>
                                                <th>Type</th>
                                                <th>Vol</th>
                                                <th>Entry</th>
                                                <th>Current</th>
                                                <th>P/L</th>
                                                <th></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="pos in group.positions" :key="'grp-' + pos.position_ticket">
                                                <td class="font-mono" style="font-size: 11px;">{{ pos.position_ticket }}</td>
                                                <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                                <td>{{ pos.lot_size }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                                <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                    {{ pos.profit >= 0 ? '+' : '' }}${{ pos.profit.toFixed(2) }}
                                                </td>
                                                <td>
                                                    <button class="btn-action btn-close-trade" @click.stop="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close">
                                                        <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                    </button>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Empty State -->
                        <div class="empty-state" v-if="mt5Positions.length === 0">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                            <div>No open positions</div>
                            <div style="font-size: 11px; margin-top: 4px;">Your MT5 positions will appear here</div>
                        </div>
                    </div>
                    </div><!-- End v-else wrapper -->
                </div>
                </div><!-- End Dashboard View -->
                
                <!-- Trades/Positions Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'trades' }">
                    <div class="page-header">
                        <div>
                            <h1>Open Positions</h1>
                            <p>Manage your current MT5 trading positions</p>
                        </div>
                        <div style="display: flex; gap: 8px; align-items: center;">
                            <!-- View Toggle -->
                            <div class="view-toggle" v-if="mt5Positions.length > 0">
                                <button class="view-toggle-btn" :class="{ active: groupPositionsView }" @click="setPositionsView(true)" title="Group by Signal">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="7" height="7" x="3" y="3" rx="1"/><rect width="7" height="7" x="14" y="3" rx="1"/><rect width="7" height="7" x="14" y="14" rx="1"/><rect width="7" height="7" x="3" y="14" rx="1"/></svg>
                                    Group
                                </button>
                                <button class="view-toggle-btn" :class="{ active: !groupPositionsView }" @click="setPositionsView(false)" title="List View">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" x2="21" y1="6" y2="6"/><line x1="8" x2="21" y1="12" y2="12"/><line x1="8" x2="21" y1="18" y2="18"/><line x1="3" x2="3.01" y1="6" y2="6"/><line x1="3" x2="3.01" y1="12" y2="12"/><line x1="3" x2="3.01" y1="18" y2="18"/></svg>
                                    List
                                </button>
                            </div>
                            <button class="btn" @click="refreshPositions" :disabled="loading.positions">
                                <span v-if="loading.positions" class="spinner spinner-dark"></span>
                                <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                                Refresh
                            </button>
                        </div>
                    </div>
                    <div class="settings-container">
                        <!-- Quick Stats -->
                        <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px;">
                            <div class="stat-card">
                                <div class="stat-label">Open Positions</div>
                                <div class="stat-value">{{ mt5Positions.length }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Total P/L</div>
                                <div class="stat-value" :class="totalPnL >= 0 ? 'positive' : 'negative'">
                                    {{ totalPnL >= 0 ? '+' : '' }}{{ currencySymbol }}{{ totalPnL.toFixed(2) }}
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Margin Used</div>
                                <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.margin) }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Free Margin</div>
                                <div class="stat-value">{{ currencySymbol }}{{ formatNumber(account.free_margin) }}</div>
                            </div>
                        </div>
                        
                        <!-- Grouped Positions by Signal -->
                        <div v-if="Object.keys(groupedPositions).length > 0 && groupPositionsView">
                            <div v-for="(group, signalId) in groupedPositions" :key="signalId" class="signal-group" :class="{ collapsed: group.collapsed }">
                                <div class="signal-group-header" @click="group.collapsed = !group.collapsed">
                                    <div class="signal-group-expand">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m6 9 6 6 6-6"/></svg>
                                    </div>
                                    <div class="signal-channel-avatar">
                                        <img v-if="group.channel && group.channel.photo" :src="'/api/channels/' + group.channel.id + '/photo'" :alt="group.channel.name">
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>
                                    </div>
                                    <div class="signal-group-info">
                                        <div class="signal-group-title">
                                            {{ group.channel ? group.channel.name : (signalId === 'manual' ? 'Manual Trades' : 'Unknown Signal') }}
                                            <span class="symbol-badge" v-if="group.positions.length > 0">{{ group.positions[0].symbol }}</span>
                                        </div>
                                        <div class="signal-group-meta">
                                            <span v-if="group.signal_time">{{ formatSignalTime(group.signal_time) }}</span>
                                            <span v-else>{{ group.positions.length }} position{{ group.positions.length !== 1 ? 's' : '' }}</span>
                                        </div>
                                    </div>
                                    <div class="signal-group-stats">
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">Lots</span>
                                            <span class="signal-stat-value">{{ group.total_lots.toFixed(2) }}</span>
                                        </div>
                                        <div class="signal-stat">
                                            <span class="signal-stat-label">P/L</span>
                                            <span class="signal-stat-value" :class="group.total_profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ group.total_profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ group.total_profit.toFixed(2) }}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="signal-group-body">
                                    <table style="width: 100%;">
                                        <thead>
                                            <tr>
                                                <th>Ticket</th>
                                                <th>Type</th>
                                                <th>Volume</th>
                                                <th>Entry</th>
                                                <th>Current</th>
                                                <th>SL</th>
                                                <th>TP</th>
                                                <th>P/L</th>
                                                <th>Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr v-for="pos in group.positions" :key="'grp-' + pos.position_ticket">
                                                <td class="font-mono">{{ pos.position_ticket }}</td>
                                                <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                                <td>{{ pos.lot_size }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                                <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                                <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                                <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                    {{ pos.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ pos.profit.toFixed(2) }}
                                                </td>
                                                <td>
                                                    <div class="trade-actions">
                                                        <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                        </button>
                                                        <button class="btn-action btn-close-trade" @click="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close Position">
                                                            <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- List View (Flat Table) -->
                        <div class="settings-card" v-if="mt5Positions.length > 0 && !groupPositionsView" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <h3>All Positions</h3>
                            </div>
                            <div class="settings-card-body" style="padding: 0;">
                                <table style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>Ticket</th>
                                            <th>Symbol</th>
                                            <th>Type</th>
                                            <th>Volume</th>
                                            <th>Entry</th>
                                            <th>Current</th>
                                            <th>SL</th>
                                            <th>TP</th>
                                            <th>P/L</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="pos in mt5Positions" :key="'list-' + pos.position_ticket">
                                            <td class="font-mono">{{ pos.position_ticket }}</td>
                                            <td><span class="symbol-badge">{{ pos.symbol }}</span></td>
                                            <td :class="pos.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ pos.direction }}</td>
                                            <td>{{ pos.lot_size }}</td>
                                            <td class="font-mono">{{ formatPrice(pos.entry_price, pos.symbol) }}</td>
                                            <td class="font-mono">{{ formatPrice(pos.current_price, pos.symbol) }}</td>
                                            <td class="font-mono">{{ pos.stop_loss ? formatPrice(pos.stop_loss, pos.symbol) : '-' }}</td>
                                            <td class="font-mono">{{ pos.take_profit_1 ? formatPrice(pos.take_profit_1, pos.symbol) : '-' }}</td>
                                            <td :class="pos.profit >= 0 ? 'profit-positive' : 'profit-negative'" style="font-weight: 600;">
                                                {{ pos.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ pos.profit.toFixed(2) }}
                                            </td>
                                            <td>
                                                <div class="trade-actions">
                                                    <button class="btn-action btn-modify" @click="openModifyModal(pos)" title="Modify SL/TP">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>
                                                    </button>
                                                    <button class="btn-action btn-close-trade" @click="closePosition(pos.position_ticket)" :disabled="loading.trades[pos.position_ticket]" title="Close Position">
                                                        <span v-if="loading.trades[pos.position_ticket]" class="spinner" style="width: 10px; height: 10px;"></span>
                                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- Empty State Card -->
                        <div class="settings-card" v-if="mt5Positions.length === 0" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2"/></svg>
                                <h3>Active Positions</h3>
                            </div>
                            <div class="settings-card-body" style="padding: 0;">
                                <div class="empty-state" style="padding: 60px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>
                                    <div style="margin-top: 16px; font-size: 14px;">No open positions</div>
                                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Your MT5 positions will appear here when you have active trades</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Trades View -->
                
                <!-- Sidebar (Only visible on Dashboard Overview) -->
                <aside class="sidebar" v-show="activeNavItem === 'dashboard'">
                    <!-- Connection Status -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Connections
                        </div>
                        <div class="connection-cards">
                            <!-- MetaTrader 5 Connection Card -->
                            <div class="connection-card" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading', failed: !status.mt5_connected && status.bot_running }">
                                <div class="connection-card-logo mt5-logo">
                                    <img src="/assets/logos/mt5.webp" alt="MT5" width="32" height="32" style="border-radius: 6px;" />
                                    <div class="connection-dot" :class="{ active: status.mt5_connected, ready: account.login && !status.bot_running, connecting: connectionSteps.mt5 === 'loading' }"></div>
                                </div>
                                <div class="connection-card-info">
                                    <div class="connection-card-row">
                                        <span class="connection-card-name">MetaTrader 5</span>
                                        <span v-if="account.login && !status.bot_running && !status.mt5_connected" class="ready-badge">Ready</span>
                                        <span v-else-if="!account.login && !status.mt5_connected" class="configure-link" @click="navigateTo('settings')">Configure</span>
                                    </div>
                                    <div class="connection-card-status" :class="{ connected: status.mt5_connected, ready: account.login && !status.bot_running, failed: !status.mt5_connected && status.bot_running }">
                                        <span v-if="connectionSteps.mt5 === 'loading'" class="status-connecting">
                                            <span class="connecting-dots"><span></span><span></span><span></span></span>
                                            Connecting
                                        </span>
                                        <span v-else-if="account.login && !status.bot_running && !status.mt5_connected">Logged In</span>
                                        <span v-else>{{ getMT5StatusText }}</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Telegram Connection Card -->
                            <div class="connection-card" :class="{ connected: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, connecting: connectionSteps.telegram === 'loading', failed: !status.telegram_connected && status.bot_running }">
                                <div class="connection-card-logo telegram-logo">
                                    <img src="/assets/logos/telegram.jpg" alt="Telegram" width="32" height="32" style="border-radius: 6px;" />
                                    <div class="connection-dot" :class="{ active: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, connecting: connectionSteps.telegram === 'loading' }"></div>
                                </div>
                                <div class="connection-card-info">
                                    <div class="connection-card-row">
                                        <span class="connection-card-name">Telegram</span>
                                        <span v-if="telegramSessionValid && !status.bot_running && !status.telegram_connected" class="ready-badge">Ready</span>
                                        <span v-else-if="!telegramSessionValid && !status.telegram_connected" class="configure-link" @click="navigateTo('settings')">Configure</span>
                                    </div>
                                    <div class="connection-card-status" :class="{ connected: status.telegram_connected, ready: telegramSessionValid && !status.bot_running, failed: !status.telegram_connected && status.bot_running }">
                                        <span v-if="connectionSteps.telegram === 'loading'" class="status-connecting">
                                            <span class="connecting-dots"><span></span><span></span><span></span></span>
                                            Connecting
                                        </span>
                                        <span v-else-if="telegramSessionValid && !status.bot_running && !status.telegram_connected">Logged In</span>
                                        <span v-else>{{ getTelegramStatusText }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <button v-if="status.bot_running && (!status.mt5_connected || !status.telegram_connected)" class="btn btn-retry" @click="retryConnection" :disabled="loading.reconnect" style="margin-top: 10px;">
                            <span v-if="loading.reconnect" class="spinner spinner-dark"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/></svg>
                            {{ loading.reconnect ? 'Reconnecting...' : 'Retry Connection' }}
                        </button>
                    </div>
                    
                    <!-- Trading Settings -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                            Trading
                        </div>
                        <div class="trading-inline-settings">
                            <!-- Default Lot Size -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.default_lot_size' && startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                <span class="inline-edit-label">Lot Size</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.default_lot_size'">
                                    <span>{{ settings.trading.default_lot_size }}</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'default_lot_size', settings.trading.default_lot_size)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.01" min="0.01" max="100" @keyup.enter="saveEdit('trading', 'default_lot_size')" @keyup.escape="cancelEdit" placeholder="Lots" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'default_lot_size')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Spread -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_spread_pips' && startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                <span class="inline-edit-label">Max Spread</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_spread_pips'">
                                    <span>{{ settings.trading.max_spread_pips }} pips</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_spread_pips', settings.trading.max_spread_pips)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_spread_pips')" @keyup.escape="cancelEdit" placeholder="pips" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_spread_pips')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Open Trades -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_open_trades' && startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                <span class="inline-edit-label">Max Trades</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_open_trades'">
                                    <span>{{ settings.trading.max_open_trades }}</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_open_trades', settings.trading.max_open_trades)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="1" min="1" max="50" @keyup.enter="saveEdit('trading', 'max_open_trades')" @keyup.escape="cancelEdit" placeholder="Max" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_open_trades')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            <!-- Max Daily Drawdown -->
                            <div class="inline-edit-row" @click="editingField !== 'trading.max_daily_drawdown_percent' && startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                <span class="inline-edit-label">Max Drawdown</span>
                                <div class="inline-edit-value" v-if="editingField !== 'trading.max_daily_drawdown_percent'">
                                    <span>{{ settings.trading.max_daily_drawdown_percent }}%</span>
                                    <button class="edit-btn" @click.stop="startEdit('trading', 'max_daily_drawdown_percent', settings.trading.max_daily_drawdown_percent)">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/></svg>
                                    </button>
                                </div>
                                <div class="inline-edit-input" v-else @click.stop>
                                    <input type="number" v-model="editValue" step="0.5" min="0" max="100" @keyup.enter="saveEdit('trading', 'max_daily_drawdown_percent')" @keyup.escape="cancelEdit" placeholder="%" />
                                    <button class="confirm-btn" @click="saveEdit('trading', 'max_daily_drawdown_percent')">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>
                                    </button>
                                    <button class="cancel-btn" @click="cancelEdit">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Signal Channels -->
                    <div class="sidebar-section">
                        <div class="sidebar-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                            Signal Channels
                            <button class="refresh-btn" @click="refreshChannels(true)" :class="{ spinning: loadingChannels }" title="Refresh channels">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M16 16h5v5"/></svg>
                            </button>
                            <span class="badge" style="margin-left: auto;">{{ settings.telegram.signal_channels.length }}</span>
                        </div>
                        <!-- Loading state -->
                        <div v-if="loadingChannels && telegramChannels.length === 0" class="channel-loading">
                            <div class="loading-spinner"></div>
                            <span>Loading channels...</span>
                        </div>
                        <!-- Show channel list with verification badge and capturing indicator -->
                        <div v-else-if="settings.telegram.signal_channels.length > 0" class="channel-list-compact">
                            <div class="channel-chip" :class="{ active: status.bot_running && status.telegram_connected, capturing: status.bot_running && status.telegram_connected }" v-for="(channelId, index) in settings.telegram.signal_channels" :key="'chan-' + index">
                                <div class="channel-chip-icon" :style="getChannelPhoto(channelId)">
                                    <span v-if="!hasChannelPhoto(channelId)">{{ getChannelInitials(channelId, index) }}</span>
                                </div>
                                <div class="channel-chip-info">
                                    <div class="channel-chip-name">
                                        {{ getChannelName(channelId, index) }}
                                        <!-- Verification badge -->
                                        <svg v-if="isChannelVerified(channelId)" class="verified-badge" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="#3b82f6" stroke="#fff" stroke-width="2"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
                                    </div>
                                    <div class="channel-chip-meta">
                                        <span class="channel-chip-id">ID: {{ getChannelDisplayId(channelId) }}</span>
                                    </div>
                                </div>
                                <!-- Capturing indicator on right side -->
                                <div v-if="status.bot_running && status.telegram_connected" class="channel-status-indicator">
                                    <span class="capturing-dot-right"></span>
                                </div>
                            </div>
                        </div>
                        <!-- No channels configured -->
                        <div v-else class="empty-channels">
                            No channels configured
                        </div>
                        <button class="btn btn-secondary btn-sm" @click="navigateTo('settings')" style="margin-top: 8px; width: 100%;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                            Manage Channels
                        </button>
                    </div>
                </aside>
                
                <!-- Settings Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'settings' }">
                    <div class="page-header">
                        <div>
                            <h1>Settings</h1>
                            <p>Configure your trading bot connections and preferences</p>
                        </div>
                        <button class="btn btn-primary" @click="saveAllSettings" :disabled="loading.settings">
                            <span v-if="loading.settings" class="spinner"></span>
                            <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                            Save All Settings
                        </button>
                    </div>
                    <div class="settings-container">
                        <div class="settings-grid">
                            <!-- Telegram Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>
                                    <h3>Telegram Connection</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>API ID</label>
                                        <input type="text" v-model="settings.telegram.api_id" placeholder="Enter API ID">
                                    </div>
                                    <div class="settings-row">
                                        <label>API Hash</label>
                                        <input type="password" v-model="settings.telegram.api_hash" placeholder="Enter API Hash">
                                    </div>
                                    <div class="settings-row">
                                        <label>Phone Number</label>
                                        <input type="text" v-model="settings.telegram.phone_number" placeholder="+1234567890">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- MetaApi Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="8" x="2" y="2" rx="2" ry="2"/><rect width="20" height="8" x="2" y="14" rx="2" ry="2"/><line x1="6" x2="6.01" y1="6" y2="6"/><line x1="6" x2="6.01" y1="18" y2="18"/></svg>
                                    <h3>MetaApi / MT5 Broker</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>MetaApi Token</label>
                                        <input type="password" v-model="settings.broker.metaapi_token" placeholder="Enter token">
                                    </div>
                                    <div class="settings-row">
                                        <label>Account ID</label>
                                        <input type="text" v-model="settings.broker.metaapi_account_id" placeholder="Enter account ID">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Trading Settings Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
                                    <h3>Trading Parameters</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Default Lot Size</label>
                                        <input type="number" v-model="settings.trading.default_lot_size" step="0.01" min="0.01">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Spread (pips)</label>
                                        <input type="number" v-model="settings.trading.max_spread_pips" step="0.5" min="0">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Open Trades</label>
                                        <input type="number" v-model="settings.trading.max_open_trades" step="1" min="1">
                                    </div>
                                    <div class="settings-row">
                                        <label>Max Daily Drawdown %</label>
                                        <input type="number" v-model="settings.trading.max_daily_drawdown_percent" step="0.5" min="0">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Signal Channels Card -->
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.9 19.1C1 15.2 1 8.8 4.9 4.9"/><path d="M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5"/><circle cx="12" cy="12" r="2"/><path d="M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5"/><path d="M19.1 4.9C23 8.8 23 15.1 19.1 19"/></svg>
                                    <h3>Signal Channels</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="channel-list" style="margin-bottom: 16px;">
                                        <div class="channel-item" v-for="(channel, index) in settings.telegram.signal_channels" :key="'settings-sig-' + index" style="background: var(--bg-secondary); padding: 10px 12px; margin-bottom: 8px; border-radius: 6px;">
                                            <span class="channel-name" style="font-family: 'JetBrains Mono', monospace; font-size: 12px;">{{ channel }}</span>
                                            <button class="remove-btn" @click="removeSignalChannel(index)" title="Remove" style="opacity: 1; background: var(--danger); color: white; border-radius: 4px; padding: 4px 8px;">
                                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                            </button>
                                        </div>
                                        <div v-if="settings.telegram.signal_channels.length === 0" style="padding: 20px; text-align: center; color: var(--text-muted); font-size: 13px;">
                                            No signal channels configured yet
                                        </div>
                                    </div>
                                    <div class="add-channel-row" style="display: flex; gap: 8px;">
                                        <input type="text" v-model="newSignalChannel" placeholder="Channel ID (e.g., -1001234567890)" @keyup.enter="addSignalChannel" style="flex: 1; padding: 10px 12px; border: 1px solid var(--border); border-radius: 6px; font-size: 13px;">
                                        <button class="btn btn-primary" @click="addSignalChannel" :disabled="!newSignalChannel.trim()" style="padding: 10px 16px;">
                                            Add Channel
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Settings View -->
                
                <!-- Logs Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'logs' }">
                    <div class="page-header">
                        <div>
                            <h1>System Logs</h1>
                            <p>View bot activity and system messages</p>
                        </div>
                        <button class="btn" @click="clearLogs">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                            Clear Logs
                        </button>
                    </div>
                    <div class="settings-container">
                        <div class="settings-card" style="max-width: 100%;">
                            <div class="settings-card-header">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                                <h3>Activity Log</h3>
                            </div>
                            <div class="settings-card-body" style="max-height: 600px; overflow-y: auto;">
                                <div v-for="activity in activities" :key="'log-' + activity.id" style="display: flex; align-items: center; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border-light);">
                                    <div class="activity-icon" :class="activity.type" style="width: 32px; height: 32px;">
                                        <svg v-if="activity.type === 'success'" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                                        <svg v-else-if="activity.type === 'danger'" xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-size: 13px; font-weight: 500;">{{ activity.title }}</div>
                                        <div style="font-size: 11px; color: var(--text-muted);">{{ activity.time }}</div>
                                    </div>
                                </div>
                                <div v-if="activities.length === 0" class="empty-state" style="padding: 40px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 7h16M4 12h16M4 17h16"/></svg>
                                    <div style="margin-top: 12px;">No activity logs yet</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Logs View -->
                
                <!-- Trade History Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'history' }">
                    <div class="page-header">
                        <div>
                            <h1>Trade History</h1>
                            <p>View all past trades and their performance</p>
                        </div>
                        <button class="btn" @click="refreshTrades">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
                            Refresh
                        </button>
                    </div>
                    <div class="settings-container">
                        <div class="settings-card" style="max-width: 100%;">
                            <div class="settings-card-body" style="padding: 0;">
                                <table v-if="activeTrades.length > 0" style="width: 100%;">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Symbol</th>
                                            <th>Type</th>
                                            <th>Entry</th>
                                            <th>Exit</th>
                                            <th>P/L</th>
                                            <th>Status</th>
                                            <th>Date</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="trade in activeTrades" :key="trade.id">
                                            <td class="font-mono">{{ trade.id }}</td>
                                            <td class="symbol-cell">{{ trade.symbol }}</td>
                                            <td :class="trade.direction === 'BUY' ? 'direction-buy' : 'direction-sell'">{{ trade.direction }}</td>
                                            <td class="font-mono">{{ trade.entry_price }}</td>
                                            <td class="font-mono">{{ trade.exit_price || '-' }}</td>
                                            <td :class="(trade.profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'">
                                                {{ (trade.profit || 0) >= 0 ? '+' : '' }}${{ (trade.profit || 0).toFixed(2) }}
                                            </td>
                                            <td><span class="badge" :class="trade.status">{{ trade.status }}</span></td>
                                            <td style="font-size: 11px; color: var(--text-muted);">{{ trade.created_at }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div class="empty-state" v-else style="padding: 60px;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                                    <div style="margin-top: 16px; font-size: 14px;">No trade history yet</div>
                                    <div style="font-size: 12px; color: var(--text-muted); margin-top: 4px;">Your completed trades will appear here</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End History View -->
                
                <!-- Statistics Page View -->
                <div class="page-view" :class="{ active: activeNavItem === 'stats' }">
                    <div class="page-header">
                        <div>
                            <h1>Statistics</h1>
                            <p>Trading performance metrics and analytics</p>
                        </div>
                    </div>
                    <div class="settings-container">
                        <div class="settings-grid">
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                                    <h3>Performance Summary</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Total Trades</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ stats.total_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Winning Trades</label>
                                        <span style="font-size: 18px; font-weight: 600; color: var(--success);">{{ stats.winning_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Losing Trades</label>
                                        <span style="font-size: 18px; font-weight: 600; color: var(--danger);">{{ stats.losing_trades || 0 }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Win Rate</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ (stats.win_rate || 0).toFixed(1) }}%</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" x2="12" y1="2" y2="22"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>
                                    <h3>Profit & Loss</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Total Profit</label>
                                        <span style="font-size: 18px; font-weight: 600;" :class="(stats.total_profit || 0) >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ (stats.total_profit || 0) >= 0 ? '+' : '' }}${{ (stats.total_profit || 0).toFixed(2) }}
                                        </span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Today's P/L</label>
                                        <span style="font-size: 18px; font-weight: 600;" :class="account.profit >= 0 ? 'profit-positive' : 'profit-negative'">
                                            {{ account.profit >= 0 ? '+' : '' }}{{ currencySymbol }}{{ formatNumber(account.profit) }}
                                        </span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Current Drawdown</label>
                                        <span style="font-size: 18px; font-weight: 600;" :style="{ color: (risk.current_drawdown || 0) > 3 ? 'var(--danger)' : 'inherit' }">
                                            {{ (risk.current_drawdown || 0).toFixed(2) }}%
                                        </span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <div class="settings-card-header">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1"/><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4"/></svg>
                                    <h3>Account Info</h3>
                                </div>
                                <div class="settings-card-body">
                                    <div class="settings-row">
                                        <label>Balance</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.balance) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Equity</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.equity) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Free Margin</label>
                                        <span style="font-size: 18px; font-weight: 600;">{{ currencySymbol }}{{ formatNumber(account.free_margin) }}</span>
                                    </div>
                                    <div class="settings-row">
                                        <label>Leverage</label>
                                        <span style="font-size: 18px; font-weight: 600;">1:{{ account.leverage || 0 }}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div><!-- End Stats View -->
                
            </div>
        </div>
        
        <!-- Notifications -->
        <div class="notifications">
            <transition-group name="notification">
                <div v-for="notif in notifications" :key="notif.id" :class="['notification', notif.type, { removing: notif.removing }]">
                    <div class="notif-icon">
                        <svg v-if="notif.type === 'success'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></svg>
                        <svg v-else-if="notif.type === 'error'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>
                        <svg v-else-if="notif.type === 'warning'" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3"/><path d="M12 9v4"/><path d="M12 17h.01"/></svg>
                        <svg v-else xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    </div>
                    <div class="notif-content">
                        <div class="notif-title">{{ getNotifTitle(notif.type) }}</div>
                        <div class="notif-message">{{ notif.message }}</div>
                    </div>
                    <button class="close-btn" @click="dismissNotification(notif.id)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                    </button>
                </div>
            </transition-group>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        
        createApp({
            data() {
                return {
                    ws: null,
                    isDarkTheme: false,
                    showConfirmModal: false,
                    showLogoutModal: false,
                    loggingOut: false,
                    showConnectionError: false,
                    connectionErrors: {
                        mt5: { status: 'pending', message: 'Waiting to connect...' },
                        telegram: { status: 'pending', message: 'Waiting to connect...' },
                        account: { status: 'pending', message: 'Waiting for MT5 connection...' }
                    },
                    confirmAction: 'start',
                    connectionSteps: {
                        mt5: 'pending',
                        telegram: 'pending',
                        account: 'pending'
                    },
                    expandedSections: {
                        telegram: false,
                        broker: false,
                        trading: true,
                        channels: false
                    },
                    editingField: null,
                    editValue: '',
                    newSignalChannel: '',
                    telegramFields: [
                        { key: 'api_id', label: 'API ID', masked: false, required: true },
                        { key: 'api_hash', label: 'API Hash', masked: true, required: true },
                        { key: 'phone_number', label: 'Phone', masked: false, required: true }
                    ],
                    brokerFields: [
                        { key: 'metaapi_token', label: 'Token', masked: true, required: true },
                        { key: 'metaapi_account_id', label: 'Account ID', masked: false, required: true }
                    ],
                    tradingFields: [
                        { key: 'default_lot_size', label: 'Lot Size', step: 0.01 },
                        { key: 'max_spread_pips', label: 'Max Spread', suffix: ' pips', step: 0.5 },
                        { key: 'max_open_trades', label: 'Max Trades', step: 1 },
                        { key: 'max_daily_drawdown_percent', label: 'Max Drawdown', suffix: '%', step: 0.5 }
                    ],
                    status: { 
                        bot_running: false, 
                        mt5_connected: false, 
                        telegram_connected: false,
                        uptime_seconds: 0
                    },
                    telegramSessionValid: false,
                    mt5SessionValid: false,
                    startingStep: 0,
                    telegramUser: {
                        id: null,
                        first_name: '',
                        last_name: '',
                        username: '',
                        phone: '',
                        photo_path: null,
                        premium: false,
                        api_id: null
                    },
                    account: { 
                        balance: 0, 
                        equity: 0, 
                        margin: 0, 
                        free_margin: 0, 
                        profit: 0,
                        currency: 'USD',
                        leverage: 0,
                        server: '',
                        login: 0,
                        name: ''
                    },
                    stats: { 
                        total_trades: 0, 
                        closed_trades: 0,
                        winning_trades: 0,
                        losing_trades: 0,
                        win_rate: 0, 
                        total_profit: 0, 
                        open_trades: 0,
                        last_updated: null
                    },
                    risk: { current_drawdown: 0 },
                    config: { 
                        default_lot_size: 0.01, 
                        max_spread_pips: 5.0, 
                        max_daily_drawdown_percent: 5.0, 
                        max_open_trades: 10 
                    },
                    settings: {
                        telegram: {
                            api_id: '',
                            api_hash: '',
                            phone_number: '',
                            session_name: 'evobot_session',
                            signal_channels: [],
                            signal_channels_str: '',
                            notification_channel: ''
                        },
                        broker: {
                            metaapi_token: '',
                            metaapi_account_id: '',
                            server: '',
                            login: '',
                            password: ''
                        },
                        trading: {
                            default_lot_size: 0.01,
                            max_spread_pips: 10,
                            max_open_trades: 10,
                            max_daily_drawdown_percent: 5,
                            entry_zone_tolerance: 20,
                            execute_immediately: true
                        },
                        risk: {
                            avoid_high_impact_news: true,
                            news_blackout_minutes_before: 30,
                            news_blackout_minutes_after: 15,
                            trading_start_hour: 0,
                            trading_end_hour: 24,
                            max_risk_percent_per_trade: 2
                        }
                    },
                    activeTrades: [],
                    mt5Positions: [],
                    groupedPositions: {},
                    groupPositionsView: localStorage.getItem('evobot-group-positions') !== 'false',
                    activities: [],
                    notifications: [],
                    loading: { 
                        start: false, 
                        stop: false, 
                        refresh: false,
                        positions: false,
                        settings: false,
                        trades: {},
                        initial: true,
                        reconnect: false
                    },
                    nextNotifId: 0,
                    priceCache: {},
                    startingPhase: null,
                    // Settings validation
                    settingsValidated: false,
                    settingsErrors: [],
                    showSetupWizard: false,
                    // Connection testing
                    testingTelegram: false,
                    testingBroker: false,
                    telegramTestResult: null,
                    brokerTestResult: null,
                    displayUptime: 0,
                    uptimeInterval: null,
                    // Navbar properties
                    navbarCollapsed: false,
                    activeNavItem: 'dashboard',
                    showUserMenu: false,
                    // Telegram channels
                    telegramChannels: [],
                    loadingChannels: false
                };
            },
            computed: {
                currencySymbol() {
                    const symbols = {
                        'USD': '$', 'EUR': '', 'GBP': '', 'JPY': '', 'CHF': 'Fr',
                        'AUD': 'A$', 'CAD': 'C$', 'NZD': 'NZ$', 'SGD': 'S$', 'HKD': 'HK$',
                        'ZAR': 'R', 'INR': '', 'CNY': '', 'KRW': '', 'BRL': 'R$',
                        'MXN': 'Mex$', 'PLN': 'z', 'SEK': 'kr', 'NOK': 'kr', 'DKK': 'kr',
                        'RUB': '', 'TRY': '', 'THB': '', 'MYR': 'RM', 'IDR': 'Rp'
                    };
                    return symbols[this.account.currency] || this.account.currency || '$';
                },
                totalPnL() {
                    return this.mt5Positions.reduce((sum, pos) => sum + (pos.profit || 0), 0);
                },
                hasRequiredSettings() {
                    // Check if minimum required settings are configured
                    const hasTelegram = this.settings.telegram.api_id && 
                                       this.settings.telegram.api_hash && 
                                       this.settings.telegram.phone_number &&
                                       (this.settings.telegram.signal_channels && this.settings.telegram.signal_channels.length > 0);
                    const hasBroker = this.settings.broker.metaapi_token && 
                                     this.settings.broker.metaapi_account_id;
                    return hasTelegram && hasBroker;
                },
                getMT5StatusText() {
                    if (this.status.mt5_connected) return 'Connected';
                    if (this.mt5SessionValid && !this.status.bot_running) return 'Logged In';
                    if (this.loading.reconnect) return 'Reconnecting...';
                    if (this.connectionSteps.mt5 === 'loading') return 'Connecting...';
                    if (this.connectionSteps.mt5 === 'failed') return 'Failed to Connect';
                    if (this.status.bot_running) return 'Failed to Connect';
                    return 'Not Connected';
                },
                getTelegramStatusText() {
                    if (this.status.telegram_connected) return 'Connected';
                    if (this.telegramSessionValid && !this.status.bot_running) return 'Logged In';
                    if (this.loading.reconnect) return 'Reconnecting...';
                    if (this.connectionSteps.telegram === 'loading') return 'Connecting...';
                    if (this.connectionSteps.telegram === 'failed') return 'Failed to Connect';
                    if (this.status.bot_running) return 'Failed to Connect';
                    return 'Not Connected';
                },
                getAccountStatusText() {
                    if (this.account.login > 0) return this.account.name || ('Account #' + this.account.login);
                    if (this.connectionSteps.account === 'loading') return 'Loading...';
                    if (this.status.bot_running) return 'No Account Data';
                    return 'Not Loaded';
                },
                getPageTitle() {
                    const titles = {
                        'dashboard': 'Dashboard Overview',
                        'trades': 'Open Positions',
                        'history': 'Trade History',
                        'stats': 'Statistics',
                        'settings': 'Settings',
                        'logs': 'System Logs'
                    };
                    return titles[this.activeNavItem] || 'Dashboard';
                }
            },
            methods: {
                // Theme toggle method
                toggleTheme() {
                    this.isDarkTheme = !this.isDarkTheme;
                    if (this.isDarkTheme) {
                        document.documentElement.classList.remove('light-theme');
                    } else {
                        document.documentElement.classList.add('light-theme');
                    }
                    localStorage.setItem('evobot-theme', this.isDarkTheme ? 'dark' : 'light');
                },
                
                // Format channel ID for display
                formatChannelId(channelId) {
                    const id = String(channelId);
                    if (id.startsWith('-100')) {
                        return 'ID: ' + id;
                    } else if (id.startsWith('-')) {
                        return 'ID: ' + id;
                    } else if (id.startsWith('@')) {
                        return id;
                    }
                    return 'ID: ' + id;
                },
                
                // Icon initialization methods
                initIcons() {
                    // Use requestAnimationFrame to ensure DOM is ready
                    requestAnimationFrame(() => {
                        try {
                            lucide.createIcons();
                        } catch (e) {
                            // Ignore errors from icon initialization
                        }
                    });
                },
                debouncedInitIcons() {
                    if (this._iconTimeout) {
                        clearTimeout(this._iconTimeout);
                    }
                    this._iconTimeout = setTimeout(() => {
                        this.initIcons();
                    }, 100);
                },
                formatNumber(value) {
                    if (value === null || value === undefined) return '0.00';
                    return Number(value).toLocaleString('en-US', { 
                        minimumFractionDigits: 2, 
                        maximumFractionDigits: 2 
                    });
                },
                getInitials(name) {
                    if (!name) return '?';
                    return name.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
                },
                getChannelInfo(channelId) {
                    // Normalize the channel ID for comparison - remove -100 prefix (handles both -100X and -100XX formats)
                    const normalizedId = String(channelId).replace(/^-100/, '');
                    
                    // Find matching channel in the cached list
                    return this.telegramChannels.find(ch => {
                        const cachedId = String(ch.id);
                        // Match: direct match, or with -100 prefix removed from either side
                        return cachedId === normalizedId || 
                               cachedId === String(channelId) ||
                               normalizedId.endsWith(cachedId) ||
                               cachedId.endsWith(normalizedId);
                    });
                },
                getChannelName(channelId, index) {
                    const info = this.getChannelInfo(channelId);
                    // Return title if available, otherwise show ID immediately (no "Loading..." text)
                    return info?.title || `ID: ${String(channelId).replace(/^-100/, '')}`;
                },
                getChannelInitials(channelId, index) {
                    const info = this.getChannelInfo(channelId);
                    if (info?.title) {
                        return info.title.split(' ').map(w => w[0]).join('').substring(0, 2).toUpperCase();
                    }
                    return `S${index + 1}`;
                },
                hasChannelPhoto(channelId) {
                    const info = this.getChannelInfo(channelId);
                    return info?.photo_path ? true : false;
                },
                getChannelPhoto(channelId) {
                    const info = this.getChannelInfo(channelId);
                    if (info?.photo_path) {
                        return { backgroundImage: `url(/api/telegram/channel/${info.id}/photo)`, backgroundSize: 'cover' };
                    }
                    return {};
                },
                getChannelDisplayId(channelId) {
                    const info = this.getChannelInfo(channelId);
                    return info?.id || String(channelId).replace(/^-100/, '');
                },
                isChannelVerified(channelId) {
                    const info = this.getChannelInfo(channelId);
                    return info?.verified === true;
                },
                async fetchTelegramUser() {
                    try {
                        const res = await fetch('/api/telegram/user');
                        if (res.ok) {
                            const data = await res.json();
                            if (data.user) {
                                this.telegramUser = {
                                    ...this.telegramUser,
                                    ...data.user,
                                    api_id: data.api_id
                                };
                                // Mark Telegram session as valid if we got user data
                                this.telegramSessionValid = true;
                            }
                        }
                    } catch (e) {
                        console.error('Error fetching telegram user:', e);
                    }
                },
                formatPrice(value, symbol) {
                    if (!value) return '-';
                    const digits = symbol?.includes('JPY') ? 3 : (symbol?.includes('XAU') ? 2 : 5);
                    return Number(value).toFixed(digits);
                },
                formatUptime(seconds) {
                    if (!seconds) return '0s';
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    const secs = Math.floor(seconds % 60);
                    if (hours > 0) return `${hours}h ${minutes}m`;
                    if (minutes > 0) return `${minutes}m ${secs}s`;
                    return `${secs}s`;
                },
                formatSignalTime(timestamp) {
                    if (!timestamp) return 'Unknown time';
                    const date = new Date(timestamp);
                    return date.toLocaleString('en-US', {
                        month: 'short',
                        day: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                },
                // Confirmation modal methods
                confirmStart() {
                    if (!this.hasRequiredSettings) {
                        this.expandedSections.telegram = true;
                        this.expandedSections.broker = true;
                        this.notify('Please configure Telegram and MetaApi settings first', 'warning');
                        return;
                    }
                    this.confirmAction = 'start';
                    this.showConfirmModal = true;
                    
                },
                confirmStop() {
                    this.confirmAction = 'stop';
                    this.showConfirmModal = true;
                    
                },
                async executeConfirmedAction() {
                    // Close modal immediately before starting action
                    this.showConfirmModal = false;
                    
                    // Small delay to let modal close animation finish
                    await this.$nextTick();
                    
                    if (this.confirmAction === 'start') {
                        await this.startBot();
                    } else {
                        await this.stopBot();
                    }
                },
                // Inline edit methods
                toggleSection(section) {
                    this.expandedSections[section] = !this.expandedSections[section];
                },
                getFieldDisplay(section, field) {
                    const value = this.settings[section][field.key];
                    if (!value) return field.required ? '(not set)' : '-';
                    if (field.masked) return '';
                    if (String(value).length > 15) return String(value).substring(0, 12) + '...';
                    return value;
                },
                startEdit(section, key, value) {
                    this.editingField = `${section}.${key}`;
                    this.editValue = value || '';
                    this.$nextTick(() => {
                        const input = document.querySelector('.inline-edit-input input');
                        if (input) input.focus();
                    });
                },
                async saveEdit(section, key) {
                    const oldValue = this.settings[section][key];
                    this.settings[section][key] = this.editValue;
                    this.editingField = null;
                    
                    // Auto-save to server
                    try {
                        const payload = {
                            telegram: {
                                ...this.settings.telegram
                            },
                            broker: this.settings.broker,
                            trading: this.settings.trading,
                            risk: this.settings.risk
                        };
                        
                        const res = await fetch('/api/settings', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (res.ok) {
                            this.notify('Setting saved', 'success');
                        } else {
                            this.settings[section][key] = oldValue;
                            this.notify('Failed to save setting', 'error');
                        }
                    } catch (e) {
                        this.settings[section][key] = oldValue;
                        this.notify('Failed to save setting', 'error');
                    }
                    
                },
                cancelEdit() {
                    this.editingField = null;
                    
                },
                // Channel management methods
                async addSignalChannel() {
                    const channel = this.newSignalChannel.trim();
                    if (!channel) return;
                    
                    // Parse as number if it looks like a channel ID
                    const channelValue = /^-?\d+$/.test(channel) ? parseInt(channel) : channel;
                    
                    if (this.settings.telegram.signal_channels.includes(channelValue)) {
                        this.notify('Channel already exists', 'warning');
                        return;
                    }
                    
                    this.settings.telegram.signal_channels.push(channelValue);
                    this.newSignalChannel = '';
                    
                    // Save to server
                    try {
                        const res = await fetch('/api/settings/telegram/channels', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                signal_channels: this.settings.telegram.signal_channels,
                                notification_channel: this.settings.telegram.notification_channel
                            })
                        });
                        
                        if (res.ok) {
                            this.notify('Signal channel added', 'success');
                        } else {
                            this.settings.telegram.signal_channels.pop();
                            this.notify('Failed to add channel', 'error');
                        }
                    } catch (e) {
                        this.settings.telegram.signal_channels.pop();
                        this.notify('Failed to add channel', 'error');
                    }
                    
                },
                async removeSignalChannel(index) {
                    const removed = this.settings.telegram.signal_channels.splice(index, 1)[0];
                    
                    try {
                        const res = await fetch('/api/settings/telegram/channels', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                signal_channels: this.settings.telegram.signal_channels,
                                notification_channel: this.settings.telegram.notification_channel
                            })
                        });
                        
                        if (res.ok) {
                            this.notify('Channel removed', 'success');
                        } else {
                            this.settings.telegram.signal_channels.splice(index, 0, removed);
                            this.notify('Failed to remove channel', 'error');
                        }
                    } catch (e) {
                        this.settings.telegram.signal_channels.splice(index, 0, removed);
                        this.notify('Failed to remove channel', 'error');
                    }
                    
                },
                async saveNotificationChannel() {
                    const oldValue = this.settings.telegram.notification_channel;
                    const newValue = this.editValue.trim();
                    
                    // Parse as number if it looks like a channel ID
                    this.settings.telegram.notification_channel = /^-?\d+$/.test(newValue) ? parseInt(newValue) : newValue;
                    this.editingField = null;
                    
                    try {
                        const res = await fetch('/api/settings/telegram/channels', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                signal_channels: this.settings.telegram.signal_channels,
                                notification_channel: this.settings.telegram.notification_channel
                            })
                        });
                        
                        if (res.ok) {
                            this.notify('Notification channel updated', 'success');
                        } else {
                            this.settings.telegram.notification_channel = oldValue;
                            this.notify('Failed to update channel', 'error');
                        }
                    } catch (e) {
                        this.settings.telegram.notification_channel = oldValue;
                        this.notify('Failed to update channel', 'error');
                    }
                    
                },
                getNotifIcon(type) {
                    const icons = {
                        success: 'check-circle',
                        error: 'alert-circle',
                        warning: 'alert-triangle',
                        info: 'info'
                    };
                    return icons[type] || 'info';
                },
                getNotifTitle(type) {
                    const titles = {
                        success: 'Success',
                        error: 'Error',
                        warning: 'Warning',
                        info: 'Info'
                    };
                    return titles[type] || 'Notification';
                },
                dismissNotification(id) {
                    const notif = this.notifications.find(n => n.id === id);
                    if (notif) {
                        notif.removing = true;
                        setTimeout(() => {
                            this.notifications = this.notifications.filter(n => n.id !== id);
                        }, 250);
                    }
                },
                async retryConnection() {
                    if (this.loading.reconnect) return;
                    
                    this.loading.reconnect = true;
                    this.addActivity('Retrying connections...', 'info', 'refresh-cw');
                    
                    try {
                        const res = await fetch('/api/bot/reconnect', { method: 'POST' });
                        if (!res.ok) {
                            const err = await res.json();
                            throw new Error(err.detail || 'Reconnect failed');
                        }
                        
                        const data = await res.json();
                        
                        // Update status based on results
                        this.status.mt5_connected = data.mt5_connected;
                        this.status.telegram_connected = data.telegram_connected;
                        
                        // Show results
                        if (data.mt5_connected && data.telegram_connected) {
                            this.showNotification('All services reconnected successfully!', 'success');
                            this.addActivity('All connections restored', 'success', 'check-circle');
                        } else {
                            const failed = [];
                            if (!data.mt5_connected) failed.push('MT5');
                            if (!data.telegram_connected) failed.push('Telegram');
                            this.showNotification(`Reconnect completed. Failed: ${failed.join(', ')}`, 'warning');
                            this.addActivity(`Reconnect partial: ${failed.join(', ')} still disconnected`, 'warning', 'alert-triangle');
                        }
                        
                        // Refresh all data
                        await this.refreshData();
                        
                    } catch (e) {
                        console.error('Reconnect error:', e);
                        this.showNotification(`Reconnect failed: ${e.message}`, 'error');
                        this.addActivity('Reconnect failed', 'error', 'x-circle');
                    } finally {
                        this.loading.reconnect = false;
                    }
                },
                async refreshData() {
                    this.loading.refresh = true;
                    try {
                        const res = await fetch('/api/status');
                        if (!res.ok) throw new Error('Failed to fetch status');
                        const data = await res.json();
                        
                        this.status = {
                            bot_running: data.bot_running,
                            mt5_connected: data.mt5_connected,
                            telegram_connected: data.telegram_connected,
                            uptime_seconds: data.uptime_seconds || 0
                        };
                        
                        if (data.account) {
                            this.account = {
                                balance: data.account.balance || 0,
                                equity: data.account.equity || 0,
                                margin: data.account.margin || 0,
                                free_margin: data.account.free_margin || 0,
                                profit: data.account.profit || 0,
                                currency: data.account.currency || 'USD',
                                leverage: data.account.leverage || 0,
                                server: data.account.server || '',
                                login: data.account.login || 0
                            };
                        }
                        
                        if (data.stats) {
                            this.stats = {
                                total_trades: data.stats.total_trades || 0,
                                closed_trades: data.stats.closed_trades || 0,
                                winning_trades: data.stats.winning_trades || 0,
                                losing_trades: data.stats.losing_trades || 0,
                                win_rate: data.stats.win_rate || 0,
                                total_profit: data.stats.total_profit || 0,
                                open_trades: data.stats.open_trades || 0,
                                last_updated: data.stats.last_updated || new Date().toISOString()
                            };
                        }
                        
                        if (data.risk) {
                            this.risk = data.risk;
                        }
                        
                        if (data.config) {
                            this.config = data.config;
                        }
                        
                        await this.refreshTrades();
                        
                        // Fetch channel info if Telegram is connected
                        if (this.status.telegram_connected) {
                            await this.refreshChannels();
                        }
                        
                        this.loading.initial = false;
                    } catch (e) {
                        console.error('Refresh error:', e);
                        if (this.loading.initial) {
                            this.notify('Unable to connect to server. Please check if the bot is running.', 'error');
                        }
                    } finally {
                        this.loading.refresh = false;
                    }
                },
                async refreshTrades() {
                    try {
                        const res = await fetch('/api/trades?active_only=true');
                        if (!res.ok) throw new Error('Failed to fetch trades');
                        const data = await res.json();
                        this.activeTrades = data.trades || [];
                    } catch (e) {
                        console.error('Trades error:', e);
                    }
                },
                async refreshChannels(forceRefresh = false) {
                    // Fetch channels - API will auto-fetch from Telegram if cache is stale
                    this.loadingChannels = true;
                    try {
                        const url = forceRefresh ? '/api/telegram/channels?refresh=true' : '/api/telegram/channels';
                        const res = await fetch(url);
                        if (!res.ok) throw new Error('Failed to fetch channels');
                        const data = await res.json();
                        this.telegramChannels = data.channels || [];
                        console.log('Channels loaded:', data.source || 'unknown', this.telegramChannels.length);
                    } catch (e) {
                        console.error('Channels error:', e);
                    } finally {
                        this.loadingChannels = false;
                    }
                },
                setPositionsView(grouped) {
                    this.groupPositionsView = grouped;
                    localStorage.setItem('evobot-group-positions', grouped ? 'true' : 'false');
                },
                async refreshPositions() {
                    this.loading.positions = true;
                    try {
                        const res = await fetch('/api/positions');
                        if (!res.ok) throw new Error('Failed to fetch positions');
                        const data = await res.json();
                        this.mt5Positions = data.positions || [];
                        this.groupedPositions = data.grouped || {};
                    } catch (e) {
                        console.error('Positions error:', e);
                    } finally {
                        this.loading.positions = false;
                    }
                },
                async closePosition(ticket) {
                    this.loading.trades[ticket] = true;
                    try {
                        const res = await fetch(`/api/positions/${ticket}/close`, { method: 'POST' });
                        if (res.ok) {
                            this.notify('Position closed successfully', 'success');
                            this.addActivity(`Closed #${ticket}`, 'danger', 'x');
                            await this.refreshPositions();
                        } else {
                            const data = await res.json();
                            this.notify(data.detail || 'Failed to close position', 'error');
                        }
                    } catch (e) {
                        this.notify('Connection error', 'error');
                    } finally {
                        delete this.loading.trades[ticket];
                    }
                },
                openModifyModal(position) {
                    // TODO: Implement modify SL/TP modal
                    this.notify('Modify SL/TP feature coming soon', 'info');
                },
                async startBot() {
                    // Check settings before starting
                    if (!this.hasRequiredSettings) {
                        this.expandedSections.telegram = true;
                        this.expandedSections.broker = true;
                        this.notify('Please configure required settings before starting the bot', 'warning');
                        
                        return;
                    }
                    
                    this.loading.start = true;
                    this.startingPhase = 'connecting';
                    this.startingStep = 0;
                    
                    // Reset connection steps to loading state
                    this.connectionSteps = {
                        mt5: 'loading',
                        telegram: 'pending',
                        account: 'pending'
                    };
                    
                    // Force Vue to update
                    await this.$nextTick();
                    
                    // Animate through steps
                    this.startingStep = 1;
                    await this.sleep(400);
                    this.startingStep = 2;
                    await this.sleep(500);
                    this.startingStep = 3;
                    
                    try {
                        const res = await fetch('/api/bot/start', { method: 'POST' });
                        const data = await res.json();
                        
                        this.startingStep = 4;
                        
                        if (!res.ok) {
                            this.notify(data.detail || 'Failed to start bot', 'error');
                            this.connectionSteps.mt5 = 'error';
                            this.startingPhase = null;
                            this.startingStep = 0;
                            this.status.bot_running = false;
                            return;
                        }
                        
                        // Check if startup failed (not all connections succeeded)
                        if (data.status === 'failed') {
                            // Update connection steps based on actual connection state
                            this.connectionSteps.mt5 = data.mt5_connected ? 'success' : 'failed';
                            this.connectionSteps.telegram = data.telegram_connected ? 'success' : 'failed';
                            this.connectionSteps.account = data.account_ok ? 'success' : 'failed';
                            
                            // Update connection error details for modal
                            this.connectionErrors = {
                                mt5: {
                                    status: data.mt5_connected ? 'success' : 'failed',
                                    message: data.mt5_connected ? 'Connected successfully' : (data.errors?.find(e => e.includes('MT5')) || 'Connection failed - check credentials')
                                },
                                telegram: {
                                    status: data.telegram_connected ? 'success' : 'failed',
                                    message: data.telegram_connected ? 'Connected successfully' : (data.errors?.find(e => e.includes('Telegram')) || 'Connection failed - check API credentials')
                                },
                                account: {
                                    status: data.account_ok ? 'success' : 'failed',
                                    message: data.account_ok ? 'Account loaded successfully' : (data.errors?.find(e => e.includes('Account')) || 'Unable to load account - MT5 not connected')
                                }
                            };
                            
                            // Show professional connection error modal
                            this.showConnectionError = true;
                            this.addActivity('Bot Startup Failed', 'danger', 'x-circle');
                            
                            this.startingPhase = null;
                            this.startingStep = 0;
                            this.status.bot_running = false;
                            return;
                        }
                        
                        // Bot started successfully - all connections are good
                        this.status.bot_running = true;
                        this.status.mt5_connected = data.mt5_connected;
                        this.status.telegram_connected = data.telegram_connected;
                        
                        // Update connection steps - all should be success
                        this.connectionSteps.mt5 = 'success';
                        this.connectionSteps.telegram = 'success';
                        this.connectionSteps.account = 'success';
                        
                        this.notify('Connected to MT5 broker ', 'success');
                        this.notify('Telegram listener active ', 'success');
                        this.notify(' Bot is now live and monitoring signals!', 'success');
                        this.addActivity('Bot Started - All Connected', 'success', 'play');
                        
                        this.startingPhase = 'started';
                        
                        // Start uptime counter
                        this.startUptimeCounter();
                        
                        // Fetch positions immediately
                        this.refreshPositions();
                        
                        // Clear starting phase after a delay
                        await this.sleep(1500);
                        this.startingPhase = null;
                        
                    } catch (e) {
                        console.error('Start bot error:', e);
                        this.notify('Connection error. Please check your network.', 'error');
                        this.connectionSteps.mt5 = 'error';
                        this.startingPhase = null;
                        this.startingStep = 0;
                        this.status.bot_running = false;
                    } finally {
                        this.loading.start = false;
                        this.startingStep = 0;
                        await this.$nextTick();
                        
                        // Refresh data after a delay to let server state settle
                        setTimeout(() => {
                            this.refreshData();
                        }, 1000);
                    }
                },
                sleep(ms) {
                    return new Promise(resolve => setTimeout(resolve, ms));
                },
                async retryConnection() {
                    this.showConnectionError = false;
                    await this.$nextTick();
                    await this.startBot();
                },
                startUptimeCounter() {
                    // Clear any existing interval
                    if (this.uptimeInterval) {
                        clearInterval(this.uptimeInterval);
                    }
                    // Update uptime every second
                    this.uptimeInterval = setInterval(() => {
                        if (this.status.bot_running) {
                            this.displayUptime++;
                        }
                    }, 1000);
                },
                async stopBot() {
                    this.loading.stop = true;
                    
                    // Set bot stopped immediately so buttons update
                    this.status.bot_running = false;
                    
                    // Force Vue to update
                    await this.$nextTick();
                    
                    
                    try {
                        const res = await fetch('/api/bot/stop', { method: 'POST' });
                        if (!res.ok) {
                            const data = await res.json();
                            this.notify(data.detail || 'Failed to stop bot', 'error');
                            // Revert status on failure
                            this.status.bot_running = true;
                        } else {
                            // Stop uptime counter
                            if (this.uptimeInterval) {
                                clearInterval(this.uptimeInterval);
                                this.uptimeInterval = null;
                            }
                            this.displayUptime = 0;
                            
                            // Reset connection status
                            this.status.mt5_connected = false;
                            this.status.telegram_connected = false;
                            
                            // Reset connection steps
                            this.connectionSteps = {
                                mt5: 'pending',
                                telegram: 'pending',
                                signals: 'pending'
                            };
                            
                            this.notify('Trading bot stopped successfully', 'success');
                            this.addActivity('Bot Stopped', 'danger', 'square');
                        }
                    } catch (e) {
                        this.notify('Connection error. Please check your network.', 'error');
                        // Revert status on error
                        this.status.bot_running = true;
                    } finally {
                        this.loading.stop = false;
                        // Force UI update without calling refreshData (which would overwrite our status)
                        await this.$nextTick();
                        
                        
                        // Refresh other data after a delay to let server state settle
                        setTimeout(() => {
                            this.refreshData();
                        }, 1000);
                    }
                },
                async closeTrade(id) {
                    if (!confirm('Are you sure you want to close this trade?')) return;
                    this.loading.trades[id] = true;
                    try {
                        const res = await fetch(`/api/trades/${id}/close`, { method: 'POST' });
                        if (res.ok) {
                            this.notify('Trade closed successfully', 'success');
                            this.addActivity('Trade Closed', 'danger', 'x');
                            this.refreshData();
                        } else {
                            const data = await res.json();
                            this.notify(data.detail || 'Failed to close trade', 'error');
                        }
                    } catch (e) {
                        this.notify('Connection error. Please try again.', 'error');
                    } finally {
                        delete this.loading.trades[id];
                    }
                },
                connectWebSocket() {
                    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
                    const wsUrl = `${protocol}//${window.location.host}/ws`;
                    console.log('Connecting to WebSocket:', wsUrl);
                    this.ws = new WebSocket(wsUrl);
                    
                    this.ws.onopen = () => {
                        console.log('WebSocket connected');
                    };
                    
                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        
                        // Handle real-time account updates
                        if (data.type === 'account_update') {
                            const acc = data.data;
                            this.account = {
                                balance: acc.balance || 0,
                                equity: acc.equity || 0,
                                margin: acc.margin || 0,
                                free_margin: acc.free_margin || 0,
                                profit: acc.profit || 0,
                                currency: acc.currency || 'USD',
                                leverage: acc.leverage || 0,
                                server: acc.server || '',
                                login: acc.login || 0
                            };
                        }
                        // Handle real-time positions updates
                        else if (data.type === 'positions_update') {
                            this.mt5Positions = data.data.positions || [];
                        }
                        // Handle startup progress updates
                        else if (data.type === 'startup_progress') {
                            const { step, status, message, connected } = data.data;
                            
                            // Update connectionSteps for UI progress indicators
                            if (step === 'mt5') {
                                this.connectionSteps.mt5 = status;
                                // Update actual status based on connected flag
                                if (status === 'success') {
                                    this.status.mt5_connected = true;
                                } else if (status === 'failed' || status === 'error' || status === 'warning') {
                                    this.status.mt5_connected = connected === true;
                                }
                            } else if (step === 'telegram') {
                                this.connectionSteps.telegram = status;
                                if (status === 'success') {
                                    this.status.telegram_connected = true;
                                } else if (status === 'failed' || status === 'error' || status === 'warning') {
                                    this.status.telegram_connected = connected === true;
                                }
                            } else if (step === 'account') {
                                this.connectionSteps.account = status;
                            }
                            
                            if (step === 'error') {
                                this.connectionSteps.mt5 = 'error';
                                this.notify(message || 'Startup failed', 'error');
                            }
                        } else if (data.type === 'bot_started') {
                            // Don't override - use actual connection states from data
                            if (data.data.mt5_connected !== undefined) {
                                this.status.mt5_connected = data.data.mt5_connected;
                                this.connectionSteps.mt5 = data.data.mt5_connected ? 'success' : 'failed';
                            }
                            if (data.data.telegram_connected !== undefined) {
                                this.status.telegram_connected = data.data.telegram_connected;
                                this.connectionSteps.telegram = data.data.telegram_connected ? 'success' : 'failed';
                            }
                            this.connectionSteps.account = 'success';
                            this.status.bot_running = true;
                            this.addActivity('Bot Started', 'success', 'play');
                            this.refreshData();
                            this.refreshPositions();
                        } else if (data.type === 'reconnect_progress') {
                            const { service, status, message } = data.data;
                            if (service === 'mt5') {
                                if (status === 'connecting') {
                                    this.connectionSteps.mt5 = 'loading';
                                } else if (status === 'success') {
                                    this.status.mt5_connected = true;
                                    this.connectionSteps.mt5 = 'success';
                                } else {
                                    this.connectionSteps.mt5 = 'failed';
                                }
                            } else if (service === 'telegram') {
                                if (status === 'connecting') {
                                    this.connectionSteps.telegram = 'loading';
                                } else if (status === 'success') {
                                    this.status.telegram_connected = true;
                                    this.connectionSteps.telegram = 'success';
                                } else {
                                    this.connectionSteps.telegram = 'failed';
                                }
                            }
                        } else if (data.type === 'signal_received') {
                            this.addActivity(`Signal: ${data.data.symbol} ${data.data.direction}`, 'success', 'zap');
                            this.notify(`Signal: ${data.data.symbol} ${data.data.direction}`, 'info');
                        } else if (data.type === 'trade_created') {
                            this.addActivity(`Trade: ${data.data.trade?.symbol}`, 'success', 'trending-up');
                            this.notify(`Trade opened: ${data.data.trade?.symbol}`, 'success');
                        } else if (data.type === 'signal_rejected') {
                            this.addActivity(`Rejected: ${data.data.reason}`, 'danger', 'x-circle');
                        } else if (data.type === 'startup_failed') {
                            // Handle startup failure - update UI to show failed state
                            this.status.bot_running = false;
                            this.startingPhase = null;
                            
                            if (data.data.mt5_connected !== undefined) {
                                this.status.mt5_connected = data.data.mt5_connected;
                                this.connectionSteps.mt5 = data.data.mt5_connected ? 'success' : 'failed';
                            }
                            if (data.data.telegram_connected !== undefined) {
                                this.status.telegram_connected = data.data.telegram_connected;
                                this.connectionSteps.telegram = data.data.telegram_connected ? 'success' : 'failed';
                            }
                            if (data.data.account_ok !== undefined) {
                                this.connectionSteps.account = data.data.account_ok ? 'success' : 'failed';
                            }
                            
                            // Show error message
                            const msg = data.data.message || 'Startup failed';
                            this.notify(` ${msg}`, 'error');
                            this.addActivity('Startup Failed', 'danger', 'x-circle');
                        }
                    };
                    
                    this.ws.onclose = () => {
                        console.log('WebSocket disconnected, reconnecting...');
                        setTimeout(() => this.connectWebSocket(), 3000);
                    };
                    
                    this.ws.onerror = (error) => {
                        console.error('WebSocket error:', error);
                    };
                },
                addActivity(title, type, icon) {
                    this.activities.unshift({
                        id: Date.now() + Math.random(),
                        title,
                        time: new Date().toLocaleTimeString(),
                        type,
                        icon
                    });
                    if (this.activities.length > 20) {
                        this.activities.pop();
                    }
                    
                },
                notify(message, type = 'info') {
                    const id = this.nextNotifId++;
                    this.notifications.push({ id, message, type, removing: false });
                    
                    // Auto-dismiss after timeout
                    const timeout = type === 'error' ? 8000 : type === 'warning' ? 6000 : 4000;
                    setTimeout(() => {
                        this.dismissNotification(id);
                    }, timeout);
                    
                    // Re-initialize icons for new notification
                    this.$nextTick(() => {
                        
                    });
                },
                async loadSettings() {
                    this.loading.settings = true;
                    try {
                        const res = await fetch('/api/settings');
                        if (res.ok) {
                            const data = await res.json();
                            if (data.telegram) {
                                this.settings.telegram = {
                                    ...this.settings.telegram,
                                    ...data.telegram,
                                    signal_channels: data.telegram.signal_channels || [],
                                    signal_channels_str: (data.telegram.signal_channels || []).join(', ')
                                };
                            }
                            if (data.broker) {
                                this.settings.broker = { ...this.settings.broker, ...data.broker };
                            }
                            if (data.trading) {
                                this.settings.trading = { ...this.settings.trading, ...data.trading };
                            }
                            if (data.risk) {
                                this.settings.risk = { ...this.settings.risk, ...data.risk };
                            }
                            this.notify('Settings loaded successfully', 'success');
                        } else {
                            this.notify('Failed to load settings', 'error');
                        }
                    } catch (e) {
                        console.error('Load settings error:', e);
                        this.notify('Failed to load settings', 'error');
                    } finally {
                        this.loading.settings = false;
                        
                    }
                },
                async saveSettings() {
                    // Validate before saving
                    if (!this.validateSettings()) {
                        this.notify('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    this.loading.settings = true;
                    try {
                        // Parse signal channels from string
                        const signalChannels = this.settings.telegram.signal_channels_str
                            .split(',')
                            .map(s => s.trim())
                            .filter(s => s)
                            .map(s => parseInt(s) || s);
                        
                        const payload = {
                            telegram: {
                                ...this.settings.telegram,
                                signal_channels: signalChannels
                            },
                            broker: this.settings.broker,
                            trading: this.settings.trading,
                            risk: this.settings.risk
                        };
                        
                        const res = await fetch('/api/settings', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (res.ok) {
                            this.notify('Settings saved successfully! Restart bot to apply changes.', 'success');
                            this.addActivity('Settings Updated', 'success', 'settings');
                            this.settingsErrors = [];
                        } else {
                            const data = await res.json();
                            this.notify(data.detail || 'Failed to save settings', 'error');
                        }
                    } catch (e) {
                        console.error('Save settings error:', e);
                        this.notify('Failed to save settings', 'error');
                    } finally {
                        this.loading.settings = false;
                    }
                },
                validateSettings() {
                    this.settingsValidated = true;
                    this.settingsErrors = [];
                    
                    // Check Telegram credentials
                    if (!this.settings.telegram.api_id) {
                        this.settingsErrors.push('Telegram API ID is required');
                    }
                    if (!this.settings.telegram.api_hash) {
                        this.settingsErrors.push('Telegram API Hash is required');
                    }
                    if (!this.settings.telegram.phone_number) {
                        this.settingsErrors.push('Telegram Phone Number is required');
                    }
                    if (!this.settings.telegram.signal_channels_str) {
                        this.settingsErrors.push('At least one Signal Channel is required');
                    }
                    
                    // Check Broker credentials
                    if (!this.settings.broker.metaapi_token) {
                        this.settingsErrors.push('MetaApi Token is required');
                    }
                    if (!this.settings.broker.metaapi_account_id) {
                        this.settingsErrors.push('MetaApi Account ID is required');
                    }
                    
                    
                    return this.settingsErrors.length === 0;
                },
                async testTelegramConnection() {
                    this.testingTelegram = true;
                    this.telegramTestResult = null;
                    try {
                        const res = await fetch('/api/test/telegram', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                api_id: this.settings.telegram.api_id,
                                api_hash: this.settings.telegram.api_hash,
                                phone_number: this.settings.telegram.phone_number
                            })
                        });
                        const data = await res.json();
                        this.telegramTestResult = {
                            success: res.ok,
                            message: data.message || (res.ok ? 'Connection successful!' : 'Connection failed')
                        };
                    } catch (e) {
                        this.telegramTestResult = {
                            success: false,
                            message: 'Connection test failed: ' + e.message
                        };
                    } finally {
                        this.testingTelegram = false;
                        
                    }
                },
                async testBrokerConnection() {
                    this.testingBroker = true;
                    this.brokerTestResult = null;
                    try {
                        const res = await fetch('/api/test/broker', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                metaapi_token: this.settings.broker.metaapi_token,
                                metaapi_account_id: this.settings.broker.metaapi_account_id
                            })
                        });
                        const data = await res.json();
                        this.brokerTestResult = {
                            success: res.ok,
                            message: data.message || (res.ok ? 'Connection successful!' : 'Connection failed')
                        };
                    } catch (e) {
                        this.brokerTestResult = {
                            success: false,
                            message: 'Connection test failed: ' + e.message
                        };
                    } finally {
                        this.testingBroker = false;
                        
                    }
                },
                // Navbar methods
                logout() {
                    // Close user menu first
                    this.showUserMenu = false;
                    // Show logout confirmation modal
                    this.showLogoutModal = true;
                },
                async confirmLogout() {
                    this.loggingOut = true;
                    try {
                        // Clear local storage first
                        localStorage.removeItem('token');
                        localStorage.removeItem('refresh_token');
                        localStorage.removeItem('user');
                        
                        // Call logout API
                        await fetch('/api/auth/telegram/logout', { method: 'POST' }).catch(() => {});
                        await fetch('/api/logout', { method: 'POST' }).catch(() => {});
                        
                        // Redirect to login
                        window.location.href = '/login';
                    } catch (err) {
                        console.error('Logout error:', err);
                        // Still redirect even on error since we cleared local storage
                        window.location.href = '/login';
                    }
                },
                toggleNavbar() {
                    this.navbarCollapsed = !this.navbarCollapsed;
                    // Save preference to localStorage
                    localStorage.setItem('navbarCollapsed', this.navbarCollapsed);
                },
                navigateTo(item) {
                    this.activeNavItem = item;
                    this.showUserMenu = false;
                    // Scroll to top of content
                    document.querySelector('.content')?.scrollTo(0, 0);
                },
                clearLogs() {
                    if (confirm('Are you sure you want to clear all activity logs?')) {
                        this.activities = [];
                        this.notify('Logs cleared', 'success');
                    }
                },
                async saveAllSettings() {
                    this.loading.settings = true;
                    try {
                        const payload = {
                            telegram: {
                                ...this.settings.telegram
                            },
                            broker: this.settings.broker,
                            trading: this.settings.trading,
                            risk: this.settings.risk
                        };
                        
                        const res = await fetch('/api/settings', {
                            method: 'PUT',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (res.ok) {
                            this.notify('All settings saved successfully!', 'success');
                            this.addActivity('Settings Updated', 'success', 'settings');
                        } else {
                            const data = await res.json();
                            this.notify(data.detail || 'Failed to save settings', 'error');
                        }
                    } catch (e) {
                        console.error('Save settings error:', e);
                        this.notify('Failed to save settings', 'error');
                    } finally {
                        this.loading.settings = false;
                    }
                }
            },
            async mounted() {
                // Check authentication
                const token = localStorage.getItem('token');
                if (!token) {
                    window.location.href = '/login';
                    return;
                }
                
                // Verify token is valid
                try {
                    const res = await fetch('/api/auth/telegram/me', {
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    if (!res.ok) {
                        localStorage.removeItem('token');
                        localStorage.removeItem('refresh_token');
                        localStorage.removeItem('user');
                        window.location.href = '/login';
                        return;
                    }
                } catch (e) {
                    console.error('Auth check failed:', e);
                }
                
                // Initialize theme from localStorage (default to light theme)
                const savedTheme = localStorage.getItem('evobot-theme');
                if (savedTheme === 'dark') {
                    this.isDarkTheme = true;
                } else {
                    // Default to light theme
                    this.isDarkTheme = false;
                    document.documentElement.classList.add('light-theme');
                }
                
                this.connectWebSocket();
                
                // Load settings first to check if setup is needed
                try {
                    const settingsRes = await fetch('/api/settings');
                    if (settingsRes.ok) {
                        const settingsData = await settingsRes.json();
                        console.log('Loaded settings:', settingsData);
                        if (settingsData.telegram) {
                            this.settings.telegram = {
                                ...this.settings.telegram,
                                ...settingsData.telegram,
                                signal_channels: settingsData.telegram.signal_channels || [],
                                signal_channels_str: (settingsData.telegram.signal_channels || []).join(', ')
                            };
                        }
                        if (settingsData.broker) {
                            this.settings.broker = { ...this.settings.broker, ...settingsData.broker };
                        }
                        if (settingsData.trading) {
                            this.settings.trading = { ...this.settings.trading, ...settingsData.trading };
                        }
                        if (settingsData.risk) {
                            this.settings.risk = { ...this.settings.risk, ...settingsData.risk };
                        }
                    }
                } catch (e) {
                    console.error('Failed to load settings:', e);
                }
                
                // Initialize Lucide icons after settings load
                
                
                // Check if bot is already running
                try {
                    const res = await fetch('/api/status');
                    const data = await res.json();
                    
                    // Always update status
                    this.status = {
                        bot_running: data.bot_running || false,
                        mt5_connected: data.mt5_connected || false,
                        telegram_connected: data.telegram_connected || false,
                        uptime_seconds: data.uptime_seconds || 0
                    };
                    
                    if (data.account) {
                        this.account = {
                            balance: data.account.balance || 0,
                            equity: data.account.equity || 0,
                            margin: data.account.margin || 0,
                            free_margin: data.account.free_margin || 0,
                            profit: data.account.profit || 0,
                            currency: data.account.currency || 'USD',
                            leverage: data.account.leverage || 0,
                            server: data.account.server || '',
                            login: data.account.login || 0,
                            name: data.account.name || ''
                        };
                        // Mark MT5 session as valid if we have account data with a login
                        if (data.account.login) {
                            this.mt5SessionValid = true;
                        }
                    }
                    
                    if (data.stats) {
                        this.stats = {
                            total_trades: data.stats.total_trades || 0,
                            closed_trades: data.stats.closed_trades || 0,
                            winning_trades: data.stats.winning_trades || 0,
                            losing_trades: data.stats.losing_trades || 0,
                            win_rate: data.stats.win_rate || 0,
                            total_profit: data.stats.total_profit || 0,
                            open_trades: data.stats.open_trades || 0,
                            last_updated: data.stats.last_updated || new Date().toISOString()
                        };
                    }
                    if (data.risk) this.risk = data.risk;
                    if (data.config) this.config = data.config;
                    
                    this.displayUptime = data.uptime_seconds || 0;
                    
                    // Use nextTick to ensure DOM is ready
                    await this.$nextTick();
                    
                    // Start uptime counter if bot is running
                    if (data.bot_running) {
                        this.startUptimeCounter();
                    }
                    
                    // Always add dashboard loaded activity
                    this.addActivity('Dashboard loaded', 'success', 'check');
                    
                    
                    // Always try to load positions
                    await this.refreshPositions();
                    
                    // Always try to load channel info (API returns cached data if Telegram not connected)
                    await this.refreshChannels();
                    
                    // Fetch Telegram user info
                    await this.fetchTelegramUser();
                } catch (e) {
                    console.error('Initial status check failed:', e);
                    // Still add activity on error
                    this.addActivity('Dashboard loaded', 'warning', 'alert-circle');
                }
                
                // Refresh data every 10 seconds for real-time updates (reduced from 2s to minimize log noise)
                setInterval(() => {
                    this.refreshData();
                    // Always try to refresh positions
                    this.refreshPositions();
                }, 10000);
                
                // Sync uptime from server and start local counter if bot is running
                setInterval(() => {
                    if (this.status.bot_running && this.status.uptime_seconds) {
                        this.displayUptime = this.status.uptime_seconds;
                    }
                }, 10000);
                
                // Firebase real-time listeners
                if (window.firebaseDB) {
                    const statusRef = window.firebaseRef(window.firebaseDB, 'status');
                    window.firebaseOnValue(statusRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            this.status = {
                                ...this.status,
                                bot_running: data.bot_running,
                                mt5_connected: data.mt5_connected,
                                telegram_connected: data.telegram_connected,
                                uptime_seconds: data.uptime_seconds || 0
                            };
                        }
                    });
                    
                    const accountRef = window.firebaseRef(window.firebaseDB, 'account');
                    window.firebaseOnValue(accountRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            this.account = {
                                balance: data.balance || 0,
                                equity: data.equity || 0,
                                margin: data.margin || 0,
                                free_margin: data.free_margin || 0,
                                profit: data.profit || 0,
                                currency: data.currency || 'USD',
                                leverage: data.leverage || 0,
                                server: data.server || '',
                                login: data.login || 0
                            };
                        }
                    });
                    
                    const tradesRef = window.firebaseRef(window.firebaseDB, 'trades');
                    window.firebaseOnValue(tradesRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            this.activeTrades = Object.values(data).filter(t => 
                                t.status === 'active' || t.status === 'pending'
                            );
                        }
                    });
                    
                    const statsRef = window.firebaseRef(window.firebaseDB, 'stats');
                    window.firebaseOnValue(statsRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            // Only update from Firebase if it's newer than current stats
                            const firebaseTimestamp = data.timestamp || data.last_updated;
                            const currentTimestamp = this.stats.last_updated;
                            
                            // If Firebase data is newer or we have no current timestamp, update
                            if (!currentTimestamp || (firebaseTimestamp && new Date(firebaseTimestamp) >= new Date(currentTimestamp))) {
                                this.stats = {
                                    total_trades: data.total_trades || 0,
                                    winning_trades: data.winning_trades || 0,
                                    losing_trades: data.losing_trades || 0,
                                    win_rate: data.win_rate || 0,
                                    total_profit: data.total_profit || 0,
                                    open_trades: data.open_trades || 0,
                                    last_updated: firebaseTimestamp || new Date().toISOString()
                                };
                            }
                        }
                    });
                    
                    // Listen for settings changes
                    const settingsRef = window.firebaseRef(window.firebaseDB, 'settings');
                    window.firebaseOnValue(settingsRef, (snapshot) => {
                        const data = snapshot.val();
                        if (data) {
                            // Only update if not currently editing
                            if (!this.editingField) {
                                if (data.telegram) {
                                    this.settings.telegram = {
                                        ...this.settings.telegram,
                                        ...data.telegram,
                                        signal_channels: data.telegram.signal_channels || []
                                    };
                                }
                                if (data.broker) {
                                    this.settings.broker = { ...this.settings.broker, ...data.broker };
                                }
                                if (data.trading) {
                                    this.settings.trading = { ...this.settings.trading, ...data.trading };
                                }
                                if (data.risk) {
                                    this.settings.risk = { ...this.settings.risk, ...data.risk };
                                }
                            }
                        }
                    });
                }
                
                // Initialize Lucide icons once on mount
                this.initIcons();
            },
            updated() {
                // Disabled: Lucide icon reinitialization conflicts with Vue's virtual DOM
                // All dynamic icons should use inline SVGs instead of data-lucide
            }
        }).mount('#app');
    </script>
</body>
</html>
